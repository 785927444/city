import{d as I,g as T,j as b,o as g,c as S,dd as P,a4 as Y,r as q,f as d,a as _,Z as F,u as n,w as m,e as A,i as V,$ as U,E as M,a8 as B,F as J,p as R,y as H,cE as K,k as Z,v as G,t as Q,z as W,h as X,K as tt,l as et}from"./index-BF5jje68.js";import{_ as at}from"./FileList.vue_vue_type_script_setup_true_lang-CjQZZdnb.js";import{_ as st}from"./List.vue_vue_type_script_setup_true_lang-CRJw57K5.js";import{_ as rt}from"./question-filled-BgQjHn-S.js";import{v as N}from"./v6-B4YtUg27.js";import"./ViewFiles-C92c8QO4.js";import"./el-image-viewer-DMRq40TL.js";import"./el-switch-DkPm2rNO.js";import"./select-CBJjauee.js";/* empty css                    *//* empty css                   */import"./index-CU8Q0z-M.js";import"./index-CND7x1jx.js";/* empty css                                                                   */const nt=I({__name:"SchemeAutoFill",props:{schemeId:{type:[String,Number],default:""},areaValue:{type:[String,Number],default:""},taskType:{type:[String,Number],default:""},draft:{type:Object,required:!0},schemePlans:{type:Array,default:()=>[]},schemeAreas:{type:Array,default:()=>[]}},setup(w){const e=w,{proxy:a}=T(),v=a.publicStore(),x=i=>{if(i){if(i.datetime)try{const s=typeof i.datetime=="string"?JSON.parse(i.datetime):i.datetime;Array.isArray(s)&&s.length===2&&(e.draft.planned_start_date=`${s[0]}-01-01`,e.draft.expected_finish_date=`${s[1]}-12-31`,e.draft.plan_year=s[0])}catch{}if(i.attr)try{const s=typeof i.attr=="string"?JSON.parse(i.attr):i.attr;s.规划说明&&(typeof s.规划说明=="string"?e.draft.step2.summary=s.规划说明:s.规划说明?.name&&(e.draft.step2.summary=`(自动导入) 详见：${s.规划说明.name}`)),s.规划目标&&typeof s.规划目标=="string"&&(e.draft.contacts.target_2030=s.规划目标),s.编制单位&&(e.draft.step2.compilation_unit=s.编制单位),s.批复时间&&(e.draft.step2.approval_time=s.批复时间),s.基础建设条件&&(e.draft.step2.conditions=s.基础建设条件);const u=(o,f)=>o?{id:a.uuid(),type:f,time:P(new Date),name:o.name||"未命名文件",path:o.data,status:"success",statusText:"自动导入"}:null;if(s.规划文本){const o=u(s.规划文本,"方案文本");o&&e.draft.step2.fileList.push(o)}if(s.规划图表){const o=u(s.规划图表,"重要图表");o&&e.draft.step2.chartsList.push(o)}if(s.支撑材料){const o=u(s.支撑材料,"支撑材料");o&&e.draft.step2.materialsList.push(o)}if(s.矢量文件){const o=u(s.矢量文件,"矢量文件");o&&e.draft.step2.materialsList.push(o)}}catch{}}},k=async()=>{const i=e.schemeId,s=e.areaValue,u=e.taskType;if(!i||!s||!u)return;const o=e.schemeAreas.find(t=>String(t.value)===String(s)),f=o?o.name:"";if(!f)return;const h={model:"t_scheme_project",args:`scheme_id='${i}' AND aera='${f}' AND task_type='${u}'`},y=await v.http({Api:h});if(!a.isNull(y)&&y.length>0){const t=y[0];if(t.name&&(e.draft.project_name=t.name),t.num&&(e.draft.project_code=t.num),t.code&&(e.draft.unified_project_code=t.code),t.construct_scale&&(e.draft.build_stage=t.construct_scale),t.construct_price&&(e.draft.total_invest=t.construct_price),t.construct_datetime_start&&(e.draft.planned_start_date=t.construct_datetime_start),t.construct_datetime_end&&(e.draft.expected_finish_date=t.construct_datetime_end),t.completion_status&&(e.draft.project_stage=t.completion_status),t.construct_unit&&(e.draft.build_unit=t.construct_unit),t.construct_main&&(e.draft.supervisor_unit=t.construct_main),t.class&&(e.draft.project_category_level1=t.class),t.construct_content&&(e.draft.build_content=t.construct_content),t.construct_note&&(e.draft.remark=t.construct_note),t.mapdata&&(e.draft.project_range=t.mapdata),t.total_put_price&&(e.draft.cumulative_invest_issued=t.total_put_price),t.total_completion_price&&(e.draft.cumulative_completed_invest=t.total_completion_price),t.total_income_price&&(e.draft.project_benefit=t.total_income_price),t.estimate_year&&(e.draft.plan_year=t.estimate_year),t.estimate_price&&(e.draft.plan_year_amount=t.estimate_price),t.response_person&&(e.draft.contacts.project_owner=t.response_person),t.contact_phone&&(e.draft.contacts.project_owner_phone=t.contact_phone),t.contact_person&&(e.draft.contacts.project_contact=t.contact_person),t.vast_scheme&&(e.draft.contacts.major_strategy=t.vast_scheme),t.industrial_policy&&(e.draft.contacts.industry_policy=t.industrial_policy),t.gc_investmentd_irection&&(e.draft.contacts.government_invest_direction=t.gc_investmentd_irection),t.qu_stage_objective&&(e.draft.contacts.target_2030=t.qu_stage_objective),t.fund_source)try{const r=typeof t.fund_source=="string"?JSON.parse(t.fund_source):t.fund_source,l={value1:"central_budget",value2:"credit_financing",value3:"ultra_long_bond",value4:"securitization_financing",value5:"special_debt",value6:"enterprise_financing",value7:"fiscal",value8:"resident_contribution",value9:"other_channel",value10:"tbd"};for(const c in r)l[c]&&(e.draft.funds[l[c]]=r[c])}catch{}if(t.orther_text)try{const r=typeof t.orther_text=="string"?JSON.parse(t.orther_text):t.orther_text,l={value1:"apply_special_bond",value2:"apply_central_budget_fund",value3:"need_land_support",value4:"apply_policy_fin_tool",value5:"is_medium_long_term_loan",value6:"is_2023_bond_invest",value7:"is_key_private_invest",value8:"apply_upgrade_argument",value9:"apply_major_project",value10:"is_local_special_debt",value11:"apply_14th_102_project",value12:"apply_14th_energy_plan",value13:"apply_tech_financing",value14:"is_ultra_long_special_bond",value15:"has_private_invest"};for(const c in r)l[c]&&(e.draft.other_info[l[c]]=r[c]==="1"||r[c]===!0)}catch{}Y({title:"提示",message:"已自动填充规划项目信息",type:"success"})}},j=async()=>{const i=e.schemeId;if(!i)return;let s=`scheme_id='${i}'`;e.taskType&&(s+=` AND task_type='${e.taskType}'`);const u={model:"t_scheme_task",args:s},o=await v.http({Api:u});if(a.isNull(o))return;const f=Array.isArray(o)?o:[],h=e.draft.step2.task_years||[],y=f.map(t=>{const r={};return h.forEach(l=>{r[l]=""}),{id:t.id,type:t.task_type||"",content:t.construct_content||"",scale:t.unit_target||10,goals:r}});y.length>0&&(e.draft.step2.key_tasks=y)};return b(()=>e.schemeId,i=>{if(!i)return;const s=e.schemePlans.find(u=>String(u.id||u.value)===String(i));s&&x(s),j()},{immediate:!0}),b(()=>[e.schemeId,e.areaValue,e.taskType],()=>{k()},{immediate:!0}),(i,s)=>(g(),S("div"))}}),ot={class:"layout-col overlay"},it={class:"hh100 ww100 flex-sc warp"},ct={class:"flex-sc warp ww100"},lt={class:"ww100 flex-sc pb20"},pt=["onClick"],_t={class:"absolute f14 t10 r-18"},ut={class:"ww100 flex-cc f18 p40 bot-i16-1 mt20"},ft=I({__name:"step2",props:{state:{type:[Object,Array],default:()=>({})},contents:{type:Array,default:[]},active:{type:[Object,Array],default:()=>({})}},setup(w){const{proxy:e}=T(),a=e.publicStore();e.configStore(),e.dictStore();let v=V(),x=V({});const k=[{value:"1",name:"重点落实任务"},{value:"2",name:"体检整改任务"}],j=q({...a.$state,content:[{name:"任务中类",key:"task_class",type:"input",width:"flex1"},{name:"建设内容",key:"construct_content",type:"input",width:"w300"},{name:"年份",key:"year",type:"input",width:"w100"},{name:"值",key:"value",type:"input",width:"w100"},{name:"操作",key:{add:"新增",del:"删除"},width:"w100"}]}),i=t=>({id:N(),task_type:t,task_class:"",construct_content:"",year:"",value:""}),s=()=>{a.form&&(Array.isArray(a.form.task)||(a.form.task=[]))},u=t=>{if(s(),!t)return;const r=a.form.task;r.some(c=>String(c.task_type)===String(t))||r.push(i(t))};(!a.current||!a.current.value)&&(a.current=k[0]),u(a.current.value),b(()=>a.current?.value,t=>{u(t)},{immediate:!0}),b(()=>a.form?.task,()=>{u(a.current?.value)},{immediate:!0});const o=tt(()=>{const t=a.current?.value,l=(Array.isArray(a.form?.task)?a.form.task:[]).filter(c=>String(c.task_type)===String(t));return l.length>0?l:[i(t)]}),f=w,h=t=>{t&&t.validate(r=>{r&&a.actIndex++})},y=(t,r)=>{if(s(),t==="add")a.form.task.push({id:N(),task_type:a.current.value,task_class:"",construct_content:"",year:"",value:""});else if(t==="del"){const l=a.form.task.indexOf(r);l>-1&&a.form.task.splice(l,1),r.id&&a.http({deleteApi:{model:"t_project_task",list:[r.id]}})}};return(t,r)=>{const l=M,c=U,$=B,C=rt,D=K,E=st,L=at,O=F;return g(),S("div",ot,[d("div",it,[_(O,{class:"ww100 pplr15",ref_key:"formRef",ref:v,model:n(a).form,rules:n(x),"label-width":"120"},{default:m(()=>[d("div",ct,[_(c,{label:"方案名称",prop:"plan_name",class:"ww50 flex-sc"},{default:m(()=>[_(l,{size:"large",modelValue:n(a).form.plan_name,"onUpdate:modelValue":r[0]||(r[0]=p=>n(a).form.plan_name=p),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),_(c,{label:"方案编制单位",prop:"plan_unit",class:"ww50 flex-sc"},{default:m(()=>[_(l,{size:"large",modelValue:n(a).form.plan_unit,"onUpdate:modelValue":r[1]||(r[1]=p=>n(a).form.plan_unit=p),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),_(c,{label:"复批时间",prop:"approval_time",class:"ww50 flex-sc"},{default:m(()=>[_($,{modelValue:n(a).form.approval_time,"onUpdate:modelValue":r[2]||(r[2]=p=>n(a).form.approval_time=p),style:{width:"100%"},size:"large",type:"datetime",placeholder:"请选择",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),_(c,{label:"方案摘要",prop:"plan_abstract",class:"ww100 flex-sc"},{default:m(()=>[_(l,{size:"large",modelValue:n(a).form.plan_abstract,"onUpdate:modelValue":r[3]||(r[3]=p=>n(a).form.plan_abstract=p),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),_(c,{label:"基础建设条件",prop:"condition",class:"ww100 flex-sc"},{default:m(()=>[_(l,{size:"large",modelValue:n(a).form.condition,"onUpdate:modelValue":r[4]||(r[4]=p=>n(a).form.condition=p),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),_(c,{label:"项目任务",prop:"tasks",class:"ww100 flex-ss"},{default:m(()=>[d("div",lt,[(g(),S(J,null,R(k,(p,z)=>d("div",{class:H(["mr40 pb10 f18 relative cursor actfont",n(a).current.value==p.value?"i1 bob-i1-2":"bob-tt-2"]),key:z,onClick:A(dt=>n(a).current={...p},["stop"])},[_(D,{content:p.describe,placement:"top-start"},{reference:m(()=>[d("div",_t,[Z(_(C,null,null,512),[[G,p.describe]])])]),_:2},1032,["content"]),d("span",null,Q(p.name),1)],10,pt)),64))]),_(E,{onHandleClick:y,state:n(j),hasLists:!0,lists:n(o)},null,8,["state","lists"])]),_:1}),_(nt,{"scheme-id":n(a).form.parent_id,"area-value":n(a).form.parent_area,"task-type":n(a).form.task_type,draft:n(a).form,"scheme-plans":n(a)._public?.schemePlans?n(a)._public.schemePlans:[],"scheme-areas":n(a)._public?.schemeAreas?n(a)._public.schemeAreas:[]},null,8,["scheme-id","area-value","task-type","draft","scheme-plans","scheme-areas"]),_(c,{label:"实施方案文件上传",prop:"files",class:"ww100 flex-ss"},{default:m(()=>[n(a).form?.plan_attr?(g(),W(L,{key:0,files:n(a).form.plan_attr,"onUpdate:files":r[5]||(r[5]=p=>n(a).form.plan_attr=p),contents:f.contents,active:f.active},null,8,["files","contents","active"])):X("",!0)]),_:1})])]),_:1},8,["model","rules"]),d("div",ut,[d("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:r[6]||(r[6]=A(p=>n(a).actIndex--,["stop"]))},"上一步"),d("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:r[7]||(r[7]=A(p=>h(n(v)),["stop"]))},"下一步")])])])}}}),It=et(ft,[["__scopeId","data-v-c6a252da"]]);export{It as default};
