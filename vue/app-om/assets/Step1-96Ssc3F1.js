import{_ as B,a as Z,b as G}from"./question-filled-VPZmajOP.js";import{d as D,g as T,r as j,b as J,o as i,c as r,f as t,F as $,p as S,e as N,u as l,y as M,a as m,cU as R,w as E,k as U,v as z,t as v,l as L,E as H,a8 as K,h as V,m as Q,z as O,q as W,i as X,a4 as C,a3 as ee}from"./index-CymMRwSV.js";import{_ as te}from"./ViewFiles-D4O9SnS7.js";import{_ as se}from"./UploadText-Dmmewb7V.js";const le={class:"layout-col"},ae={class:"hh100 flex-col pplr15 hidden"},oe={class:"ww100 flex-sc pt20 pb15 plr15"},ne=["onClick"],ie={class:"absolute f14 t10 r-18"},re={class:"layout-col"},ce=D({__name:"Step2",props:{state:{type:[Object,Array],default:()=>({})}},setup(F){const{proxy:_}=T(),s=_.publicStore();_.configStore();const g=[{value:"1",name:"项目清单"},{value:"2",name:"重点落实项目"}];j({...s.$state});const h=F;return J(async()=>{s.current={...g[0]}}),(o,x)=>{const P=B,Y=R,q=Z,I=G;return i(),r("div",le,[t("div",ae,[t("div",oe,[(i(!0),r($,null,S(h.state.type=="plan"?g:g.filter(n=>n.value=="1"),(n,a)=>(i(),r("div",{class:M(["mr40 ptb10 f18 relative cursor actfont",l(s).current.value==n.value?"i1 bob-i1-2":"bob-tt-2"]),key:a,onClick:N(p=>l(s).current={...n},["stop"])},[m(Y,{content:n.describe,placement:"top-start"},{reference:E(()=>[t("div",ie,[U(m(P,null,null,512),[[z,n.describe]])])]),_:2},1032,["content"]),t("span",null,v(n.name),1)],10,ne))),128))]),t("div",re,[U(m(q,{type:h.state.type},null,8,["type"]),[[z,l(s).current.value=="1"]]),U(m(I,{type:h.state.type},null,8,["type"]),[[z,l(s).current.value=="2"]])])])])}}}),We=L(ce,[["__scopeId","data-v-b46d22dd"]]),pe={class:"layout-col"},de={class:"hh100 flex-col pplr15"},me={key:0,class:"ww100 flex-sc"},_e={class:"flex-sc flex1 mr30"},ue={class:"flex1"},fe={class:"flex-sc flex1 ml30"},ye={class:"flex1"},he={key:1,class:"ww100 flex-sc"},xe={class:"flex-sc flex1 mr30"},we={class:"flex1"},be={class:"flex-sc flex1 ml30"},ve={class:"flex1"},ge={key:2,class:"ww100 flex-sc mt20"},ke={class:"flex-sc flex1 mr30"},Ve={class:"flex1"},$e={class:"flex-sc flex1 ml30"},Se={class:"flex1"},Ae={class:"ww100 flex-sc pt40 pb15 plr15"},Ce=["onClick"],Ne={class:"absolute f14 t10 r-18"},Ee={class:"table flex-sc warp"},Ue={class:"ww100 bs bo-i16-1 relative rad8"},ze={class:"ww100 flex-sc p12 bob-ce-1"},Fe={class:"f15"},Pe={class:"flex1 flex-ec"},Ye={class:"ww100 flex-col p12"},qe={class:"ww100 flex-sc"},Ie={class:"flex1 line1"},Oe={class:"ww100 flex-sc mt12"},Be={class:"flex1 line1"},De={class:"ww100 flex-sc mt12"},Te={class:"flex1 line1"},je={class:"ww100 flex-ec mt12"},Je=["onClick"],Me={key:1,class:"ml12 ca"},Re=["onClick"],Le={key:3,class:"ml12 ca"},Ze=D({__name:"Step1",props:{state:{type:[Object,Array],default:()=>({})}},setup(F){const{proxy:_}=T(),s=_.publicStore(),g=_.configStore();let h=X();const o=j({...s.$state,schemeAreas:[{value:"1",name:"龙城片区"}]}),x=F;J(async()=>{P(),Y()});const P=async()=>{if(x.state.type!="design")return;let n={model:"t_scheme_plan",args:`user_id='${g.user.id}' and type='plan'`,field:"id, name"};s.http({Api:n}).then(a=>{o.schemePlans=_.isNull(a)?[]:a})},Y=async()=>{let n={model:"t_file_type"},a={model:"t_file_content"},p=await s.http({Api1:n,Api2:a}),u=_.isNull(p.Api1)?[]:p.Api1.sort((c,d)=>c.orderd-d.orderd),w=_.isNull(p.Api2)?[]:p.Api2.sort((c,d)=>c.orderd-d.orderd),f=x.state.type=="plan"?"019be0b6-a467-7a5e-8ad9-6ba600813fa5":"019be0b6-e9f9-7081-b4a3-d808e0bc96ca",y=u.find(c=>c.id==f);if(y){let c=[];o.plans=u.filter(d=>d.parent_id==f),o.plans.forEach(d=>{d.parent_type=`${y.type}/${d.type}`;let b=w.filter(e=>e.parent_id==d.id);_.isNull(b)||b.forEach(e=>{e.parent_type=`${d.parent_type}/${e.type}`,c.push(e)})}),o.contents=c,s._public.contents=c,o.active=_.isNull(o.plans)?{}:{...o.plans[0]}}},q=n=>{const p=s.form.attr[n.type].data;h.value.onVisable(p)},I=async n=>{const p=s.form.attr[n.type].data;s.http({deleteFile:{filepath:p}}).then(u=>{if(u=="success"){if(C({title:"提示",message:"删除成功",type:"success"}),delete s.form.attr[n.type],s.form.id){let w={model:"t_scheme_plan",args:`id='${s.form.id}'`};s.http({Api:w}).then(f=>{if(!_.isNull(f)){let y=f[0];if(y.attr){let c=JSON.parse(y.attr);if(c[n.type]){delete c[n.type];let b={model:"t_scheme_plan",list:[{id:s.form.id,attr:JSON.stringify(c)}]};ee.updApi(b).then(e=>{e.code==200?C({title:"提示",message:"清理成功",type:"success"}):C({title:"提示",message:e.msg?e.msg:"清理失败(400)",type:"error"})})}}}})}}else C({title:"提示",message:u.msg?u.msg:"删除失败(400)",type:"error"})})};return(n,a)=>{const p=H,u=K,w=W,f=Q,y=B,c=R,d=se,b=te;return i(),r("div",pe,[t("div",de,[x.state.type=="plan"?(i(),r("div",me,[t("div",_e,[a[7]||(a[7]=t("div",{class:"flex-sc mr20"},[t("span",{class:"mr3 i8 f20"},"*"),t("span",null,"专项规划名称")],-1)),t("div",ue,[m(p,{class:"ww100",modelValue:l(s).form.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l(s).form.name=e),placeholder:"请输入",size:"large"},null,8,["modelValue"])])]),t("div",fe,[a[8]||(a[8]=t("div",{class:"flex-sc mr20"},[t("span",{class:"mr3 i8 f20"},"*"),t("span",null,"规划周期")],-1)),t("div",ye,[m(u,{style:{width:"100%"},modelValue:l(s).form.datetime,"onUpdate:modelValue":a[1]||(a[1]=e=>l(s).form.datetime=e),"start-placeholder":"开始周期","end-placeholder":"结束周期",size:"large",type:"yearrange","value-format":"YYYY",format:"YYYY"},null,8,["modelValue"])])])])):V("",!0),x.state.type=="design"?(i(),r("div",he,[t("div",xe,[a[9]||(a[9]=t("div",{class:"flex-sc mr20"},[t("span",{class:"mr3 i8 f20"},"*"),t("span",{class:"w50x2"},"片区名称")],-1)),t("div",we,[m(p,{class:"ww100",modelValue:l(s).form.name,"onUpdate:modelValue":a[2]||(a[2]=e=>l(s).form.name=e),placeholder:"请输入",size:"large"},null,8,["modelValue"])])]),t("div",be,[a[10]||(a[10]=t("div",{class:"flex-sc mr20"},[t("span",{class:"mr3 i8 f20"},"*"),t("span",{class:"w50x2"},"片区编号")],-1)),t("div",ve,[m(p,{class:"ww100",modelValue:l(s).form.num,"onUpdate:modelValue":a[3]||(a[3]=e=>l(s).form.num=e),placeholder:"请输入英文或数字",size:"large",onInput:a[4]||(a[4]=e=>l(s).form.num=l(s).form.num.replace(/[^a-zA-Z0-9]/g,""))},null,8,["modelValue"])])])])):V("",!0),x.state.type=="design"?(i(),r("div",ge,[t("div",ke,[a[11]||(a[11]=t("div",{class:"flex-sc mr20"},[t("span",{class:"mr3 i8 f20"},"*"),t("span",{class:"w50x2"},"所属专项规划")],-1)),t("div",Ve,[m(f,{modelValue:l(s).form.parent_id,"onUpdate:modelValue":a[5]||(a[5]=e=>l(s).form.parent_id=e),placeholder:"请选择",size:"large",style:{width:"100%"},filterable:"",clearable:""},{default:E(()=>[(i(!0),r($,null,S(l(o).schemePlans?l(o).schemePlans:[],(e,k)=>(i(),O(w,{key:e.id,value:String(e.id),label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),t("div",$e,[a[12]||(a[12]=t("div",{class:"flex-sc mr20"},[t("span",{class:"mr3 i8 f20"},"*"),t("span",{class:"w50x2"},"所属专项片区")],-1)),t("div",Se,[m(f,{modelValue:l(s).form.parent_area,"onUpdate:modelValue":a[6]||(a[6]=e=>l(s).form.parent_area=e),placeholder:"请选择",size:"large",style:{width:"100%"},filterable:"",clearable:""},{default:E(()=>[(i(!0),r($,null,S(l(o).schemeAreas?l(o).schemeAreas:[],(e,k)=>(i(),O(w,{key:e.value,value:String(e.value),label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])])):V("",!0),t("div",Ae,[(i(!0),r($,null,S(l(o).plans?l(o).plans:[],(e,k)=>(i(),r("div",{class:M(["mr40 ptb10 f18 relative cursor actfont",l(o).active.name==e.name?"i1 bob-i1-2":"bob-tt-2"]),key:k,onClick:N(A=>l(o).active={...e},["stop"])},[m(c,{content:e.describe,placement:"top-start"},{reference:E(()=>[t("div",Ne,[U(m(y,null,null,512),[[z,e.describe]])])]),_:2},1032,["content"]),t("span",null,v(e.name),1)],10,Ce))),128))]),t("div",Ee,[l(o).active&&l(s).form.attr?(i(!0),r($,{key:0},S(l(o).contents?l(o).contents.filter(e=>e.parent_id==l(o).active.id):[],(e,k)=>(i(),r("div",{class:"ww25 cursor p8",key:k},[t("div",Ue,[t("div",ze,[t("span",Fe,v(e.name),1),t("span",Pe,[e.type?(i(),O(d,{key:0,model:l(s).form.attr[e.type],"onUpdate:model":A=>l(s).form.attr[e.type]=A},null,8,["model","onUpdate:model"])):V("",!0)])]),t("div",Ye,[t("div",qe,[a[13]||(a[13]=t("span",{class:"w90 c8"},"上传状态",-1)),t("span",Ie,v(l(s).form.attr[e.type]&&l(s).form.attr[e.type].status?l(s).form.attr[e.type].status=="success"?"成功":"失败":"-"),1)]),t("div",Oe,[a[14]||(a[14]=t("span",{class:"w90 c8"},"文件类型",-1)),t("span",Be,v(l(s).form.attr[e.type]&&l(s).form.attr[e.type].type?l(s).form.attr[e.type].type:"-"),1)]),t("div",De,[a[15]||(a[15]=t("span",{class:"w90 c8"},"上传时间",-1)),t("span",Te,v(l(s).form.attr[e.type]&&l(s).form.attr[e.type].time?n.parseTime(l(s).form.attr[e.type].time):"-"),1)]),t("div",je,[l(s).form.attr[e.type]?(i(),r("span",{key:0,class:"ml12 i1",onClick:N(A=>q(e),["stop"])},"预览",8,Je)):(i(),r("span",Me,"预览")),l(s).form.attr[e.type]?(i(),r("span",{key:2,class:"ml12 i9",onClick:N(A=>I(e),["stop"])},"删除",8,Re)):(i(),r("span",Le,"删除"))])])])]))),128)):V("",!0)])]),m(b,{ref_key:"viewRef",ref:h},null,512)])}}}),Xe=L(Ze,[["__scopeId","data-v-d7d220d9"]]);export{Xe as _,We as a};
