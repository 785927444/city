import{d as E,g as I,b as B,aq as C,o as c,c as d,a as o,w as _,f as s,t as D,k as S,r as z,i as R,a3 as A,n as M,K as N,e as T,dj as L,l as O}from"./index-BF5jje68.js";import{v as P}from"./el-loading-DNd19Xuc.js";/* empty css                        *//* empty css                    */import{_ as U}from"./AaTitle.vue_vue_type_script_setup_true_lang-msvlqApB.js";import{au as f,h as V}from"./index-Da8m4HG1.js";import"./linesGL-hPiCY4Q-.js";import{E as j,a as q}from"./index-fed1VsgQ.js";import"./index-VYQ43fvS.js";function F(r,{title:m="",seriesData:l=[]}){return new Promise(p=>{f(r)&&f(r).dispose();var t=V(r,"light");t.setOption({title:{text:m||""},legend:{show:!0,bottom:"bottom"},toolbox:{show:!0,feature:{saveAsImage:{title:"保存"}}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"详情",type:"pie",roseType:"area",startAngle:10,radius:[40,90],itemStyle:{borderRadius:5},label:{show:!0,formatter:`{b}
{num|{c}}`,rich:{num:{align:"center"}},textBorderWidth:0},data:l||[],animationEasing:"cubicInOut",animationDuration:1e3}]}),p(t)})}const K={class:"layout-col"},W={class:"layout-row flex1 hidden"},$={class:"flex1 layout-col",style:{"min-height":"0"}},G={class:"bg-white rad8 p15 mb15"},H={class:"flex-bc"},J={class:"i2"},Q={class:"bg-white rad8 p15 flex1 hidden table-col",style:{"min-height":"0"}},X={class:"layout-col ml15",style:{width:"360px","min-height":"0"}},Y={class:"bg-white rad8 p15"},Z={key:0,class:"i2"},tt=E({__name:"Manage",setup(r){const{proxy:m}=I(),l=m.configStore(),p=L(),t=z({loading:!1,items:[],stats:[],total:0}),u=R(null);let a=null;const w=N(()=>String(l?.user?.id??l?.user??"").trim()||"anonymous"),b=async()=>{if(!u.value)return;if(!t.stats.length){a?.dispose&&a.dispose(),a=null;return}const i=t.stats.map(e=>({name:String(e?.name??""),value:Number(e?.value??0)}));a=await F(u.value,{title:"分类统计",seriesData:i})},g=async()=>{t.loading=!0;try{const i=await A.kbAdminUserFavoritesApi({user_id:w.value}),e=i?.data??i;t.items=e?.items||[],t.stats=e?.stats||[],t.total=Number(e?.total??t.items.length??0),await M(),await b()}catch{t.items=[],t.stats=[],t.total=0}finally{t.loading=!1}},h=()=>{a?.resize&&a.resize()};B(async()=>{await g(),window.addEventListener("resize",h)}),C(()=>{window.removeEventListener("resize",h),a?.dispose&&a.dispose()});const v=()=>{p.back()};return(i,e)=>{const y=U,n=q,x=j,k=P;return c(),d("div",K,[o(y,{title:"知识库管理后台"},{"right-content":_(()=>[s("div",{class:"rad4 ptb5 plr8 flex-cc cursor bgi1 white ml10",onClick:T(v,["stop"])},"返回")]),_:1}),s("div",W,[s("div",$,[s("div",G,[s("div",H,[e[0]||(e[0]=s("div",{class:"fw f16"},"个人收藏统计",-1)),s("div",J,"共 "+D(t.total)+" 条",1)])]),S((c(),d("div",Q,[o(x,{data:t.items,style:{width:"100%"}},{default:_(()=>[o(n,{prop:"title",label:"标题","show-overflow-tooltip":""}),o(n,{prop:"column_name",label:"分类",width:"140","show-overflow-tooltip":""}),o(n,{prop:"publish_time",label:"发布时间",width:"120"}),o(n,{prop:"download_count",label:"下载",width:"80"}),o(n,{prop:"favorite_count",label:"收藏",width:"80"}),o(n,{prop:"favorited_at",label:"收藏时间",width:"160"})]),_:1},8,["data"])])),[[k,t.loading]])]),s("div",X,[e[1]||(e[1]=s("div",{class:"bg-white rad8 p15 mb15"},[s("div",{class:"fw f16"},"分类统计")],-1)),s("div",Y,[t.stats.length?(c(),d("div",{key:1,ref_key:"chartRef",ref:u,class:"kb-chart"},null,512)):(c(),d("div",Z,"暂无统计"))])])])])}}}),dt=O(tt,[["__scopeId","data-v-fe3f2e85"]]);export{dt as default};
