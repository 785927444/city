import{_ as g}from"./Add-D2-IK3J2.js";import{_ as v}from"./Pagination.vue_vue_type_style_index_0_lang-u8YgO5nZ.js";import{_ as b}from"./List.vue_vue_type_script_setup_true_lang-GWlOrLxS.js";import{_ as C}from"./AaTitle.vue_vue_type_script_setup_true_lang-DQZ6AruM.js";import{d as x,g as q,r as $,b as N,j as S,o as u,c as y,a as d,w as m,u as a,e as I,_ as O,f,t as V,h as j,k as M,v as B,i as D,n as E}from"./index-ClTGGYJq.js";const P={class:"layout-col"},A={class:"f14 ml2"},F={class:"layout-col white-rgba50 rad8 p15"},G=x({__name:"m2",setup(R){const{proxy:s}=q(),n=s.publicStore();s.configStore(),s.dictStore();let c=D();const e=$({...n.$state,content:[{width:"w70",show:!0,align:"center",key:"*",name:"序号"},{width:"w50x5",show:!0,align:"left",key:"adcode",name:"区域",type:"select",list:[],value:"adcode",label:"name"},{width:"w50x5",show:!0,align:"left",key:"year",name:"年份",type:"select",list:[],value:"value",label:"name"},{width:"w50x5",show:!0,align:"left",key:"value",name:"CO2因子"},{width:"w50x5",show:!0,align:"left",key:"order",name:"排序"},{width:"flex1",show:!0,align:"right",key:{add:"添加",upd:"编辑",del:"删除"},name:"操作"}],editFrom:[{required:!0,editshow:"none",name:"上级",key:"parent_id",type:"input"},{required:!0,editshow:"none",name:"特征码",key:"code",type:"input"},{required:!0,editshow:!0,name:"区域",key:"adcode",type:"select",list:[],value:"adcode",label:"name"},{required:!0,editshow:!0,name:"年份",key:"year",type:"select",list:[],value:"value",label:"name"},{required:!1,editshow:!0,name:"数值",key:"value",type:"input"},{required:!1,editshow:!0,name:"排序",key:"order",type:"input"}],addItem:{}});N(async()=>{let i=s.parseTime(new Date,"{y}"),t=[];for(let r=0;r<5;r++){let l=i-r;t.push({name:l+"年",value:l})}e.year=i,e.years=t}),S(()=>n.active,async i=>{await E(),!s.isNull(i)&&(e.addItem={parent_id:n.active.id,type:1,code:"CO2"},e.content.forEach(t=>{t.key=="adcode"&&(t.list=n._public.provinces),t.key=="year"&&(t.list=e.years)}),e.editFrom.forEach(t=>{t.key=="adcode"&&(t.list=n._public.provinces),t.key=="year"&&(t.list=e.years)}),p())},{immediate:!1,deep:!0});const p=async()=>{let i=e.year?`type='1' and code='CO2' and parent_id='${n.active.id}' and year=${e.year}`:`type='1' and code='CO2' and parent_id='${n.active.id}'`;e.query={model:e.model,args:i},e.params={Api:e.query};let t=await n.http(e.params);e.empty=!!s.isNull(t),e.list=s.isNull(t)?[]:t.sort((r,l)=>r.order-l.order)},_=async(i,t)=>{(i=="add"||i=="upd")&&c.value.onVisable(t),i=="del"&&c.value.del(t)};return(i,t)=>{const r=O,l=C,w=b,h=v,k=g;return u(),y("div",P,[d(l,{title:i.isNull(a(n).active)?"":a(n).active.name},{"left-content":m(()=>[...t[3]||(t[3]=[])]),"right-content":m(()=>[a(e).content.find(o=>typeof o.key=="object")&&a(e).content.find(o=>typeof o.key=="object").key.hasOwnProperty("add")?(u(),y("div",{key:0,class:"rad4 ptb5 plr8 flex-cc cursor bgi1 white ml10",onClick:t[0]||(t[0]=I(o=>a(c).onVisable(a(e).addItem),["stop"]))},[d(r,{class:"f12 fw"}),f("span",A,V(a(e).content.find(o=>typeof o.key=="object").key.add),1)])):j("",!0)]),_:1},8,["title"]),f("div",F,[d(w,{onHandleClick:_,state:a(e)},null,8,["state"]),M(d(h,{class:"",style:{"padding-bottom":"0"},total:a(e).total,page:a(e).page,"onUpdate:page":t[1]||(t[1]=o=>a(e).page=o),pageModifiers:{sync:!0},limit:a(e).limit,"onUpdate:limit":t[2]||(t[2]=o=>a(e).limit=o),limitModifiers:{sync:!0},onPagination:p},null,8,["total","page","limit"]),[[B,a(e).total>0]])]),d(k,{onInit:p,state:a(e),ref_key:"addRef",ref:c},null,8,["state"])])}}});export{G as _};
