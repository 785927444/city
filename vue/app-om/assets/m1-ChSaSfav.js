import{_ as A}from"./AaTitle.vue_vue_type_script_setup_true_lang-msvlqApB.js";import{_ as B}from"./filter-BWaskIWj.js";import{d as T,g as U,r as q,b as I,o as u,c as w,a as y,w as k,f as s,m as J,u as r,F as b,p as g,z as V,q as F,a8 as M,e as x,t as m,y as N,l as P}from"./index-BF5jje68.js";const z={class:"layout-col"},L={class:"flex-sc mr30"},Y={class:"w50x3"},G={class:"flex-sc mr30"},H={class:"w50x3"},K={class:"flex-sc mr30"},Q={class:"w50x3"},R={class:"flex-sc mr15"},W={class:"w50x3"},X={class:"layout-col bg-white rad8 p8"},Z={class:"ww100 flex-sc p8"},ee={class:"flex-sc fw f16 tc"},te=["onClick"],se={class:"mb5"},ae={class:"table flex-sc warp"},le={class:"ww100 bs bo-i16-1 relative rad8"},ne={class:"ww100 flex-sc p12 bob-ce-1"},ie={class:"f15"},oe={class:"flex1 flex-ec"},re=["onClick"],ce={class:"ww100 flex-sc"},de={class:"ww100 flex-sc mt10"},pe={class:"ww100 flex-sc mt10"},ue={class:"ww100 flex-sc mt10"},me={class:"ww100 flex-sc mt10"},_e=T({__name:"m1",setup(fe){const{proxy:p}=U(),_=p.publicStore(),f=p.configStore();p.dictStore();const $=[{value:"0",name:"待体检"},{value:"1",name:"已体检"}],C=[{value:"0",name:"城市自体检"},{value:"1",name:"城市自体检"}],v=[{type:"problem",name:"问题清单跟踪",path:"/problemTrack"}],a=q({..._.$state,click:!1,clickArr:[],status:"1",type:"problem",provinces:[],province:"",citys:[],city:""});I(async()=>{await D(),S()});const D=async()=>{a.provinces=[{name:f.user.province_name,value:f.user.province}],a.province=a.provinces[0].value;let c=f.user.parent_id=="0"?{model:"t_station",args:`parent_id='${f.user.station_num}'`}:{model:"t_station",args:`id='${f.user.station_num}'`},e=await _.http({Api:c}),i=p.isNull(e)?[]:e.sort((d,l)=>d.order-l.order);a.citys=i.map(d=>({name:d.station_name,value:d.city})),!p.isNull(a.citys)&&f.user.parent_id!="0"&&(a.city=a.citys[0].value)},S=async c=>{let e={model:"t_scheme_plan"};if(a.province){if(e.args=`province='${a.province}'`,a.city&&(e.args+=` and city='${a.city}'`),!p.isNull(a.datetime)){const l=new Date(a.datetime).getFullYear(),o=new Date(l,0,1).getTime()+"",h=new Date(l+1,0,1).getTime()-1+"";e.args+=` and check_time>='${o}' and check_time<='${h}'`}a.check_status&&(e.args+=` and check_status='${a.check_status}'`)}let i=await _.http({Api:e}),d=p.isNull(i)?[]:i;a.list=d.map(l=>{try{l.datetime?(l.datetime=JSON.parse(l.datetime),l.datetime=`${l.datetime[0]}-${l.datetime[1]}`):l.datetime="",l.attr=l.attr?JSON.parse(l.attr):{},l.project=l.project?JSON.parse(l.project):[],l.task=l.task?JSON.parse(l.task):[]}catch(o){console.error("解析失败:",o.message)}return l}),j(),E()},j=()=>{let c=a.list.filter(i=>i.release_status=="1"),e={sum:a.list.length,release:c.length};_._public.percent=e.sum?Math.floor(e.release/e.sum*100)/100:0,_._public.data1=e},E=async()=>{let e={model:"t_scheme_design",field:"parent_id, COUNT(*) AS design_num",args:`parent_id  IN (${a.list.map(o=>`'${o.id}'`).join(", ")})`,group:"parent_id"},i=await _.http({Api:e}),d=p.isNull(i)?[]:i,l=[{name:"第三方体检",data:[]},{name:"城市体检",data:[]}];a.list.forEach(o=>{let h="0",t=d.find(n=>n.parent_id==o.id);t&&(h=t.design_num),l.forEach(n=>{n.name=="第三方体检"&&(n.data=[...n.data,[p.decrypt(o.user_name),h]]),n.name=="城市体检"&&(n.data=[...n.data,[p.decrypt(o.user_name),o.project?o.project.length:"0"]])})}),_._public.responses=l};return(c,e)=>{const i=F,d=J,l=M,o=B,h=A;return u(),w("div",z,[y(h,{title:""},{"left-content":k(()=>[s("div",L,[e[5]||(e[5]=s("span",{class:"mr10"},"行政区域",-1)),s("span",Y,[y(d,{modelValue:r(a).province,"onUpdate:modelValue":e[0]||(e[0]=t=>r(a).province=t),placeholder:"请选择",style:{width:"100%"},filterable:""},{default:k(()=>[(u(!0),w(b,null,g(r(a).provinces,(t,n)=>(u(),V(i,{key:t.value,value:String(t.value),label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),s("div",G,[e[6]||(e[6]=s("span",{class:"mr10"},"体检地市",-1)),s("span",H,[y(d,{modelValue:r(a).city,"onUpdate:modelValue":e[1]||(e[1]=t=>r(a).city=t),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:r(f).user.parent_id=="0"},{default:k(()=>[(u(!0),w(b,null,g(r(a).citys,(t,n)=>(u(),V(i,{key:t.value,value:String(t.value),label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","clearable"])])]),s("div",K,[e[7]||(e[7]=s("span",{class:"mr10"},"体检年份",-1)),s("span",Q,[y(l,{modelValue:r(a).datetime,"onUpdate:modelValue":e[2]||(e[2]=t=>r(a).datetime=t),type:"year",placeholder:"请选择",style:{width:"100%"}},null,8,["modelValue"])])]),s("div",R,[e[8]||(e[8]=s("span",{class:"mr10"},"体检状态",-1)),s("span",W,[y(d,{modelValue:r(a).check_status,"onUpdate:modelValue":e[3]||(e[3]=t=>r(a).check_status=t),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:k(()=>[(u(),w(b,null,g($,(t,n)=>y(i,{key:t.value,value:String(t.value),label:t.name},null,8,["value","label"])),64))]),_:1},8,["modelValue"])])]),s("div",{class:"rad4 ptb6 plr12 flex-cc cursor bgi1 white",onClick:e[4]||(e[4]=x(t=>S(),["stop"]))},[y(o,{class:"f12 fw"}),e[9]||(e[9]=s("span",{class:"f14 ml5"},"搜索",-1))])]),"right-content":k(()=>[...e[10]||(e[10]=[])]),_:1}),s("div",X,[s("div",Z,[s("div",ee,[(u(),w(b,null,g(v,(t,n)=>s("div",{class:"mr20 cursor flex-col-cc",key:n,onClick:x(O=>c.toPath(t.path),["stop"])},[s("span",se,m(t.name),1),s("span",{class:N(["ww100 h3 rad10",t.type==r(a).type?"bgi2":"black-rgba0"])},null,2)],8,te)),64))]),e[11]||(e[11]=s("div",{class:"flex-ec flex1"},null,-1))]),s("div",ae,[(u(!0),w(b,null,g(r(a).list,(t,n)=>(u(),w("div",{class:"ww25 cursor p8",key:n},[s("div",le,[s("div",ne,[s("span",ie,m(t.name),1),s("span",oe,[s("span",{class:N(["hh100 flex-cc ptb5 plr12 rad5 hidden",t.check_status=="0"?"bge c9 bo-c9-1":t.check_status=="1"?"bgi10 i12 bo-i11-1":""])},m(c.find($,["value",t.check_status],"name")),3)])]),s("div",{class:"ww100 flex-col p12 c6",onClick:x(O=>c.toPath("/problemBank",{id:t.id}),["stop"])},[s("div",ce,[e[12]||(e[12]=s("span",{class:"w50x3"},"最后体检时间",-1)),s("span",null,m(t.check_time?c.parseTime(t.check_time):"2026-01-30 12:30:30"),1)]),s("div",de,[e[13]||(e[13]=s("span",{class:"w50x3"},"最新体检达标率",-1)),s("span",null,m(t.check_rate?t.check_rate:"80")+" %",1)]),s("div",pe,[e[14]||(e[14]=s("span",{class:"w50x3"},"最近问题数量",-1)),s("span",null,m(t.check_problem_num?t.check_problem_num:"10"),1)]),s("div",ue,[e[15]||(e[15]=s("span",{class:"w50x3"},"体检类型",-1)),s("span",null,m(t.check_type?c.find(C,["value",t.check_type],"name"):"城市自体检"),1)]),s("div",me,[e[16]||(e[16]=s("span",{class:"w50x3"},"体检单位",-1)),s("span",null,m(t.user_name?c.decrypt(t.user_name):"-"),1)])],8,re)])]))),128))])])])}}}),ke=P(_e,[["__scopeId","data-v-dea25223"]]);export{ke as default};
