import{d as F,g as T,r as V,b as E,o as u,c as f,f as n,u as r,h as y,e as g,t as w,a as c,k,v as x,w as b,a0 as J,a1 as O,a2 as A,a9 as v,a4 as m,a3 as I}from"./index-BF5jje68.js";import{_ as q,a as D,b as M}from"./Step1-Ba5iP9AQ.js";import{_ as P}from"./stepTitle.vue_vue_type_script_setup_true_lang-Co0vvQUk.js";import"./v6-B4YtUg27.js";/* empty css                    */import"./excelTools-PNB7aBDP.js";import"./xlsx-CaORBL06.js";import"./index-CU8Q0z-M.js";import"./List.vue_vue_type_script_setup_true_lang-CRJw57K5.js";import"./el-image-viewer-DMRq40TL.js";import"./el-switch-DkPm2rNO.js";import"./select-CBJjauee.js";import"./question-filled-BgQjHn-S.js";/* empty css                   */import"./index-CND7x1jx.js";/* empty css                                                                   */import"./ViewFiles-C92c8QO4.js";const z={class:"layout-col plr15"},R={class:"layout-col white-rgba50 rad8"},U={class:"ww100 flex-bc f20 p15 mb20 bob-cd-1"},G={class:"flex1 flex-ec"},H={key:0,class:"plr14 ptb5 rad4 mr15 cursor c9 bg-white bo-c9-1"},K={class:"layout-col"},L={class:"f20 ww100 tc ptb30 flex-col-cc"},Q={class:"mt10"},W={class:"dialog-footer"},ft=F({__name:"index",setup(X){const{proxy:l}=T(),t=l.publicStore(),h=l.configStore(),a=V({...t.$state,model:"t_scheme_plan",type:"plan"});E(async()=>{t.actIndex=1,t.form={attr:{},project:[],task:[]},t._public.project=[],t._public.task=[];let s={model:"t_scheme_plan",args:`user_id='${h.user.id}' and release_status='0' and type='${a.type}'`},e=await t.http({Api:s});l.isNull(e)||(d(e[0].id),a.name=e[0].name,a.isFalse=!a.isFalse)});const d=async s=>{let e=s?{model:a.model,args:`id='${s}'`}:{model:a.model,args:`user_id='${h.user.id}' and type='${a.type}'`},i=await t.http({Api:e});if(l.isNull(i))t.form={attr:{},project:[],task:[]},t._public.project=[],t._public.task=[];else{let o=i[0];S(o),N(o);try{o.datetime=o.datetime?JSON.parse(o.datetime):"",o.attr=o.attr?JSON.parse(o.attr):{}}catch(_){console.error("解析失败:",_.message)}t.form={...o}}console.log("publicStore.form",t.form)},S=s=>{let e={model:"t_scheme_project",args:`scheme_id='${s.id}'`};t.http({Api:e}).then(i=>{s.project=l.isNull(i)?[]:[...i],s.project.forEach(o=>{o.construct_datetime=`${o.construct_datetime_start||""} ~ ${o.construct_datetime_end||""}`}),t.form.project=[...s.project],t._public.project=JSON.parse(JSON.stringify(s.project))})},N=s=>{let e={model:"t_scheme_task",args:`scheme_id='${s.id}'`};t.http({Api:e}).then(i=>{s.task=l.isNull(i)?[]:[...i],t.form.task=[...s.task],t._public.task=JSON.parse(JSON.stringify(s.task))})},$=()=>{let s=t.form.id?"正在编辑中,是否确定退出?":"正在编辑中,信息未保存是否确定退出?";v.confirm(s,"温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{l.toPath("/schemePlansManagerCity")})},j=async()=>{if(!t.form.id)return m({title:"提示",message:"请先保存数据(440)",type:"error"});v.confirm("上报需等待审核!","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{const s=new Date().getTime();let i={model:"t_scheme_plan",list:[{id:t.form.id,release_status:"1",release_time:s,examine_status:"0"}]};I.updApi(i).then(o=>{o.code==200?(m({title:"提示",message:"上报成功",type:"success"}),d()):m({title:"提示",message:o.msg?o.msg:"上报失败(400)",type:"error"})}).catch(o=>{m({title:"提示",message:"上报失败(500)",type:"error"})})})};return(s,e)=>{const i=q,o=D,_=M,B=J,C=A;return u(),f("div",z,[n("div",R,[n("div",U,[e[4]||(e[4]=n("div",{class:"fw"},"专项规划上报",-1)),n("div",G,[r(t).form.id?y("",!0):(u(),f("div",H,"上 报")),r(t).form.id?(u(),f("div",{key:1,class:"plr14 ptb5 rad4 mr15 cursor white bgi1",onClick:e[0]||(e[0]=g(p=>j(),["stop"]))},w(r(t).form.release_status!="1"?"上报":"重新上报"),1)):y("",!0),n("div",{class:"plr14 ptb5 rad4 mr15 cursor c9 bg-white bo-c9-1",onClick:e[1]||(e[1]=g(p=>$(),["stop"]))},"返 回")])]),n("div",K,[c(r(P)),k(c(i,{state:r(a)},null,8,["state"]),[[x,r(t).actIndex==1]]),k(c(o,{state:r(a)},null,8,["state"]),[[x,r(t).actIndex==2]]),c(_,{state:r(a),onInit:d},null,8,["state"])])]),c(C,{modelValue:r(a).isFalse,"onUpdate:modelValue":e[3]||(e[3]=p=>r(a).isFalse=p),title:"提示",draggable:!0,width:"30%"},{footer:b(()=>[n("div",W,[c(B,{size:"large",class:"bgi1 white",onClick:e[2]||(e[2]=g(p=>r(a).isFalse=!r(a).isFalse,["stop"]))},{default:b(()=>[...e[6]||(e[6]=[O("确 定",-1)])]),_:1})])]),default:b(()=>[n("div",L,[e[5]||(e[5]=n("span",null,"你有专项规划需要上报",-1)),n("span",Q,"完成【"+w(r(a).name)+"】上报后可新增",1)])]),_:1},8,["modelValue"])])}}});export{ft as default};
