import{d as O,g as q,r as B,o as c,c as u,a as o,a2 as D,u as a,w as d,f as n,a8 as I,m as L,F as M,p as T,z as N,q as P,E as z,e as C,k as S,t as f,h as g,v as K,a4 as R}from"./index-Bd85TTIS.js";import{v as G}from"./el-loading-QtaFgzrj.js";import{_ as H}from"./ViewFiles-DMp3eGxU.js";import{_ as J}from"./Pagination.vue_vue_type_style_index_0_lang-C7tlSLth.js";/* empty css                        *//* empty css                    */import{_ as Q}from"./AaTitle.vue_vue_type_script_setup_true_lang-DNddMUg2.js";import{E as W,a as X}from"./index-CohXJBWb.js";const Z={class:"topclass"},tt={class:"ww100 h100x6 flex-col hidden"},et={class:"flex-sc"},st={class:"flex-sc mr30"},at={class:"w50x4 flex-sc"},ot={class:"flex-sc mr30"},nt={class:"w50x3 flex-sc"},lt={class:"flex-sc mr15"},it={class:"w50x3 flex-sc"},rt={class:"layout-col white-rgba50 rad8 p15"},ct={key:0},dt={key:1},pt={key:2},_t={key:0,class:""},mt=["onClick"],$t=O({__name:"projects",props:{state:{type:[Object,Array],default:()=>({})}},emits:["init"],setup(ut,{expose:j,emit:ft}){const{proxy:p}=q(),y=p.publicStore();p.configStore();const A=p.dictStore(),t=B({...y.$state,ruleList:{}}),U=_=>parseInt(t.page)+_,x=async _=>{t.isFalse=!t.isFalse,t.isFalse&&(t.active={..._},k())},k=async _=>{let r={model:"t_scheme_project p",field:"p.*, sp.name as schemeName, sp.parent_area",join:"t_scheme_plan sp ON p.scheme_id = sp.id",args:"sp.release_status = '1'"};if(t.province){if(r.args+=` and sp.province='${t.province}'`,t.city&&(r.args+=` and sp.city='${t.city}'`),!p.isNull(t.construct_datetime)){const[i,V]=t.construct_datetime;r.args+=` and p.construct_datetime_start>='${i}' and p.construct_datetime_end<='${V}'`}t.completion_status&&(r.args+=` and p.completion_status='${t.completion_status}'`),t.search&&(r.args+=` and p.name LIKE '%${t.search}%'`)}let v={limit:t.limit,page:t.page},l={field:"COUNT(*)"},h={},b={};Object.assign(h,r,v),Object.assign(b,r,l);let m=await y.http({Api1:h,Api2:b});t.total=p.isNull(m.Api2)?0:m.Api2[0]["COUNT(*)"],t.empty=!!p.isNull(m.Api1),t.list=p.isNull(m.Api1)?[]:m.Api1,t.list.forEach(i=>{i.area=(i.province_name||"")+(i.city_name?`-${i.city_name}`:"")+(i.district_name?`-${i.district_name}`:"")})},Y=(_,e)=>{{let w={num:e.num,name:e.name,task_type:e.task_type,construct_scale:e.construct_scale,construct_nature:e.construct_nature,construct_price:e.construct_price,construct_datetime_start:e.construct_datetime_start,construct_datetime_end:e.construct_datetime_end};y.form={...y.form,...w},R({title:"提示",message:"导入成功",type:"success"}),x()}};return j({onVisable:x}),(_,e)=>{const w=I,F=P,E=L,r=z,v=Q,l=W,h=X,b=J,m=H,i=D,V=G;return c(),u("div",Z,[o(i,{"modal-class":"topclass",modelValue:a(t).isFalse,"onUpdate:modelValue":e[6]||(e[6]=s=>a(t).isFalse=s),title:"项目列表","before-close":x,draggable:!0,width:"65%"},{default:d(()=>[n("div",tt,[o(v,{title:""},{"left-content":d(()=>[n("div",et,[n("div",st,[e[7]||(e[7]=n("span",{class:"mr10"},"项目周期",-1)),n("span",at,[o(w,{style:{width:"100%"},modelValue:a(t).construct_datetime,"onUpdate:modelValue":e[0]||(e[0]=s=>a(t).construct_datetime=s),"start-placeholder":"开始周期","end-placeholder":"结束周期",type:"yearrange","value-format":"YYYY",format:"YYYY"},null,8,["modelValue"])])]),n("div",ot,[e[8]||(e[8]=n("span",{class:"mr10"},"实施状态",-1)),n("span",nt,[o(E,{modelValue:a(t).completion_status,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).completion_status=s),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:d(()=>[(c(!0),u(M,null,T(a(A).project_completion_statuss,(s,$)=>(c(),N(F,{key:s.value,value:String(s.value),label:s.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),n("div",lt,[e[9]||(e[9]=n("span",{class:"mr10"},"项目名称",-1)),n("span",it,[o(r,{modelValue:a(t).search,"onUpdate:modelValue":e[2]||(e[2]=s=>a(t).search=s),style:{width:"100%"},placeholder:"请输入"},null,8,["modelValue"])])]),n("div",{class:"rad4 ptb5 w80 flex-cc cursor bgi1 white ml10",onClick:e[3]||(e[3]=C(s=>{a(t).page=1,k()},["stop"]))},"搜索")])]),"right-content":d(()=>[...e[10]||(e[10]=[])]),_:1}),n("div",rt,[_.isNull(a(t).list)?g("",!0):S((c(),N(h,{key:0,"header-cell-class-name":"bgi16 c3","cell-style":{"background-color":"#FFFFFF",color:"#626366"},border:"","empty-text":"暂无数据",data:a(t).list,stripe:""},{default:d(()=>[o(l,{type:"index",index:U,label:"序号",align:"center",width:"50"}),o(l,{prop:"name",label:"项目名称"}),o(l,{label:"地区",align:"center",width:"140"},{default:d((s,$)=>[s.row.province_name?(c(),u("span",ct,f(s.row.province_name),1)):g("",!0),s.row.city_name?(c(),u("span",dt,"-"+f(s.row.city_name),1)):g("",!0),s.row.district_name?(c(),u("span",pt,"-"+f(s.row.district_name),1)):g("",!0)]),_:1}),o(l,{prop:"construct_scale",label:"建设规模",width:"100",align:"center"}),o(l,{prop:"construct_nature",label:"建设性质",width:"100",align:"center"}),o(l,{prop:"construct_price",label:"投资预估(万元)",width:"100",align:"center"}),o(l,{label:"项目周期",align:"center",width:"100"},{default:d((s,$)=>[s.row.construct_datetime_start&&s.row.construct_datetime_end?(c(),u("span",_t,f(s.row.construct_datetime_start)+" ~ "+f(s.row.construct_datetime_end),1)):g("",!0)]),_:1}),o(l,{label:"操作",align:"center",width:"100"},{default:d((s,$)=>[n("span",{class:"i1 cursor",onClick:C(gt=>Y("exportdata",s.row),["stop"])},"导入",8,mt)]),_:1})]),_:1},8,["data"])),[[V,a(t).loading,void 0,{fullscreen:!0,lock:!0}]]),S(o(b,{class:"",style:{"padding-bottom":"0"},total:a(t).total,page:a(t).page,"onUpdate:page":e[4]||(e[4]=s=>a(t).page=s),pageModifiers:{sync:!0},limit:a(t).limit,"onUpdate:limit":e[5]||(e[5]=s=>a(t).limit=s),limitModifiers:{sync:!0},onPagination:k},null,8,["total","page","limit"]),[[K,a(t).total>0]])])]),o(m,{ref:"viewRef"},null,512)]),_:1},8,["modelValue"])])}}});export{$t as _};
