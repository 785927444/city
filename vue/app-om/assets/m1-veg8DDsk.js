import{_ as B}from"./check-BI2Kx_Kg.js";import{_ as Y}from"./AaTitle.vue_vue_type_script_setup_true_lang-Dok3GIN-.js";import{_ as U}from"./filter-CFoa9Riw.js";import{d as P,g as q,aa as z,r as H,b as J,o as d,c as _,a as f,w as b,f as t,A as T,u as r,F as k,q as x,x as h,z as F,B as L,e as g,t as w,p as C,h as R,ac as G,a8 as N,l as K}from"./index-BWjCSAnw.js";const Q={class:"layout-col"},W={class:"flex-sc mr30"},X={class:"w50x3"},Z={class:"flex-sc mr30"},ee={class:"w50x3"},te={class:"flex-sc mr30"},se={class:"w50x8"},ae={class:"flex-sc mr15"},le={class:"w50x3"},ne={class:"layout-col bg-white rad8 p8"},ie={class:"ww100 flex-sc p8"},oe={class:"flex-sc fw f16 tc"},re=["onClick"],ce={class:"mb5"},de={class:"flex-ec flex1"},pe={class:"table flex-sc warp"},me={class:"ww100 bs bo-i16-1 relative rad8"},ue={class:"ww100 flex-sc p12 bob-ce-1"},_e={class:"f15"},fe={class:"flex1 flex-ec"},we=["onClick"],ye=["onClick"],ge={class:"ww100 flex-sc"},be={class:"ww100 flex-sc mt10"},ke={class:"ww100 flex-sc mt10"},xe={class:"ww100 flex-sc mt10"},he={class:"ww100 flex-sc mt10"},ve=P({__name:"m1",setup(Se){const{proxy:p}=q(),m=p.publicStore(),u=p.configStore();p.dictStore();const V=z(),j=[{value:"0",name:"待审核"},{value:"1",name:"审核中"},{value:"2",name:"已通过"},{value:"3",name:"不通过"}],D=[{type:"special",name:"专项规划",path:"/schemePlansManagerCity"},{type:"region",name:"片区策划",path:"/schemeDesignsManagerCity"}],l=H({...m.$state,click:!1,clickArr:[],status:"1",type:"special",provinces:[],province:"",citys:[],city:"",type:"plan"});J(async()=>{console.log("route",V.query),await E(),v()});const E=async()=>{l.provinces=[{name:u.user.province_name,value:u.user.province}],l.province=l.provinces[0].value;let o=u.user.parent_id=="0"?{model:"t_station",args:`parent_id='${u.user.station_num}'`}:{model:"t_station",args:`id='${u.user.station_num}'`},e=await m.http({Api:o}),i=p.isNull(e)?[]:e.sort((n,s)=>n.order-s.order);l.citys=i.map(n=>({name:n.station_name,value:n.city})),!p.isNull(l.citys)&&u.user.parent_id!="0"&&(l.city=l.citys[0].value)},v=async o=>{let e={model:"t_scheme_plan",args:`type='${l.type}'`};if(l.province){if(e.args+=`and province='${l.province}'`,l.city&&(e.args+=` and city='${l.city}'`),!p.isNull(l.datetime)){let s=Date.parse(l.datetime[0])+"",c=Date.parse(l.datetime[1])+"";e.args+=` and release_time>='${s}' and release_time<='${c}'`}l.examine_status&&(e.args+=` and examine_status='${l.examine_status}'`)}let i=await m.http({Api:e}),n=p.isNull(i)?[]:i;l.list=n.map(s=>{try{s.datetime?(s.datetime=JSON.parse(s.datetime),s.datetime=`${s.datetime[0]}-${s.datetime[1]}`):s.datetime="",s.attr=s.attr?JSON.parse(s.attr):{},s.project=s.project?JSON.parse(s.project):[],s.task=s.task?JSON.parse(s.task):[]}catch(c){console.error("解析失败:",c.message)}return s}),M(),A()},M=()=>{const o=new Set,e=new Set;l.list.forEach(n=>{o.add(n.user_id),n.release_status=="1"&&e.add(n.user_id)});let i={sum:o.size,release:e.size};m._public.percent=i.sum?Math.floor(i.release/i.sum*100)/100:0,m._public.data1=i},A=async()=>{const o=l.list.map(s=>`'${s.id}'`).join(", ");let e=await m.http({Api:{model:"t_scheme_design",field:"parent_id, COUNT(*) AS design_num",args:`parent_id IN (${o})`,group:"parent_id"}});const i=Object.fromEntries((p.isNull(e)?[]:e).map(s=>[s.parent_id,s.design_num])),n={};l.list.forEach(s=>{const c=s.user_id;n[c]||(n[c]={name:p.decrypt(s.user_name),area:0,impl:0,proj:0}),n[c].area+=Number(i[s.id]||0),n[c].impl+=Number(s.task_num||0),n[c].proj+=Number(s.project_num||0)}),m._public.responses=[{name:"片区数量",data:Object.values(n).map(s=>[s.name,String(s.area)])},{name:"实施中项目",data:Object.values(n).map(s=>[s.name,String(s.impl)])},{name:"项目数量",data:Object.values(n).map(s=>[s.name,String(s.proj)])}]},S=(o,e)=>{o=="remind"&&G.confirm("是否确定提醒?","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{if(l.list.findIndex(n=>n.click)==-1)return N({title:"提示",message:"请选择至少一个",type:"error"});N({title:"提示",message:"提醒成功",type:"success"})}),o=="selectAll"&&(l.list.findIndex(n=>n.click)==-1?(l.click=!0,l.list.forEach(n=>{n.click=!0,l.clickArr.push(n)})):(l.click=!1,l.clickArr=[],l.list.forEach(n=>{delete n.click})))};return(o,e)=>{const i=F,n=T,s=L,c=U,I=Y,O=B;return d(),_("div",Q,[f(I,{title:""},{"left-content":b(()=>[t("div",W,[e[7]||(e[7]=t("span",{class:"mr10"},"上报地区",-1)),t("span",X,[f(n,{modelValue:r(l).province,"onUpdate:modelValue":e[0]||(e[0]=a=>r(l).province=a),placeholder:"请选择",style:{width:"100%"},filterable:""},{default:b(()=>[(d(!0),_(k,null,x(r(l).provinces,(a,y)=>(d(),h(i,{key:a.value,value:String(a.value),label:a.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),t("div",Z,[e[8]||(e[8]=t("span",{class:"mr10"},"编制单位",-1)),t("span",ee,[f(n,{modelValue:r(l).city,"onUpdate:modelValue":e[1]||(e[1]=a=>r(l).city=a),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:r(u).user.parent_id=="0"},{default:b(()=>[(d(!0),_(k,null,x(r(l).citys,(a,y)=>(d(),h(i,{key:a.value,value:String(a.value),label:a.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","clearable"])])]),t("div",te,[e[9]||(e[9]=t("span",{class:"mr10"},"上报时间",-1)),t("span",se,[f(s,{style:{width:"100%"},modelValue:r(l).datetime,"onUpdate:modelValue":e[2]||(e[2]=a=>r(l).datetime=a),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:""},null,8,["modelValue"])])]),t("div",ae,[e[10]||(e[10]=t("span",{class:"mr10"},"审核状态",-1)),t("span",le,[f(n,{modelValue:r(l).examine_status,"onUpdate:modelValue":e[3]||(e[3]=a=>r(l).examine_status=a),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:b(()=>[(d(),_(k,null,x(j,(a,y)=>f(i,{key:a.value,value:String(a.value),label:a.name},null,8,["value","label"])),64))]),_:1},8,["modelValue"])])]),t("div",{class:"rad4 ptb6 plr12 flex-cc cursor bgi1 white",onClick:e[4]||(e[4]=g(a=>v(),["stop"]))},[f(c,{class:"f12 fw"}),e[11]||(e[11]=t("span",{class:"f14 ml5"},"搜索",-1))])]),"right-content":b(()=>[...e[12]||(e[12]=[])]),_:1}),t("div",ne,[t("div",ie,[t("div",oe,[(d(),_(k,null,x(D,(a,y)=>t("div",{class:"mr20 cursor flex-col-cc",key:y,onClick:g($=>o.toPath(a.path),["stop"])},[t("span",ce,w(a.name),1),t("span",{class:C(["ww100 h3 rad10",a.type==r(l).type?"bgi2":"black-rgba0"])},null,2)],8,re)),64))]),t("div",de,[t("div",{class:"rad4 ptb5 plr12 flex-cc cursor bg-white c8 bo-cc-1 ml15",onClick:e[5]||(e[5]=g(a=>S("selectAll"),["stop"]))},"全选"),t("div",{class:"rad4 ptb5 plr12 flex-cc cursor bgi1 white bo-i1-1 ml15",onClick:e[6]||(e[6]=g(a=>S("remind"),["stop"]))},"提醒")])]),t("div",pe,[(d(!0),_(k,null,x(r(l).list,(a,y)=>(d(),_("div",{class:"ww25 cursor p8",key:y},[t("div",me,[t("div",ue,[t("span",_e,w(a.name),1),t("span",fe,[t("span",{class:C(["w18 h18 tc lh18 rad3 ml10 white f12",a.click?"bgi1 bo-i1-1":"bo-cc-1"]),onClick:g($=>a.click=!a.click,["stop"])},[a.click?(d(),h(O,{key:0})):R("",!0)],10,we)])]),t("div",{class:"ww100 flex-col p12 c6",onClick:g($=>o.toPath("/schemePlanView",{id:a.id}),["stop"])},[t("div",ge,[e[13]||(e[13]=t("span",{class:"w110"},"上报时间",-1)),t("span",null,w(a.release_time?o.parseTime(a.release_time):"-"),1)]),t("div",be,[e[14]||(e[14]=t("span",{class:"w110"},"规划周期",-1)),t("span",null,w(a.datetime?a.datetime:"-"),1)]),t("div",ke,[e[15]||(e[15]=t("span",{class:"w110"},"包含项目数",-1)),t("span",null,w(a.project_num?a.project_num:"-"),1)]),t("div",xe,[e[16]||(e[16]=t("span",{class:"w110"},"重点任务数",-1)),t("span",null,w(a.task_num?a.task_num:"-"),1)]),t("div",he,[e[17]||(e[17]=t("span",{class:"w110"},"上报单位",-1)),t("span",null,w(a.user_name?o.decrypt(a.user_name):"-"),1)])],8,ye)])]))),128))])])])}}}),je=K(ve,[["__scopeId","data-v-9b8881a3"]]);export{je as default};
