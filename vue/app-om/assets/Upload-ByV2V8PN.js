import{d as V,g as z,Y as I,o as n,c as S,F as U,z as u,w as f,_ as x,u as p,a as k,a2 as E,f as O,bc as B,r as P,l as j}from"./index-CymMRwSV.js";import{E as M}from"./el-progress-BEBGOLgq.js";import{E as m}from"./el-message-BtiibD_d.js";const A=["src"],C=["src"],L=V({__name:"Upload",props:B({action:{type:String,default:"/api/v1/admin/upload"},fileLimit:{type:Number,default:5},fileSize:{type:Number,default:20},fileType:{type:Array,default:["image/jpg","image/jpeg","image/png"]},fileList:{type:[Array,String],default:[]}},{model:{},modelModifiers:{}}),emits:["update:model"],setup(i){const{proxy:g}=z();g.publicStore();const y=g.configStore(),a=I(i,"model"),l=i,r=P({dialogVisible:!1,dialogImageUrl:""}),_=o=>{r.dialogImageUrl=o.url,r.dialogVisible=!0},v=o=>{const e=l.fileType.indexOf(o.type)!=-1;e||m({type:"error",message:"文件类型不合法，请上传"+l.fileType});const t=o.size/1024/1024<l.fileSize;return t||m({type:"error",message:"上传图片大小不能超过 "+l.fileSize+"MB!"}),e&&t},h=(o,e,t)=>{let s=e.response.data;if(s&&Object.prototype.hasOwnProperty.call(e,"response")&&e.response.data)if(typeof a.value=="string")a.value=s;else{if(!t||t.length==0||!Object.prototype.hasOwnProperty.call(t[t.length-1],"response"))return;a.value.push(s),console.log("sss",a.value)}},w=(o,e)=>{if(!o||!Object.prototype.hasOwnProperty.call(o,"response"))return;let t=o.response.data,s=a.value.findIndex(c=>c==t);s!=-1&&a.value.splice(s,1)},b=()=>{r.loading=!1,m({type:"error",message:"上传失败"})};return(o,e)=>{const t=x,s=M,c=E;return n(),S(U,null,[typeof a.value=="string"?(n(),u(s,{key:0,class:"avatar-uploader","show-file-list":!1,action:i.action,headers:{Authorization:p(y).token},"before-upload":v,"on-success":h,"on-error":b,"on-remove":w,"on-preview":_},{default:f(()=>[a.value?(n(),S("img",{key:0,src:o.I(a.value),class:"avatar"},null,8,A)):(n(),u(t,{key:1}))]),_:1},8,["action","headers"])):(n(),u(s,{key:1,class:"avatar-uploader","show-file-list":!0,action:i.action,headers:{Authorization:p(y).token},"before-upload":v,"on-success":h,"on-error":b,"on-remove":w,"on-preview":_,limit:i.fileLimit,multiple:"","list-type":"picture-card","file-list":l.fileList,"onUpdate:fileList":e[0]||(e[0]=d=>l.fileList=d)},{default:f(()=>[k(t)]),_:1},8,["action","headers","limit","file-list"])),k(c,{title:"图片",width:810,modelValue:p(r).dialogVisible,"onUpdate:modelValue":e[1]||(e[1]=d=>p(r).dialogVisible=d),"destory-on-close":!0},{default:f(()=>[O("img",{class:"ww100",src:p(r).dialogImageUrl,alt:"Preview Image"},null,8,C)]),_:1},8,["modelValue"])],64)}}}),D=j(L,[["__scopeId","data-v-06857e39"]]);export{D as _};
