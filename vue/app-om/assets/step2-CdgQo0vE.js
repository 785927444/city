import{d as z,g as B,r as J,j as $,o as v,c as O,f as c,a as o,w as m,$ as M,E as U,u as a,a8 as I,F as L,p as P,e as h,y as R,cD as q,k as H,v as K,t as Z,z as G,h as Q,Z as W,i as A,K as X,a9 as ee,l as te}from"./index-ClTGGYJq.js";import{_ as ae}from"./FileList.vue_vue_type_script_setup_true_lang-Bn2Vhi25.js";import{_ as re}from"./List.vue_vue_type_script_setup_true_lang-GWlOrLxS.js";import{_ as se}from"./question-filled-DXo9CDBC.js";import{a as le}from"./areaData-CfkeTXdx.js";import{_ as oe}from"./SchemeAutoFill.vue_vue_type_script_setup_true_lang-BoB9I4Xx.js";import{v as b}from"./v6-B4YtUg27.js";import"./ViewFiles-BGc_2hC6.js";import"./UploadText-Czi9cq55.js";/* empty css                    *//* empty css                   */import"./index-BewEhLyo.js";import"./index-DIHLlVQH.js";/* empty css                                                                   */import"./el-image-viewer-BSQBUEyb.js";import"./el-switch-C5epoo5P.js";import"./select-CebIyQvO.js";const ne={class:"layout-col overlay"},ie={class:"hh100 ww100 flex-sc warp"},pe={class:"flex-sc warp ww100"},ce={class:"ww100 flex-sc pb20"},me=["onClick"],de={class:"absolute f14 t10 r-18"},ue={class:"ww100 flex-cc f18 p40 bot-i16-1 mt20"},fe=z({__name:"step2",props:{state:{type:[Object,Array],default:()=>({})},contents:{type:Array,default:[]},active:{type:[Object,Array],default:()=>({})}},setup(C){const{proxy:p}=B(),t=p.publicStore(),f=p.configStore();p.dictStore();let g=A(),E=A({});const k=[{value:"1",name:"重点落实任务"},{value:"2",name:"体检整改任务"}],F=J({...t.$state,content:[{name:"任务中类",key:"task_class",type:"input",width:"flex1"},{name:"建设内容",key:"construct_content",type:"input",width:"w300"},{name:"年份",key:"year",type:"input",width:"w100"},{name:"值",key:"value",type:"input",width:"w100"},{name:"操作",key:{add:"新增",del:"删除"},width:"w100"}]}),x=n=>({id:b(),task_type:n,task_class:"",construct_content:"",year:"",value:""}),S=()=>{t.form&&(Array.isArray(t.form.task)||(t.form.task=[]))},y=n=>{if(S(),!n)return;const r=t.form.task;r.some(i=>String(i.task_type)===String(n))||r.push(x(n))};(!t.current||!t.current.value)&&(t.current=k[0]),y(t.current.value),$(()=>t.current?.value,n=>{y(n)},{immediate:!0}),$(()=>t.form?.task,()=>{y(t.current?.value)},{immediate:!0});const D=X(()=>{const n=t.current?.value,e=(Array.isArray(t.form?.task)?t.form.task:[]).filter(i=>String(i.task_type)===String(n));return e.length>0?e:[x(n)]}),V=C,T=n=>{n.validate(async r=>{r&&(console.log("publicStore.form---2",t.form),ee.confirm("否确定操作继续","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{let e=JSON.parse(JSON.stringify(t.form));if(e.type="report",e.user_id=f.user.id,e.user_name=f.user.name,(e.id?"updApi":"addApi")=="updApi"&&(e.apply_status="1",e.apply_time=Date.now()+""),e.id||(e.id=b()),!p.isNull(e.area)){if(e.area.length>0){e.province=e.area.length>0?e.area[0]:"";let l=p.findNode(le,u=>u.code==e.province);console.log("province---",l)}e.city=e.area.length>1?e.area[1]:"",e.district=e.area.length>2?e.area[2]:"",e.area=JSON.stringify(e.area)}e.fund_source=p.isNull(e.fund_source)?"":JSON.stringify(e.fund_source),e.orther_text=p.isNull(e.orther_text)?"":JSON.stringify(e.orther_text);let _=[];p.isNull(e.attr)?e.attr="":(Object.keys(e.attr).forEach(l=>{if(e.attr[l].data&&e.attr[l].data.indexOf("/uploads")!=-1){const d=`${t._public.contents1.find(s=>s.type==l).parent_type}/${f.user.id}_${l}_${e.plan_attr[l].name}`;e.attr[l].data=d,_.push({oldfile:t.form.attr[l].data,newfile:d})}}),e.attr=JSON.stringify(e.attr));let w=[];p.isNull(e.plan_attr)?e.plan_attr="":(Object.keys(e.plan_attr).forEach(l=>{if(e.plan_attr[l].data&&e.plan_attr[l].data.indexOf("/uploads")!=-1){const d=`${t._public.contents2.find(s=>s.type==l).parent_type}/${f.user.id}_${l}_${e.plan_attr[l].name}`;e.plan_attr[l].data=d,w.push({oldfile:t.form.plan_attr[l].data,newfile:d})}}),e.plan_attr=JSON.stringify(e.plan_attr)),console.log("params",{model:"t_project_report",list:[e]}),console.log("changeFile1",_),console.log("changeFile2",w)}))})},Y=(n,r)=>{if(S(),n==="add")t.form.task.push({id:b(),task_type:t.current.value,task_class:"",construct_content:"",year:"",value:""});else if(n==="del"){const e=t.form.task.indexOf(r);e>-1&&t.form.task.splice(e,1),r.id&&t.http({deleteApi:{model:"t_project_task",list:[r.id]}})}};return(n,r)=>{const e=U,i=M,_=I,w=se,N=q,l=re,u=ae,d=W;return v(),O("div",ne,[c("div",ie,[o(d,{class:"ww100 pplr15",ref_key:"formRef",ref:g,model:a(t).form,rules:a(E),"label-width":"120"},{default:m(()=>[c("div",pe,[o(i,{label:"方案名称",prop:"plan_name",class:"ww50 flex-sc"},{default:m(()=>[o(e,{size:"large",modelValue:a(t).form.plan_name,"onUpdate:modelValue":r[0]||(r[0]=s=>a(t).form.plan_name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(i,{label:"方案编制单位",prop:"plan_unit",class:"ww50 flex-sc"},{default:m(()=>[o(e,{size:"large",modelValue:a(t).form.plan_unit,"onUpdate:modelValue":r[1]||(r[1]=s=>a(t).form.plan_unit=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(i,{label:"复批时间",prop:"approval_time",class:"ww50 flex-sc"},{default:m(()=>[o(_,{modelValue:a(t).form.approval_time,"onUpdate:modelValue":r[2]||(r[2]=s=>a(t).form.approval_time=s),style:{width:"100%"},size:"large",type:"datetime",placeholder:"请选择",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),o(i,{label:"方案摘要",prop:"plan_abstract",class:"ww100 flex-sc"},{default:m(()=>[o(e,{size:"large",modelValue:a(t).form.plan_abstract,"onUpdate:modelValue":r[3]||(r[3]=s=>a(t).form.plan_abstract=s),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(i,{label:"基础建设条件",prop:"condition",class:"ww100 flex-sc"},{default:m(()=>[o(e,{size:"large",modelValue:a(t).form.condition,"onUpdate:modelValue":r[4]||(r[4]=s=>a(t).form.condition=s),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(i,{label:"项目任务",prop:"tasks",class:"ww100 flex-ss"},{default:m(()=>[c("div",ce,[(v(),O(L,null,P(k,(s,j)=>c("div",{class:R(["mr40 pb10 f18 relative cursor actfont",a(t).current.value==s.value?"i1 bob-i1-2":"bob-tt-2"]),key:j,onClick:h(_e=>a(t).current={...s},["stop"])},[o(N,{content:s.describe,placement:"top-start"},{reference:m(()=>[c("div",de,[H(o(w,null,null,512),[[K,s.describe]])])]),_:2},1032,["content"]),c("span",null,Z(s.name),1)],10,me)),64))]),o(l,{onHandleClick:Y,state:a(F),hasLists:!0,lists:a(D)},null,8,["state","lists"])]),_:1}),o(oe,{"scheme-id":a(t).form.parent_id,"area-value":a(t).form.parent_area,"task-type":a(t).form.task_type,draft:a(t).form,"scheme-plans":a(t)._public?.schemePlans?a(t)._public.schemePlans:[],"scheme-areas":a(t)._public?.schemeAreas?a(t)._public.schemeAreas:[]},null,8,["scheme-id","area-value","task-type","draft","scheme-plans","scheme-areas"]),o(i,{label:"实施方案文件上传",prop:"files",class:"ww100 flex-ss"},{default:m(()=>[a(t).form?.plan_attr?(v(),G(u,{key:0,files:a(t).form.plan_attr,"onUpdate:files":r[5]||(r[5]=s=>a(t).form.plan_attr=s),contents:V.contents,active:V.active},null,8,["files","contents","active"])):Q("",!0)]),_:1})])]),_:1},8,["model","rules"]),c("div",ue,[c("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:r[6]||(r[6]=h(s=>a(t).actIndex--,["stop"]))},"上一步"),c("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:r[7]||(r[7]=h(s=>T(a(g)),["stop"]))},"保 存")])])])}}}),De=te(fe,[["__scopeId","data-v-33972139"]]);export{De as default};
