import{d as C,g as I,r as $,b as E,j as V,o as k,c as g,a as d,w as b,u as l,e as B,_ as R,f as x,t as T,h as j,cd as F,i as _,a4 as D,a9 as M,n as P}from"./index-ClTGGYJq.js";import{_ as G}from"./Add-D2-IK3J2.js";import{_ as H}from"./AaFoot-DZKeqXwB.js";import{_ as L}from"./List.vue_vue_type_script_setup_true_lang-GWlOrLxS.js";import{_ as O}from"./AaTitle.vue_vue_type_script_setup_true_lang-DQZ6AruM.js";const z={class:"layout-col"},J={class:"f14 ml4"},K={class:"layout-col white-rgba50 rad8 p15"},ee=C({__name:"m2",setup(Q){const{proxy:n}=I(),t=n.publicStore(),y=n.configStore();n.dictStore();let q=_(),c=_(),f=_();const v=[{value:"0",name:"正常",color:"i11"},{value:"1",name:"锁定",color:"i8"}],w=[{value:"0",name:"正常",color:"i11"},{value:"1",name:"禁用",color:"i8"}],a=$({...t.$state,content:[{width:"w70",show:!0,align:"center",key:"*",name:"序号"},{width:"w50x3",show:!0,align:"left",key:"username",name:"用户"},{width:"w50x3",show:!0,align:"left",key:"name",name:"名称"},{width:"w50x3",show:!0,align:"left",key:"role_id",name:"角色",type:"select",list:[],value:"id",label:"name"},{width:"w50x3",show:!0,align:"left",key:"phone",name:"电话"},{width:"w50x2",show:!0,align:"left",key:"lock",name:"登录状态",type:"select",list:v,value:"value",label:"name"},{width:"w50x2",show:!0,align:"left",key:"status",name:"账户状态",type:"select",list:w,value:"value",label:"name"},{width:"w50x4",show:!0,align:"left",key:"expire",name:"过期",type:"time"},{width:"flex1",show:!0,align:"right",key:{},name:"操作"}],editFrom:[{required:!1,editshow:!0,name:"所属",key:"station_num",type:"select",list:[],value:"id",label:"station_name"},{required:!0,editshow:!0,key:"role_id",name:"角色",type:"select",list:[],value:"id",label:"name"},{required:!0,editshow:!0,key:"name",name:"名称",type:"input",encrypt:!0},{required:!0,editshow:!0,key:"username",name:"用户",type:"input",encrypt:!0},{required:!0,editshow:!0,key:"password",name:"密码",type:"password"},{required:!0,editshow:!0,key:"phone",name:"电话",type:"input",encrypt:!0},{required:!1,editshow:!0,key:"status",name:"状态",type:"select",list:w,value:"value",label:"name"},{required:!1,editshow:!0,key:"expire",name:"过期",type:"time"}],editFrom2:[{required:!0,editshow:"disabled",key:"username",name:"账号",type:"input"},{required:!0,editshow:!0,key:"Password",name:"密码",type:"password"}],addItem:{}});E(async()=>{await t.init({path:"/user"},a);let e={model:"t_role",args:"id!=1",order:"CAST(id AS SIGNED) ASC"},s=await t.http({Api:e});t._public.roles=n.isNull(s)?[]:s}),V(()=>t.active,async e=>{await P(),!n.isNull(e)&&m()},{immediate:!1,deep:!0});const m=async()=>{a.query={model:a.model,args:`station_num='${t.active.id}'`,order:"CAST(id AS SIGNED) ASC"},a.params={Api:a.query};let e=await t.http(a.params);a.empty=!!n.isNull(e);let s=n.isNull(e)?[]:e,r={model:"redis"};r.key=s.map(i=>"errtime_"+i.username);let o=await t.http({getApi:r});a.list=s.map((i,p)=>(i.lock=!n.isNull(o)&&!n.isNull(o[p])&&o[p]>=5?"1":"0",i.name=i.name?n.decrypt(i.name):"",i.username=i.username?n.decrypt(i.username):"",i.phone=i.phone?n.decrypt(i.phone):"",i)),S()},S=async()=>{a.addItem={station_num:t.active.id,status:"0",parent_id:t.active.parent_id,provide:t.active.provide,provide_name:t.active.provide_name,city:t.active.city,city_name:t.active.city_name,district:t.active.district,district_name:t.active.district_name},a.editFrom.forEach(e=>{e.key=="station_num"&&(e.list=[{id:"",station_name:"无"},...t._public.stations]),e.key=="role_id"&&(e.list=t._public.roles)}),a.content.forEach(e=>{e.key=="role_id"&&(e.list=t._public.roles)})},h=async(e,s)=>{if(e=="add"&&c.value.onVisable(s),e=="upd"){let r=!s.username;delete s.password,a.editFrom.forEach(o=>{o.key=="username"&&(o.editshow=r),o.key=="password"&&(o.editshow=r)}),c.value.onVisable(s)}if(e=="del"){if(s.username=="admin")return D({title:"提示",message:"系统管理员无法删除",type:"error"});c.value.del(s)}if(e=="setpd"&&f.value.onVisable({...s,password:"",passwords:""}),e=="unlock"&&s.lock=="1"&&M.confirm("是否确定解锁?","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"success"}).then(async()=>{let r={model:"redis",key:`errtime_${n.encrypt(s.username)}`,value:"0",time:1};await t.http({setApi:r}),n.log([{level:"info",type:"2",name:"解锁",msg:`${s.name}(${s.username}) - 解锁成功`,res:"1",user:y.user.name,username:y.user.username,stationnum:y.distributId}]),m()}),e=="asyncs"){let r={data:a.list,title:"用户"};q.value.onVisable(r)}};return(e,s)=>{const r=R,o=O,i=L,p=H,N=G,A=F;return k(),g("div",z,[d(o,{title:e.isNull(l(t).active)?"":l(t).active.station_name},{"left-content":b(()=>[...s[1]||(s[1]=[])]),"right-content":b(()=>[l(a).content.find(u=>typeof u.key=="object")&&l(a).content.find(u=>typeof u.key=="object").key.hasOwnProperty("add")?(k(),g("div",{key:0,class:"rad4 ptb5 plr8 flex-cc cursor bgi1 white ml10",onClick:s[0]||(s[0]=B(u=>h("add",l(a).addItem),["stop"]))},[d(r,{class:"f12 fw"}),x("span",J,T(l(a).content.find(u=>typeof u.key=="object").key.add),1)])):j("",!0)]),_:1},8,["title"]),x("div",K,[d(i,{onHandleClick:h,state:l(a)},null,8,["state"])]),d(p),d(N,{onInit:m,state:l(a),ref_key:"addRef",ref:c},null,8,["state"]),d(A,{onInit:m,state:l(a),ref_key:"passwordRef",ref:f},null,8,["state"])])}}});export{ee as _};
