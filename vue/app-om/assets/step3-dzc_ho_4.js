import{d as C,g as J,r as U,o as y,c as S,f as m,a as n,Z as j,u as o,w as p,e as O,i as $,$ as z,m as D,F as M,p as I,z as E,q as L,E as T,a8 as k,h as q,a9 as R,a3 as P,a4 as h,aa as Z,l as G}from"./index-C0LFq0t5.js";import{_ as H}from"./FileList.vue_vue_type_script_setup_true_lang-DtMaAncq.js";import{a as v}from"./areaData-CfkeTXdx.js";import{v as K}from"./v6-B4YtUg27.js";import"./ViewFiles-DAOzOFJI.js";import"./UploadText-D6BCvpgB.js";/* empty css                    *//* empty css                   */import"./index-C9K-_7OE.js";import"./index-DCe-bV3q.js";/* empty css                                                                   */const Q={class:"layout-col overlay"},W={class:"hh100 ww100 flex-sc warp"},X={class:"flex-sc warp ww100"},ee={class:"ww100 flex-cc f18 p40 bot-i16-1 mt20"},te=C({__name:"step3",props:{state:{type:[Object,Array],default:()=>({})},contents:{type:Array,default:[]},active:{type:[Object,Array],default:()=>({})}},setup(A){const{proxy:s}=J(),l=s.publicStore(),_=s.configStore(),F=s.dictStore();let x=$(),Y=$({});U({...l.$state});const N=A,B=f=>{f.validate(async r=>{r&&R.confirm("否确定操作继续","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(async()=>{let e=JSON.parse(JSON.stringify(l.form)),w=Date.now()+"";e.type="report",e.update_time=w,e.user_id=_.user.id,e.user_name=_.user.name;let i=e.id?"updApi":"addApi";if(i=="updApi"&&((e.apply_status="0")&&(e.apply_status="1",e.apply_time=w),e.apply_status="1"),e.id||(e.id=K()),!s.isNull(e.area)){if(e.area.length>0){e.province=e.area.length>0?e.area[0]:"";let t=s.findNode(v,a=>a.code==e.province);t&&(e.province_name=t.name)}if(e.area.length>1){e.city=e.area.length>1?e.area[1]:"";let t=s.findNode(v,a=>a.code==e.city);t&&(e.city_name=t.name)}if(e.area.length>2){e.district=e.area.length>2?e.area[2]:"";let t=s.findNode(v,a=>a.code==e.district);t&&(e.district_name=t.name)}e.area=JSON.stringify(e.area)}e.fund_source=s.isNull(e.fund_source)?"":JSON.stringify(e.fund_source),e.orther_text=s.isNull(e.orther_text)?"":JSON.stringify(e.orther_text);let c=[];s.isNull(e.attr)?e.attr="":(Object.keys(e.attr).forEach(t=>{if(e.attr[t].data&&e.attr[t].data.indexOf("/uploads")!=-1){const d=`${l._public.contents1.find(b=>b.type==t).parent_type}/${_.user.id}_${t}_${e.attr[t].name}`;e.attr[t].data=d,c.push({oldfile:l.form.attr[t].data,newfile:d})}}),e.attr=JSON.stringify(e.attr));let u=[];s.isNull(e.plan_attr)?e.plan_attr="":(Object.keys(e.plan_attr).forEach(t=>{if(e.plan_attr[t].data&&e.plan_attr[t].data.indexOf("/uploads")!=-1){const d=`${l._public.contents2.find(b=>b.type==t).parent_type}/${_.user.id}_${t}_${e.plan_attr[t].name}`;e.plan_attr[t].data=d,u.push({oldfile:l.form.plan_attr[t].data,newfile:d})}}),e.plan_attr=JSON.stringify(e.plan_attr));let g={model:"t_project_report",list:[e]};P[i](g).then(async t=>{if(t.code==200){let a=i=="updApi"?"申请成功":"保存成功";h({title:"提示",message:a,type:"success"}),s.isNull(c)||V(c),s.isNull(u)||V(u),setTimeout(()=>{Z.back()},500)}else h({title:"提示",message:t.msg?t.msg:"保存失败(400)",type:"error"})}).catch(t=>{h({title:"提示",message:"保存失败(500)",type:"error"})})})})},V=async f=>{if(s.isNull(f))return;let r={list:f};l.http({changeFileApi:r}).then(e=>{})};return(f,r)=>{const e=L,w=D,i=z,c=T,u=k,g=H,t=j;return y(),S("div",Q,[m("div",W,[n(t,{class:"ww100 pplr15",ref_key:"formRef",ref:x,model:o(l).form,rules:o(Y),"label-width":"120"},{default:p(()=>[m("div",X,[n(i,{label:"项目状态",prop:"completion_status",class:"ww50 flex-sc"},{default:p(()=>[n(w,{modelValue:o(l).form.completion_status,"onUpdate:modelValue":r[0]||(r[0]=a=>o(l).form.completion_status=a),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:p(()=>[(y(!0),S(M,null,I(o(F).project_completion_statuss,(a,d)=>(y(),E(e,{key:a.value,value:String(a.value),label:a.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(i,{label:"已投资金额",prop:"has_construct_price",class:"ww50 flex-sc"},{default:p(()=>[n(c,{size:"large",modelValue:o(l).form.has_construct_price,"onUpdate:modelValue":r[1]||(r[1]=a=>o(l).form.has_construct_price=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),n(i,{label:"已建设规模",prop:"has_construct_price",class:"ww50 flex-sc"},{default:p(()=>[n(c,{size:"large",modelValue:o(l).form.has_construct_price,"onUpdate:modelValue":r[2]||(r[2]=a=>o(l).form.has_construct_price=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),n(i,{label:"复批时间",prop:"approval_time",class:"ww50 flex-sc"},{default:p(()=>[n(u,{modelValue:o(l).form.approval_time,"onUpdate:modelValue":r[3]||(r[3]=a=>o(l).form.approval_time=a),style:{width:"100%"},size:"large",type:"datetime",placeholder:"请选择",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),n(i,{label:"方案摘要",prop:"plan_abstract",class:"ww100 flex-sc"},{default:p(()=>[n(c,{size:"large",modelValue:o(l).form.plan_abstract,"onUpdate:modelValue":r[4]||(r[4]=a=>o(l).form.plan_abstract=a),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),n(i,{label:"基础建设条件",prop:"condition",class:"ww100 flex-sc"},{default:p(()=>[n(c,{size:"large",modelValue:o(l).form.condition,"onUpdate:modelValue":r[5]||(r[5]=a=>o(l).form.condition=a),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),n(i,{label:"实施方案文件上传",prop:"files",class:"ww100 flex-ss"},{default:p(()=>[o(l).form?.plan_attr?(y(),E(g,{key:0,files:o(l).form.plan_attr,"onUpdate:files":r[6]||(r[6]=a=>o(l).form.plan_attr=a),contents:N.contents,active:N.active},null,8,["files","contents","active"])):q("",!0)]),_:1})])]),_:1},8,["model","rules"]),m("div",ee,[m("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:r[7]||(r[7]=O(a=>o(l).actIndex--,["stop"]))},"上一步"),m("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:r[8]||(r[8]=O(a=>B(o(x)),["stop"]))},"保 存")])])])}}}),ue=G(te,[["__scopeId","data-v-a74a0287"]]);export{ue as default};
