import{d as C,g as T,r as V,b as E,o as u,c as f,f as n,u as r,h as y,e as g,t as J,a as c,k as h,v as w,w as b,G as O,C as F,a6 as I,ac as k,a8 as m,a7 as A}from"./index-BWjCSAnw.js";import{_ as D,a as M,b as q}from"./Step1-CLAyHow0.js";import{_ as P}from"./stepTitle.vue_vue_type_script_setup_true_lang-B5HaojiF.js";import"./el-progress-DQWPeYlj.js";import"./xlsx-CaORBL06.js";import"./List.vue_vue_type_script_setup_true_lang-But96V8i.js";import"./el-image-viewer-HQ-b3oKZ.js";import"./el-switch-i6AGQHxo.js";import"./select-quGGAc_E.js";import"./ViewFiles-BmDneZVF.js";import"./el-message-CJx4xv24.js";const z={class:"layout-col plr15"},G={class:"layout-col white-rgba50 rad8"},R={class:"ww100 flex-bc f20 p15 mb20 bob-cd-1"},U={class:"flex1 flex-ec"},H={key:0,class:"plr14 ptb5 rad4 mr15 cursor c9 bg-white bo-c9-1"},K={class:"layout-col"},L={class:"dialog-footer"},nt=C({__name:"index",setup(Q){const{proxy:l}=T(),t=l.publicStore(),x=l.configStore(),i=V({...t.$state,model:"t_scheme_plan",type:"design"});E(async()=>{t.actIndex=1,t.form={attr:{},project:[],task:[]},t._public.project=[],t._public.task=[],d()});const d=async o=>{let e=o?{model:i.model,args:`id='${o}'`}:{model:i.model,args:`user_id='${x.user.id}' and type='${i.type}'`},a=await t.http({Api:e});if(l.isNull(a))t.form={attr:{},project:[],task:[]},t._public.project=[],t._public.task=[];else{let s=a[0];v(s),S(s);try{s.datetime=s.datetime?JSON.parse(s.datetime):"",s.attr=s.attr?JSON.parse(s.attr):{}}catch(_){console.error("解析失败:",_.message)}t.form={...s}}console.log("publicStore.form",t.form)},v=o=>{let e={model:"t_scheme_project",args:`scheme_id='${o.id}'`};t.http({Api:e}).then(a=>{o.project=l.isNull(a)?[]:[...a],o.project.forEach(s=>{s.construct_datetime=`${s.construct_datetime_start||""} ~ ${s.construct_datetime_end||""}`}),t.form.project=[...o.project],t._public.project=JSON.parse(JSON.stringify(o.project))})},S=o=>{let e={model:"t_scheme_task",args:`scheme_id='${o.id}'`};t.http({Api:e}).then(a=>{o.task=l.isNull(a)?[]:[...a],t.form.task=[...o.task],t._public.task=JSON.parse(JSON.stringify(o.task))})},N=()=>{let o=t.form.id?"正在编辑中,是否确定退出?":"正在编辑中,信息未保存是否确定退出?";k.confirm(o,"温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{l.toPath("/schemePlansManagerCity")})},$=async()=>{if(!t.form.id)return m({title:"提示",message:"请先保存数据(440)",type:"error"});k.confirm("上报需等待审核!","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{const o=new Date().getTime();let a={model:"t_scheme_plan",list:[{id:t.form.id,release_status:"1",release_time:o,examine_status:"0"}]};A.updApi(a).then(s=>{s.code==200?(m({title:"提示",message:"上报成功",type:"success"}),d()):m({title:"提示",message:s.msg?s.msg:"上报失败(400)",type:"error"})}).catch(s=>{m({title:"提示",message:"上报失败(500)",type:"error"})})})};return(o,e)=>{const a=D,s=M,_=q,j=O,B=I;return u(),f("div",z,[n("div",G,[n("div",R,[e[4]||(e[4]=n("div",{class:"fw"},"片区规划上报",-1)),n("div",U,[r(t).form.id?y("",!0):(u(),f("div",H,"上 报")),r(t).form.id?(u(),f("div",{key:1,class:"plr14 ptb5 rad4 mr15 cursor white bgi1",onClick:e[0]||(e[0]=g(p=>$(),["stop"]))},J(r(t).form.release_status!="1"?"上报":"重新上报"),1)):y("",!0),n("div",{class:"plr14 ptb5 rad4 mr15 cursor c9 bg-white bo-c9-1",onClick:e[1]||(e[1]=g(p=>N(),["stop"]))},"返 回")])]),n("div",K,[c(r(P)),h(c(a,{state:r(i)},null,8,["state"]),[[w,r(t).actIndex==1]]),h(c(s,{state:r(i)},null,8,["state"]),[[w,r(t).actIndex==2]]),c(_,{state:r(i),onInit:d},null,8,["state"])])]),c(B,{modelValue:r(i).isFalse,"onUpdate:modelValue":e[3]||(e[3]=p=>r(i).isFalse=p),title:"提示",draggable:!0,width:"30%"},{footer:b(()=>[n("div",L,[c(j,{size:"large",class:"bgi1 white",onClick:e[2]||(e[2]=g(p=>r(i).isFalse=!r(i).isFalse,["stop"]))},{default:b(()=>[...e[5]||(e[5]=[F("确 定",-1)])]),_:1})])]),default:b(()=>[e[6]||(e[6]=n("div",{class:"f20 ww100 tc ptb30"},"你有专项规划需要上报，完成上报后可新增",-1))]),_:1},8,["modelValue"])])}}});export{nt as default};
