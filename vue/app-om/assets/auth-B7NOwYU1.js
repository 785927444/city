import{_ as S}from"./select-CBJjauee.js";import{d as V,g as A,r as q,j as B,o as p,c as y,a as f,u as i,w as v,z as b,Z as F,f as a,e as _,c3 as z,h as g,E as D,F as j,p as K,y as M,t as O,a3 as k,a4 as m,n as R,l as T}from"./index-BF5jje68.js";import{_ as U}from"./AaTitle.vue_vue_type_script_setup_true_lang-msvlqApB.js";const Z={class:"layout-col"},G={class:"layout-col white-rgba50 rad8 p15"},H={class:"flex-sc mb10"},J={class:"plr8"},P={class:"flex1 overlay ww100 flex-ss warp"},Q=["onClick"],W={class:"flex-sc"},X=V({__name:"auth",setup(Y){const{proxy:c}=A(),r=c.publicStore(),w=c.configStore(),t=q({...r.$state});B(()=>r.active,async l=>{await R(),!c.isNull(l)&&(x(),h())},{immediate:!1,deep:!0});const x=async()=>{let l=r.active[t.key]==1||w.user&&w.user.role_id=="1"?r._public.authList:r._public.authList.filter(e=>e.model!="t_route"&&e.model!="t_auth");t.auths=l.sort((e,s)=>e.order-s.order).map(e=>(e.select=!1,e))},h=async l=>{t.query={model:"t_role_auth",args:`role_id='${r.active[t.key]}'`,field:"auth_id"},t.params={Api:t.query};let e=await r.http(t.params);t.list=c.isNull(e)?[]:c.isNull(e)?[]:e,C()},C=async l=>{t.active=t.list.map(e=>e.auth_id),t.auths.forEach(e=>{t.list.find(u=>u.auth_id==e.id)?e.select=!0:e.select=!1})},N=async l=>{let e=t.auths.filter(n=>n.select).map(n=>n.id);const s=e.filter(n=>!t.active.includes(n)),u=t.active.filter(n=>!e.includes(n));c.isNull(s)||await E(s),c.isNull(u)||await $(u)},E=async l=>{let e={model:"t_role_auth",list:[]};e.list=l.map(s=>({role_id:r.active[t.key],auth_id:s})),k.addApi(e).then(s=>{s.code==200?(h(),m({title:"提示",message:"添加成功",type:"success"})):m({title:"提示",message:"添加失败",type:"error"})}).catch(s=>{m({title:"提示",message:"添加失败",type:"error"})})},$=async l=>{let e={model:"t_role_auth",list:[]};e.list=l.map(s=>({role_id:r.active[t.key],auth_id:s})),k.delApi(e).then(s=>{s.code==200&&(h(),m({title:"提示",message:"删除成功",type:"success"}))}).catch(s=>{m({title:"提示",message:"删除失败",type:"error"})})};return(l,e)=>{const s=z,u=F,n=U,I=D,L=S;return p(),y("div",Z,[f(n,{title:l.isNull(i(r).active)?"":i(r).active.name+" - 权限配置"},{"left-content":v(()=>[...e[4]||(e[4]=[])]),"right-content":v(()=>[i(t).auth.upd?(p(),b(u,{key:0,class:"ww100 flex-ec",model:i(t).from,"label-width":"115px"},{default:v(()=>[a("div",{class:"rad4 ptb5 plr8 flex-cc cursor bgi1 white ml10",onClick:e[0]||(e[0]=_(o=>N(l.formRef),["stop"]))},[f(s,{class:"f12 fw"}),e[5]||(e[5]=a("span",{class:"f14 ml2"},"保存",-1))])]),_:1},8,["model"])):g("",!0)]),_:1},8,["title"]),a("div",G,[a("div",H,[a("div",{class:"rad4 ptb5 plr8 flex-cc cursor bgi1 white ml10 bo-i1-1",onClick:e[1]||(e[1]=_(o=>i(t).auths.map(d=>d.select=!0),["stop"]))},[f(s,{class:"f12 fw"}),e[6]||(e[6]=a("span",{class:"f14 ml2"},"全选",-1))]),a("div",{class:"rad4 ptb5 plr8 flex-cc cursor bgi1 white ml10 bo-i1-1",onClick:e[2]||(e[2]=_(o=>i(t).auths.map(d=>d.select=!1),["stop"]))},[f(s,{class:"f12 fw"}),e[7]||(e[7]=a("span",{class:"f14 ml2"},"反选",-1))]),a("div",J,[f(I,{modelValue:i(t).text,"onUpdate:modelValue":e[3]||(e[3]=o=>i(t).text=o),placeholder:"请输入关键字"},null,8,["modelValue"])])]),a("div",P,[(p(!0),y(j,null,K(l.isNull(i(t).auths)?[]:i(t).auths.filter(o=>!i(t).text||o.name.toLowerCase().indexOf(i(t).text.toLowerCase())!=-1),(o,d)=>(p(),y("div",{class:"p8 ww cursor",key:d,onClick:_(ee=>o.select=!o.select,["stop"])},[a("div",W,[a("div",{class:M([o.select?"bgi1 white":"bo-cb-1","rad2 w13 h13 mr5 p2 flex-cc"])},[o.select?(p(),b(L,{key:0,class:"f12"})):g("",!0)],2),a("div",null,O(o.name),1)])],8,Q))),128))])])])}}}),ae=T(X,[["__scopeId","data-v-f14abec1"]]);export{ae as default};
