import{d as C,g as F,r as T,b as V,o as _,c as f,f as n,u as a,h,e as g,t as E,a as c,k as w,v as k,w as b,a0 as J,a1 as O,a2 as A,a9 as x,a4 as m,a3 as I}from"./index-ClTGGYJq.js";import{_ as q,a as D,b as M}from"./Step1-CAVcTtCR.js";import{_ as P}from"./stepTitle.vue_vue_type_script_setup_true_lang-hjUJmvmX.js";import"./v6-B4YtUg27.js";/* empty css                    */import"./excelTools-CURuvhVQ.js";import"./xlsx-CaORBL06.js";import"./index-BewEhLyo.js";import"./List.vue_vue_type_script_setup_true_lang-GWlOrLxS.js";import"./el-image-viewer-BSQBUEyb.js";import"./el-switch-C5epoo5P.js";import"./select-CebIyQvO.js";import"./question-filled-DXo9CDBC.js";import"./ViewFiles-BGc_2hC6.js";import"./UploadText-Czi9cq55.js";/* empty css                   */import"./index-DIHLlVQH.js";/* empty css                                                                   */const z={class:"layout-col plr15"},R={class:"layout-col white-rgba50 rad8"},U={class:"ww100 flex-bc f20 p15 mb20 bob-cd-1"},G={class:"flex1 flex-ec"},H={key:0,class:"plr14 ptb5 rad4 mr15 cursor c9 bg-white bo-c9-1"},K={class:"layout-col"},L={class:"dialog-footer"},_t=C({__name:"index",setup(Q){const{proxy:l}=F(),t=l.publicStore(),y=l.configStore(),r=T({...t.$state,model:"t_scheme_plan",type:"design"});V(async()=>{t.actIndex=1,t.form={attr:{},project:[],task:[]},t._public.project=[],t._public.task=[];let s={model:"t_scheme_plan",args:`user_id='${y.user.id}' and release_status='0' and type='${r.type}'`},e=await t.http({Api:s});l.isNull(e)||(d(e[0].id),r.name=e[0].name,r.isFalse=!r.isFalse)});const d=async s=>{let e=s?{model:r.model,args:`id='${s}'`}:{model:r.model,args:`user_id='${y.user.id}' and type='${r.type}'`},i=await t.http({Api:e});if(l.isNull(i))t.form={attr:{},project:[],task:[]},t._public.project=[],t._public.task=[];else{let o=i[0];v(o),S(o);try{o.datetime=o.datetime?JSON.parse(o.datetime):"",o.attr=o.attr?JSON.parse(o.attr):{}}catch(u){console.error("解析失败:",u.message)}t.form={...o}}console.log("publicStore.form",t.form)},v=s=>{let e={model:"t_scheme_project",args:`scheme_id='${s.id}'`};t.http({Api:e}).then(i=>{s.project=l.isNull(i)?[]:[...i],s.project.forEach(o=>{o.construct_datetime=`${o.construct_datetime_start||""} ~ ${o.construct_datetime_end||""}`}),t.form.project=[...s.project],t._public.project=JSON.parse(JSON.stringify(s.project))})},S=s=>{let e={model:"t_scheme_task",args:`scheme_id='${s.id}'`};t.http({Api:e}).then(i=>{s.task=l.isNull(i)?[]:[...i],t.form.task=[...s.task],t._public.task=JSON.parse(JSON.stringify(s.task))})},N=()=>{let s=t.form.id?"正在编辑中,是否确定退出?":"正在编辑中,信息未保存是否确定退出?";x.confirm(s,"温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{l.toPath("/schemePlansManagerCity")})},$=async()=>{if(!t.form.id)return m({title:"提示",message:"请先保存数据(440)",type:"error"});x.confirm("上报需等待审核!","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{const s=new Date().getTime();let i={model:"t_scheme_plan",list:[{id:t.form.id,release_status:"1",release_time:s,examine_status:"0"}]};I.updApi(i).then(o=>{o.code==200?(m({title:"提示",message:"上报成功",type:"success"}),d()):m({title:"提示",message:o.msg?o.msg:"上报失败(400)",type:"error"})}).catch(o=>{m({title:"提示",message:"上报失败(500)",type:"error"})})})};return(s,e)=>{const i=q,o=D,u=M,j=J,B=A;return _(),f("div",z,[n("div",R,[n("div",U,[e[4]||(e[4]=n("div",{class:"fw"},"片区规划上报",-1)),n("div",G,[a(t).form.id?h("",!0):(_(),f("div",H,"上 报")),a(t).form.id?(_(),f("div",{key:1,class:"plr14 ptb5 rad4 mr15 cursor white bgi1",onClick:e[0]||(e[0]=g(p=>$(),["stop"]))},E(a(t).form.release_status!="1"?"上报":"重新上报"),1)):h("",!0),n("div",{class:"plr14 ptb5 rad4 mr15 cursor c9 bg-white bo-c9-1",onClick:e[1]||(e[1]=g(p=>N(),["stop"]))},"返 回")])]),n("div",K,[c(a(P)),w(c(i,{state:a(r)},null,8,["state"]),[[k,a(t).actIndex==1]]),w(c(o,{state:a(r)},null,8,["state"]),[[k,a(t).actIndex==2]]),c(u,{state:a(r),onInit:d},null,8,["state"])])]),c(B,{modelValue:a(r).isFalse,"onUpdate:modelValue":e[3]||(e[3]=p=>a(r).isFalse=p),title:"提示",draggable:!0,width:"30%"},{footer:b(()=>[n("div",L,[c(j,{size:"large",class:"bgi1 white",onClick:e[2]||(e[2]=g(p=>a(r).isFalse=!a(r).isFalse,["stop"]))},{default:b(()=>[...e[5]||(e[5]=[O("确 定",-1)])]),_:1})])]),default:b(()=>[e[6]||(e[6]=n("div",{class:"f20 ww100 tc ptb30"},"你有专项规划需要上报，完成上报后可新增",-1))]),_:1},8,["modelValue"])])}}});export{_t as default};
