import{a5 as K,o as a,c,f as o,d as ee,g as te,j as se,b as oe,a3 as j,a as p,w as k,a0 as ie,F as f,p as v,u as n,aP as ne,E as ae,h as N,k as $,t as u,a2 as le,r as ce,a1 as de,e as y,z as M,y as F,v as re,_ as ue,K as me,l as pe}from"./index-BF5jje68.js";import{v as _e}from"./el-loading-DNd19Xuc.js";import{E as he}from"./el-image-viewer-DMRq40TL.js";import{E as ge}from"./el-pagination-CLehCad4.js";import{_ as fe}from"./search-BliWKYhP.js";const ve={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function ye(D,_){return a(),c("svg",ve,[..._[0]||(_[0]=[o("path",{fill:"currentColor",d:"M340.9 149.3a30.6 30.6 0 0 0 0 42.8L652.7 512L341 831.9a30.6 30.6 0 0 0 0 42.7a29 29 0 0 0 41.7 0l331.6-340.3a32 32 0 0 0 0-44.6L382.6 149.4a29 29 0 0 0-41.7 0z"},null,-1)])])}const Ce=K({name:"ep-arrow-right",render:ye}),be={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function xe(D,_){return a(),c("svg",be,[..._[0]||(_[0]=[o("path",{fill:"currentColor",d:"M831.9 340.9L512 652.7L192.1 340.9a30.6 30.6 0 0 0-42.7 0a29 29 0 0 0 0 41.6l340.3 331.7a32 32 0 0 0 44.6 0l340.3-331.7a29 29 0 0 0 0-41.7a30.6 30.6 0 0 0-42.7 0z"},null,-1)])])}const we=K({name:"ep-arrow-down",render:xe}),ke={class:"layout-col"},Ne={class:"layout-row"},$e={class:"kb-left bg-white rad8 p15"},Ie={class:"flex-bc mb15"},Ve={class:"flex-sc"},ze={class:"table-col"},Ae=["onClick"],Se={class:"flex-sc"},je={class:"kb-children"},Me=["onClick"],De={class:"f14 line1"},Ee=["onClick"],Be={class:"flex1 hh100 hidden ml15"},Le={class:"layout-col"},Te={key:0,class:"bg-white rad8 p15 mb15"},qe={key:1,class:"layout-col hh100 hidden",style:{background:"transparent"}},Fe={class:"flex-sc align-start hh100",style:{"align-items":"stretch",gap:"16px"}},Ke={class:"flex-col hh100 bg-white rad8 overflow-hidden",style:{flex:"1299"}},Oe={class:"flex1 overflow-hidden p20 pr0 flex-col"},Pe={class:"flex1 overflow-y-auto pr10"},Re=["onClick"],Ue={class:"date-box mr20 tc"},Ye={class:"f24 fw c-primary"},Je={class:"c9 f12"},Ge={class:"flex-col flex1 mr20"},He={class:"f16 fw mb10 line1"},Qe={class:"c9 f12 flex-sc"},We={class:"mr10"},Xe={class:"w120 h80 rad4 overflow-hidden flex-shrink-0"},Ze=["src"],et={key:1,src:"https://picsum.photos/120/80?random=1",class:"ww100 hh100 object-cover"},tt={key:0,class:"ww100 p15 i2"},st={class:"flex-ec mt10"},ot={class:"hh100 bg-white rad8 flex-col overflow-hidden p20",style:{flex:"421"}},it={class:"flex1 overflow-y-auto"},nt={class:"f15 fw line2 mb15",style:{"line-height":"1.8"}},at={class:"f13 c9 line3",style:{"line-height":"1.8"}},lt={key:2,class:"layout-col bg-white rad8 p15 hh100 hidden"},ct={class:"fw f16 mb10"},dt={class:"flex1 overflow-y-auto"},rt={class:"grid-container"},ut=["onClick"],mt={class:"cover-box relative",style:{"padding-top":"56.25%"}},pt=["src"],_t=["src"],ht={class:"p15 flex1 flex-col-bc"},gt=["title"],ft={class:"flex-bc c9 f12 ww100"},vt={key:0,class:"ww100 p15 i2"},yt={class:"flex-ec mt10"},Ct={key:3,class:"layout-col bg-white rad8 p15 hh100 hidden"},bt={class:"fw f16 mb10"},xt={class:"table-col"},wt={key:0,class:"ww100 p15 i2"},kt={key:1},Nt=["onClick"],$t={class:"flex-bc ww100"},It={class:"flex-sc flex1 hidden"},Vt={class:"f14 line1"},zt={class:"c9 f14"},At={class:"flex-ec mt10"},St={class:"flex-sc"},jt={class:"flex1"},Mt={class:"flex-ec"},Dt=ee({__name:"index",setup(D){const{proxy:_}=te(),e=ce({q:"",columns:[],openMap:{},activeColumnCode:"",activeColumnName:"",activeCategoryId:"",items:[],total:0,page:1,limit:10,loading:!1,addVisible:!1,addColumnCode:"",addName:""}),O=me(()=>e.activeColumnCode==="expert"||e.activeColumnCode==="case"),P=[{title:"《关于全面开展城市体检工作的指导意见》",desc:"以习近平新时代中国特色社会主义思想为指引，坚持发展理念以及“人民城市”理念"},{title:"《城市体检评估机制建设指南》",desc:"规范城市体检评估工作，推动城市高质量发展"},{title:"《关于实施城市更新行动的指导意见》",desc:"全面推进城镇老旧小区改造，提升城市功能和品质"},{title:"《“十四五”新型城镇化实施方案》",desc:"深入推进以人为核心的新型城镇化战略"},{title:"《国家生态园林城市标准》",desc:"促进城市生态文明建设，改善城市人居环境"}],R=t=>{if(!t)return"01.01";const s=new Date(t);return isNaN(s.getTime())?"01.01":`${String(s.getMonth()+1).padStart(2,"0")}.${String(s.getDate()).padStart(2,"0")}`},U=t=>{if(!t)return"2023";const s=new Date(t);return isNaN(s.getTime())?"2023":String(s.getFullYear())},b=t=>{if(!t)return"";const s=t.title||t.name||t.subtitle||t.expert_name||t.case_name||t.summary||"";if(s)return String(s);const l=Object.keys(t||{});for(const d of l){const m=t[d];if(typeof m=="string"&&m.trim().length>0&&!/id|code|column|category|views|count|status/i.test(d))return m}return""},x=t=>{if(!t)return"";const s=t.publish_time||t.created_at||t.updated_at||t.time||t.publish_date||t.date||t.create_time||t.update_time||"";if(s)return String(s);const l=Object.keys(t||{}),d=/\d{4}[-/\.]\d{1,2}[-/\.]\d{1,2}/;for(const m of l){const g=t[m];if(typeof g=="string"&&d.test(g))return g}return""};se(()=>({code:e.activeColumnCode,items:e.items}),t=>{if((t.code==="expert"||t.code==="case")&&Array.isArray(t.items)&&t.items.length>0){const s=t.items[0],l={};Object.keys(s).forEach(d=>{const m=s[d];l[d]=typeof m=="object"?"[object]":m}),console.log("[KB expert/case sample item]",l)}},{deep:!0}),oe(async()=>{await B()});const E=t=>{let s=t?.image_urls;if(typeof s=="string")try{s=JSON.parse(s)}catch{s=[s]}return Array.isArray(s)?s.map(l=>String(l)).filter(l=>l.trim()):[]},C=t=>E(t)[0]||"",B=async()=>{e.loading=!0;try{const t=await j.kbColumnsApi({}),s=t?.data?.columns??t?.columns??[];if(e.columns=s.map(l=>({...l,children:l.children??[]})),e.openMap=e.columns.reduce((l,d)=>(l[d.code]=!0,l),{}),!e.activeColumnCode&&e.columns.length>0){e.activeColumnCode=e.columns[0].code,e.activeColumnName=e.columns[0].name;const l=e.columns[0].children?.[0];l&&(e.activeCategoryId=l.id)}await h(1)}catch{e.columns=[],e.items=[],e.total=0}finally{e.loading=!1}},L=()=>{h(1)},Y=t=>{if(e.openMap[t]=!e.openMap[t],e.activeColumnCode!==t){const s=e.columns.find(l=>l.code===t);e.activeColumnCode=t,e.activeColumnName=s?.name??"",e.activeCategoryId="",h(1)}},J=async(t,s)=>{if(e.activeColumnCode!==t){const l=e.columns.find(d=>d.code===t);e.activeColumnCode=t,e.activeColumnName=l?.name??""}e.activeCategoryId=s,await h(1)},I=t=>{_.toPath(`/knowledge/item/${t}`)},V=t=>{e.page=t,h(t)},z=t=>{e.limit=t,h(1)},h=async t=>{e.loading=!0,e.activeColumnCode==="case"||e.activeColumnCode==="expert"?e.limit=12:e.limit=10;try{const s={column_code:e.activeColumnCode,category_id:e.activeCategoryId||"",q:e.q,page:t,limit:e.limit},l=await j.kbItemsApi(s),d=l?.data??l;e.items=d?.items??[],e.total=Number(d?.total??0)||0,e.page=t}catch{e.items=[],e.total=0}finally{e.loading=!1}},G=t=>{const s=t?.category_names??t?.categories??null;if(Array.isArray(s)&&s.length)return s.map(m=>String(m)).filter(Boolean);const l=t?.category_name??t?.category??"",d=String(l).trim();return d?[d]:["-"]},H=t=>{e.addColumnCode=t,e.addName="",e.addVisible=!0},T=()=>{e.addVisible=!1,e.addName="",e.addColumnCode=""},Q=async()=>{const t=String(e.addName??"").trim(),s=String(e.addColumnCode??"").trim();if(!(!t||!s))try{const l=await j.kbCategoryAddApi({column_code:s,name:t}),d=l?.data?.category??l?.category??null;if(await B(),d?.id!=null){e.activeColumnCode=s;const m=e.columns.find(g=>g.code===s);e.activeColumnName=m?.name??"",e.activeCategoryId=d.id,await h(1)}}finally{T()}};return(t,s)=>{const l=ie,d=we,m=Ce,g=ue,W=fe,q=ae,A=ge,X=he,Z=le,S=_e;return a(),c("div",ke,[o("div",Ne,[o("div",$e,[o("div",Ie,[s[9]||(s[9]=o("div",{class:"fw f16"},"分类导航栏",-1)),o("div",Ve,[p(l,{type:"primary",link:"",onClick:s[0]||(s[0]=i=>t.$router.push("/knowledge/manage"))},{default:k(()=>[...s[8]||(s[8]=[de("管理后台",-1)])]),_:1})])]),o("div",ze,[(a(!0),c(f,null,v(n(e).columns,i=>(a(),c("div",{key:i.code,class:"kb-group"},[o("div",{class:"kb-group-title flex-bc cursor",onClick:y(r=>Y(i.code),["stop"])},[o("div",Se,[n(e).openMap[i.code]?(a(),M(d,{key:0,class:"f14 mr8"})):(a(),M(m,{key:1,class:"f14 mr8"})),o("span",{class:F(["f14",i.code===n(e).activeColumnCode?"i1 fw":"c8"])},u(i.name),3)])],8,Ae),$(o("div",je,[(a(!0),c(f,null,v(i.children,r=>(a(),c("div",{key:r.id,class:F(["kb-child cursor",r.id===n(e).activeCategoryId?"kb-child-active":"kb-child-normal"]),onClick:y(w=>J(i.code,r.id),["stop"])},[o("span",De,u(r.name),1)],10,Me))),128)),o("div",{class:"kb-add cursor",onClick:y(r=>H(i.code),["stop"])},[p(g,{class:"f14 mr5"}),s[10]||(s[10]=o("span",{class:"f14"},"新增",-1))],8,Ee)],512),[[re,n(e).openMap[i.code]]])]))),128))])]),o("div",Be,[o("div",Le,[n(e).activeColumnCode!=="policy"?(a(),c("div",Te,[p(q,{modelValue:n(e).q,"onUpdate:modelValue":s[2]||(s[2]=i=>n(e).q=i),placeholder:"请输入关键词",clearable:"",onKeyup:s[3]||(s[3]=ne(i=>L(),["enter"]))},{append:k(()=>[o("div",{class:"kb-search-btn flex-cc cursor bgi1 white",onClick:s[1]||(s[1]=y(i=>L(),["stop"]))},[p(W,{class:"f16"})])]),_:1},8,["modelValue"])])):N("",!0),n(e).activeColumnCode==="policy"?(a(),c("div",qe,[o("div",Fe,[o("div",Ke,[s[12]||(s[12]=o("div",{class:"policy-banner flex-col-cc white relative overflow-hidden",style:{"border-radius":"8px 8px 0 0",height:"140px","min-height":"140px","max-height":"140px",flex:"0 0 140px"}},[o("div",{class:"f36 fw z10 text-shadow"},"政策法规"),o("div",{class:"absolute ww100 hh100",style:{background:"linear-gradient(135deg, #66b1ff 0%, #A6D4FE 100%)",opacity:"0.9"}})],-1)),o("div",Oe,[s[11]||(s[11]=o("div",{class:"flex-sc mb15"},[o("div",{class:"f18 fw"},"政策法规列表")],-1)),$((a(),c("div",Pe,[(a(!0),c(f,null,v(n(e).items,(i,r)=>(a(),c("div",{key:r,class:"policy-item flex-sc p15 bb-e cursor hover-bg",onClick:w=>I(i.id)},[o("div",Ue,[o("div",Ye,u(R(x(i))),1),o("div",Je,"- "+u(U(x(i)))+" -",1)]),o("div",Ge,[o("div",He,u(b(i)),1),o("div",Qe,[o("span",We,u(i.publish_org||"发布单位未知"),1),o("span",null,u(i.doc_no||""),1)])]),o("div",Xe,[C(i)?(a(),c("img",{key:0,src:C(i),class:"ww100 hh100 object-cover"},null,8,Ze)):(a(),c("img",et))])],8,Re))),128)),n(e).items.length===0?(a(),c("div",tt,"暂无数据")):N("",!0)])),[[S,n(e).loading]]),o("div",st,[p(A,{background:"",layout:"prev, pager, next, sizes, jumper",total:n(e).total,"page-size":n(e).limit,"current-page":n(e).page,onSizeChange:z,onCurrentChange:V},null,8,["total","page-size","current-page"])])])]),o("div",ot,[s[13]||(s[13]=o("div",{class:"f16 fw mb20"},"热门知识",-1)),o("div",it,[(a(),c(f,null,v(P,(i,r)=>o("div",{key:r,class:"mb50 cursor hover-text-primary"},[o("div",nt,u(i.title),1),o("div",at,u(i.desc),1)])),64))])])])])):n(e).activeColumnCode==="case"||n(e).activeColumnCode==="expert"?(a(),c("div",lt,[o("div",ct,u(n(e).activeColumnName),1),$((a(),c("div",dt,[o("div",rt,[(a(!0),c(f,null,v(n(e).items,(i,r)=>(a(),c("div",{key:r,class:"grid-card rad8 overflow-hidden bo-e cursor hover-shadow transition-all bg-white flex-col",style:{height:"auto"},onClick:w=>I(i.id)},[o("div",mt,[C(i)?(a(),c("img",{key:0,src:C(i),class:"absolute t0 l0 ww100 hh100 object-cover"},null,8,pt)):(a(),c("img",{key:1,src:`https://picsum.photos/400/225?random=${r}`,class:"absolute t0 l0 ww100 hh100 object-cover"},null,8,_t))]),o("div",ht,[o("div",{class:"f16 fw line2 mb10",title:b(i),style:{color:"#333"}},u(b(i)),9,gt),o("div",ft,[o("span",null,u(x(i)||"2023-01-01"),1)])])],8,ut))),128))]),n(e).items.length===0?(a(),c("div",vt,"暂无数据")):N("",!0)])),[[S,n(e).loading]]),o("div",yt,[p(A,{background:"",layout:"prev, pager, next, sizes, jumper",total:n(e).total,"page-size":n(e).limit,"current-page":n(e).page,onSizeChange:z,onCurrentChange:V},null,8,["total","page-size","current-page"])])])):(a(),c("div",Ct,[o("div",bt,u(n(e).activeColumnName||"文章列表"),1),$((a(),c("div",xt,[n(e).items.length===0?(a(),c("div",wt,"暂无数据")):(a(),c("div",kt,[(a(!0),c(f,null,v(n(e).items,i=>(a(),c("div",{key:i.id,class:"kb-row cursor",onClick:y(r=>I(i.id),["stop"])},[o("div",$t,[o("div",It,[n(O)&&C(i)?(a(),M(X,{key:0,src:C(i),"preview-src-list":E(i),"initial-index":0,fit:"cover",style:{width:"72px",height:"48px","border-radius":"4px","margin-right":"12px"}},null,8,["src","preview-src-list"])):N("",!0),(a(!0),c(f,null,v(G(i),(r,w)=>(a(),c("span",{key:`${i.id}-${w}`,class:"kb-tag mr15"},u(r),1))),128)),o("span",Vt,u(b(i)),1)]),o("span",zt,u(x(i)||"-"),1)])],8,Nt))),128))]))])),[[S,n(e).loading]]),o("div",At,[p(A,{background:"",layout:"prev, pager, next, sizes, jumper",total:n(e).total,"page-size":n(e).limit,"current-page":n(e).page,onSizeChange:z,onCurrentChange:V},null,8,["total","page-size","current-page"])])]))])])]),p(Z,{modelValue:n(e).addVisible,"onUpdate:modelValue":s[7]||(s[7]=i=>n(e).addVisible=i),title:"新增二级分类",width:"420px"},{footer:k(()=>[o("div",Mt,[o("div",{class:"rad4 ptb5 plr12 flex-cc cursor bg-white c8 bo-cc-1",onClick:s[5]||(s[5]=y(i=>T(),["stop"]))},"取消"),o("div",{class:"rad4 ptb5 plr12 flex-cc cursor bgi1 white bo-i1-1 ml15",onClick:s[6]||(s[6]=y(i=>Q(),["stop"]))},"确定")])]),default:k(()=>[o("div",St,[s[14]||(s[14]=o("span",{class:"mr10"},"分类名称",-1)),o("div",jt,[p(q,{modelValue:n(e).addName,"onUpdate:modelValue":s[4]||(s[4]=i=>n(e).addName=i),placeholder:"请输入",maxlength:"30","show-word-limit":""},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}}),Ft=pe(Dt,[["__scopeId","data-v-d57a8341"]]);export{Ft as default};
