import{bj as Xe,bk as Ye,aF as he,ad as Le,aB as _,a$ as Ce,d as Se,a5 as xe,bl as Fe,bm as Ve,aC as Ne,C as Te,bn as De,bo as He,i as g,bp as je,j as ie,b as $e,D as F,o as I,z as ye,w as m,a as u,bq as Ke,f as k,x as ze,y as v,u as t,br as We,e as qe,h as L,av as B,aZ as Ze,c as O,F as ke,bh as Ge,bg as Qe,ac as N,a1 as Ue,t as Oe,bs as Je,b2 as _e,ah as ea,bt as aa,bu as ta,bv as sa,K as d,b6 as na,bw as oa,G as la,H as Z,bx as ra,n as Re,X as Ae,ai as ia,by as ua,bz as ca,aQ as Ee,ba as da,bA as be,bB as we,T as J,bC as fa,am as va,bD as ma,bE as ga,bF as pa,bG as ba,L as wa}from"./index-CymMRwSV.js";var ha="Expected a function";function re(a,V,T){var c=!0,f=!0;if(typeof a!="function")throw new TypeError(ha);return Xe(T)&&(c="leading"in T?!!T.leading:c,f="trailing"in T?!!T.trailing:f),Ye(a,V,{leading:c,maxWait:V,trailing:f})}const ya=Le({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:_([String,Object])},previewSrcList:{type:_(Array),default:()=>Ce([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:_(String)}}),ka={load:a=>a instanceof Event,error:a=>a instanceof Event,switch:a=>he(a),close:()=>!0,show:()=>!0},Ia=Le({urlList:{type:_(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:_(String)}}),xa={close:()=>!0,error:a=>a instanceof Event,switch:a=>he(a),rotate:a=>he(a)},za=["src","crossorigin"];var Ea=Se({name:"ElImageViewer",__name:"image-viewer",props:Ia,emits:xa,setup(a,{expose:V,emit:T}){var c;const f={CONTAIN:{name:"contain",icon:xe(Ve)},ORIGINAL:{name:"original",icon:xe(Fe)}},i=a,p=T;let G;const{t:ee}=Ne(),l=Te("image-viewer"),{nextZIndex:Q}=De(),x=g(),$=g(),D=He(),R=d(()=>{const{scale:e,minScale:n,maxScale:r}=i;return ra(e,n,r)}),b=g(!0),M=g(!1),A=g(!1),w=g(i.initialIndex),H=na(f.CONTAIN),o=g({scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ue=g((c=i.zIndex)!=null?c:Q());je(A,{ns:l});const ae=d(()=>{const{urlList:e}=i;return e.length<=1}),j=d(()=>w.value===0),te=d(()=>w.value===i.urlList.length-1),K=d(()=>i.urlList[w.value]),ce=d(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!i.infinite&&j.value)]),se=d(()=>[l.e("btn"),l.e("next"),l.is("disabled",!i.infinite&&te.value)]),ne=d(()=>{const{scale:e,deg:n,offsetX:r,offsetY:E,enableTransition:C}=o.value;let y=r/e,S=E/e;const q=n*Math.PI/180,Y=Math.cos(q),U=Math.sin(q);y=y*Y+S*U,S=S*Y-r/e*U;const pe={transform:`scale(${e}) rotate(${n}deg) translate(${y}px, ${S}px)`,transition:C?"transform .3s":""};return H.value.name===f.CONTAIN.name&&(pe.maxWidth=pe.maxHeight="100%"),pe}),oe=d(()=>`${w.value+1} / ${i.urlList.length}`);function X(){fe(),G?.(),A.value=!1,p("close")}function de(){const e=re(r=>{switch(la(r)){case Z.esc:i.closeOnPressEscape&&X();break;case Z.space:ve();break;case Z.left:me();break;case Z.up:P("zoomIn");break;case Z.right:ge();break;case Z.down:P("zoomOut");break}}),n=re(r=>{const E=r.deltaY||r.deltaX;P(E<0?"zoomIn":"zoomOut",{zoomRate:i.zoomRate,enableTransition:!1})});D.run(()=>{F(document,"keydown",e),F(x,"wheel",n)})}function fe(){D.stop()}function s(){b.value=!1}function z(e){M.value=!0,b.value=!1,p("error",e),e.target.alt=ee("el.image.error")}function h(e){if(b.value||e.button!==0||!x.value)return;o.value.enableTransition=!1;const{offsetX:n,offsetY:r}=o.value,E=e.pageX,C=e.pageY,y=re(Y=>{o.value={...o.value,offsetX:n+Y.pageX-E,offsetY:r+Y.pageY-C}}),S=F(document,"mousemove",y),q=F(document,"mouseup",()=>{S(),q()});e.preventDefault()}function W(e){if(b.value||!x.value||e.touches.length!==1)return;o.value.enableTransition=!1;const{offsetX:n,offsetY:r}=o.value,{pageX:E,pageY:C}=e.touches[0],y=re(Y=>{const U=Y.touches[0];o.value={...o.value,offsetX:n+U.pageX-E,offsetY:r+U.pageY-C}}),S=F(document,"touchmove",y),q=F(document,"touchend",()=>{S(),q()});e.preventDefault()}function Ie(){o.value={scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ve(){if(b.value||M.value)return;const e=oa(f),n=Object.values(f),r=H.value.name,C=(n.findIndex(y=>y.name===r)+1)%e.length;H.value=f[e[C]],Ie()}function le(e){M.value=!1;const n=i.urlList.length;w.value=(e+n)%n}function me(){j.value&&!i.infinite||le(w.value-1)}function ge(){te.value&&!i.infinite||le(w.value+1)}function P(e,n={}){if(b.value||M.value)return;const{minScale:r,maxScale:E}=i,{zoomRate:C,rotateDeg:y,enableTransition:S}={zoomRate:i.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":o.value.scale>r&&(o.value.scale=Number.parseFloat((o.value.scale/C).toFixed(3)));break;case"zoomIn":o.value.scale<E&&(o.value.scale=Number.parseFloat((o.value.scale*C).toFixed(3)));break;case"clockwise":o.value.deg+=y,p("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=y,p("rotate",o.value.deg);break}o.value.enableTransition=S}function Pe(e){var n;((n=e.detail)==null?void 0:n.focusReason)==="pointer"&&e.preventDefault()}function Be(){i.closeOnPressEscape&&X()}function Me(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ie(()=>R.value,e=>{o.value.scale=e}),ie(K,()=>{Re(()=>{const e=$.value;e?.complete||(b.value=!0)})}),ie(w,e=>{Ie(),p("switch",e)}),$e(()=>{A.value=!0,de(),G=F("wheel",Me,{passive:!1})}),V({setActiveItem:le}),(e,n)=>(I(),ye(t(sa),{to:"body",disabled:!a.teleported},{default:m(()=>[u(Ke,{name:"viewer-fade",appear:""},{default:m(()=>[k("div",{ref_key:"wrapper",ref:x,tabindex:-1,class:v(t(l).e("wrapper")),style:ze({zIndex:ue.value})},[u(t(We),{loop:"",trapped:"","focus-trap-el":x.value,"focus-start-el":"container",onFocusoutPrevented:Pe,onReleaseRequested:Be},{default:m(()=>[k("div",{class:v(t(l).e("mask")),onClick:n[0]||(n[0]=qe(r=>a.hideOnClickModal&&X(),["self"]))},null,2),L(" CLOSE "),k("span",{class:v([t(l).e("btn"),t(l).e("close")]),onClick:X},[u(t(B),null,{default:m(()=>[u(t(Ze))]),_:1})],2),L(" ARROW "),ae.value?L("v-if",!0):(I(),O(ke,{key:0},[k("span",{class:v(ce.value),onClick:me},[u(t(B),null,{default:m(()=>[u(t(Ge))]),_:1})],2),k("span",{class:v(se.value),onClick:ge},[u(t(B),null,{default:m(()=>[u(t(Qe))]),_:1})],2)],64)),e.$slots.progress||a.showProgress?(I(),O("div",{key:1,class:v([t(l).e("btn"),t(l).e("progress")])},[N(e.$slots,"progress",{activeIndex:w.value,total:a.urlList.length},()=>[Ue(Oe(oe.value),1)])],2)):L("v-if",!0),L(" ACTIONS "),k("div",{class:v([t(l).e("btn"),t(l).e("actions")])},[k("div",{class:v(t(l).e("actions__inner"))},[N(e.$slots,"toolbar",{actions:P,prev:me,next:ge,reset:ve,activeIndex:w.value,setActiveItem:le},()=>[u(t(B),{onClick:n[1]||(n[1]=r=>P("zoomOut"))},{default:m(()=>[u(t(Je))]),_:1}),u(t(B),{onClick:n[2]||(n[2]=r=>P("zoomIn"))},{default:m(()=>[u(t(_e))]),_:1}),k("i",{class:v(t(l).e("actions__divider"))},null,2),u(t(B),{onClick:ve},{default:m(()=>[(I(),ye(ea(H.value.icon)))]),_:1}),k("i",{class:v(t(l).e("actions__divider"))},null,2),u(t(B),{onClick:n[3]||(n[3]=r=>P("anticlockwise"))},{default:m(()=>[u(t(aa))]),_:1}),u(t(B),{onClick:n[4]||(n[4]=r=>P("clockwise"))},{default:m(()=>[u(t(ta))]),_:1})])],2)],2),L(" CANVAS "),k("div",{class:v(t(l).e("canvas"))},[M.value&&e.$slots["viewer-error"]?N(e.$slots,"viewer-error",{key:0,activeIndex:w.value,src:K.value}):(I(),O("img",{ref_key:"imgRef",ref:$,key:K.value,src:K.value,style:ze(ne.value),class:v(t(l).e("img")),crossorigin:a.crossorigin,onLoad:s,onError:z,onMousedown:h,onTouchstart:W},null,46,za))],2),N(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});const La=Ae(Ea),Ca=["src","loading","crossorigin"],Sa={key:0};var Na=Se({name:"ElImage",inheritAttrs:!1,__name:"image",props:ya,emits:ka,setup(a,{expose:V,emit:T}){const c=a,f=T,{t:i}=Ne(),p=Te("image"),G=ia(),ee=d(()=>ba(Object.entries(G).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),l=ua({excludeListeners:!0,excludeKeys:d(()=>Object.keys(ee.value))}),Q=g(),x=g(!1),$=g(!0),D=g(!1),R=g(),b=g(),M=J&&"loading"in HTMLImageElement.prototype;let A;const w=d(()=>[p.e("inner"),o.value&&p.e("preview"),$.value&&p.is("loading")]),H=d(()=>{const{fit:s}=c;return J&&s?{objectFit:s}:{}}),o=d(()=>{const{previewSrcList:s}=c;return wa(s)&&s.length>0}),ue=d(()=>{const{previewSrcList:s,initialIndex:z}=c;let h=z;return z>s.length-1&&(h=0),h}),ae=d(()=>c.loading==="eager"?!1:!M&&c.loading==="lazy"||c.lazy),j=()=>{J&&($.value=!0,x.value=!1,Q.value=c.src)};function te(s){$.value=!1,x.value=!1,f("load",s)}function K(s){$.value=!1,x.value=!0,f("error",s)}function ce(s){s&&(j(),oe())}const se=ca(ce,200,!0);async function ne(){var s;if(!J)return;await Re();const{scrollContainer:z}=c;if(fa(z))b.value=z;else if(va(z)&&z!=="")b.value=(s=document.querySelector(z))!=null?s:void 0;else if(R.value){const W=ma(R.value);b.value=ga(W)?void 0:W}const{stop:h}=pa(R,([W])=>{se(W.isIntersecting)},{root:b});A=h}function oe(){!J||!se||(A?.(),b.value=void 0,A=void 0)}function X(){o.value&&(D.value=!0,f("show"))}function de(){D.value=!1,f("close")}function fe(s){f("switch",s)}return ie(()=>c.src,()=>{ae.value?($.value=!0,x.value=!1,oe(),ne()):j()}),$e(()=>{ae.value?ne():j()}),V({showPreview:X}),(s,z)=>(I(),O("div",Ee({ref_key:"container",ref:R},ee.value,{class:[t(p).b(),s.$attrs.class]}),[x.value?N(s.$slots,"error",{key:0},()=>[k("div",{class:v(t(p).e("error"))},Oe(t(i)("el.image.error")),3)]):(I(),O(ke,{key:1},[Q.value!==void 0?(I(),O("img",Ee({key:0},t(l),{src:Q.value,loading:a.loading,style:H.value,class:w.value,crossorigin:a.crossorigin,onClick:X,onLoad:te,onError:K}),null,16,Ca)):L("v-if",!0),$.value?(I(),O("div",{key:1,class:v(t(p).e("wrapper"))},[N(s.$slots,"placeholder",{},()=>[k("div",{class:v(t(p).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),o.value?(I(),O(ke,{key:2},[D.value?(I(),ye(t(La),{key:0,"z-index":a.zIndex,"initial-index":ue.value,infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,scale:a.scale,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:de,onSwitch:fe},da({toolbar:m(h=>[N(s.$slots,"toolbar",be(we(h)))]),default:m(()=>[s.$slots.viewer?(I(),O("div",Sa,[N(s.$slots,"viewer")])):L("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:m(h=>[N(s.$slots,"progress",be(we(h)))]),key:"0"}:void 0,s.$slots["viewer-error"]?{name:"viewer-error",fn:m(h=>[N(s.$slots,"viewer-error",be(we(h)))]),key:"1"}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],16))}});const $a=Ae(Na);export{$a as E};
