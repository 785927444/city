import{d as U,g as L,r as M,j as y,o as u,c as b,f as i,a as o,Z as j,u as t,w as c,e as d,i as h,$ as B,E as N,a8 as P,F as O,p as R,y as q,cD as H,k as K,v as Z,t as G,z as J,h as Q,K as W,l as X}from"./index-ClTGGYJq.js";import{_ as ee}from"./FileList.vue_vue_type_script_setup_true_lang-Bn2Vhi25.js";import{_ as te}from"./List.vue_vue_type_script_setup_true_lang-GWlOrLxS.js";import{_ as ae}from"./question-filled-DXo9CDBC.js";import{_ as se}from"./SchemeAutoFill.vue_vue_type_script_setup_true_lang-BoB9I4Xx.js";import{v as x}from"./v6-B4YtUg27.js";import"./ViewFiles-BGc_2hC6.js";import"./UploadText-Czi9cq55.js";/* empty css                    *//* empty css                   */import"./index-BewEhLyo.js";import"./index-DIHLlVQH.js";/* empty css                                                                   */import"./el-image-viewer-BSQBUEyb.js";import"./el-switch-C5epoo5P.js";import"./select-CebIyQvO.js";const le={class:"layout-col overlay"},oe={class:"hh100 ww100 flex-sc warp"},re={class:"flex-sc warp ww100"},ne={class:"ww100 flex-sc pb20"},ie=["onClick"],ce={class:"absolute f14 t10 r-18"},pe={class:"ww100 flex-cc f18 p40 bot-i16-1 mt20"},me=U({__name:"step2",props:{state:{type:[Object,Array],default:()=>({})},contents:{type:Array,default:[]},active:{type:[Object,Array],default:()=>({})}},setup(g){const{proxy:p}=L(),e=p.publicStore();p.configStore(),p.dictStore();let f=h(),V=h({});const _=[{value:"1",name:"重点落实任务"},{value:"2",name:"体检整改任务"}],A=M({...e.$state,content:[{name:"任务中类",key:"task_class",type:"input",width:"flex1"},{name:"建设内容",key:"construct_content",type:"input",width:"w300"},{name:"年份",key:"year",type:"input",width:"w100"},{name:"值",key:"value",type:"input",width:"w100"},{name:"操作",key:{add:"新增",del:"删除"},width:"w100"}]}),w=l=>({id:x(),task_type:l,task_class:"",construct_content:"",year:"",value:""}),k=()=>{e.form&&(Array.isArray(e.form.task)||(e.form.task=[]))},m=l=>{if(k(),!l)return;const a=e.form.task;a.some(n=>String(n.task_type)===String(l))||a.push(w(l))};(!e.current||!e.current.value)&&(e.current=_[0]),m(e.current.value),y(()=>e.current?.value,l=>{m(l)},{immediate:!0}),y(()=>e.form?.task,()=>{m(e.current?.value)},{immediate:!0});const C=W(()=>{const l=e.current?.value,r=(Array.isArray(e.form?.task)?e.form.task:[]).filter(n=>String(n.task_type)===String(l));return r.length>0?r:[w(l)]}),v=g,S=l=>{l&&l.validate(a=>{a&&e.actIndex++})},D=(l,a)=>{if(k(),l==="add")e.form.task.push({id:x(),task_type:e.current.value,task_class:"",construct_content:"",year:"",value:""});else if(l==="del"){const r=e.form.task.indexOf(a);r>-1&&e.form.task.splice(r,1),a.id&&e.http({deleteApi:{model:"t_project_task",list:[a.id]}})}};return(l,a)=>{const r=N,n=B,Y=P,$=ae,z=H,E=te,F=ee,I=j;return u(),b("div",le,[i("div",oe,[o(I,{class:"ww100 pplr15",ref_key:"formRef",ref:f,model:t(e).form,rules:t(V),"label-width":"120"},{default:c(()=>[i("div",re,[o(n,{label:"方案名称",prop:"plan_name",class:"ww50 flex-sc"},{default:c(()=>[o(r,{size:"large",modelValue:t(e).form.plan_name,"onUpdate:modelValue":a[0]||(a[0]=s=>t(e).form.plan_name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(n,{label:"方案编制单位",prop:"plan_unit",class:"ww50 flex-sc"},{default:c(()=>[o(r,{size:"large",modelValue:t(e).form.plan_unit,"onUpdate:modelValue":a[1]||(a[1]=s=>t(e).form.plan_unit=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(n,{label:"复批时间",prop:"approval_time",class:"ww50 flex-sc"},{default:c(()=>[o(Y,{modelValue:t(e).form.approval_time,"onUpdate:modelValue":a[2]||(a[2]=s=>t(e).form.approval_time=s),style:{width:"100%"},size:"large",type:"datetime",placeholder:"请选择",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),o(n,{label:"方案摘要",prop:"plan_abstract",class:"ww100 flex-sc"},{default:c(()=>[o(r,{size:"large",modelValue:t(e).form.plan_abstract,"onUpdate:modelValue":a[3]||(a[3]=s=>t(e).form.plan_abstract=s),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(n,{label:"基础建设条件",prop:"condition",class:"ww100 flex-sc"},{default:c(()=>[o(r,{size:"large",modelValue:t(e).form.condition,"onUpdate:modelValue":a[4]||(a[4]=s=>t(e).form.condition=s),type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(n,{label:"项目任务",prop:"tasks",class:"ww100 flex-ss"},{default:c(()=>[i("div",ne,[(u(),b(O,null,R(_,(s,T)=>i("div",{class:q(["mr40 pb10 f18 relative cursor actfont",t(e).current.value==s.value?"i1 bob-i1-2":"bob-tt-2"]),key:T,onClick:d(ue=>t(e).current={...s},["stop"])},[o(z,{content:s.describe,placement:"top-start"},{reference:c(()=>[i("div",ce,[K(o($,null,null,512),[[Z,s.describe]])])]),_:2},1032,["content"]),i("span",null,G(s.name),1)],10,ie)),64))]),o(E,{onHandleClick:D,state:t(A),hasLists:!0,lists:t(C)},null,8,["state","lists"])]),_:1}),o(se,{"scheme-id":t(e).form.parent_id,"area-value":t(e).form.parent_area,"task-type":t(e).form.task_type,draft:t(e).form,"scheme-plans":t(e)._public?.schemePlans?t(e)._public.schemePlans:[],"scheme-areas":t(e)._public?.schemeAreas?t(e)._public.schemeAreas:[]},null,8,["scheme-id","area-value","task-type","draft","scheme-plans","scheme-areas"]),o(n,{label:"实施方案文件上传",prop:"files",class:"ww100 flex-ss"},{default:c(()=>[t(e).form?.plan_attr?(u(),J(F,{key:0,files:t(e).form.plan_attr,"onUpdate:files":a[5]||(a[5]=s=>t(e).form.plan_attr=s),contents:v.contents,active:v.active},null,8,["files","contents","active"])):Q("",!0)]),_:1})])]),_:1},8,["model","rules"]),i("div",pe,[i("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:a[6]||(a[6]=d(s=>t(e).actIndex--,["stop"]))},"上一步"),i("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:a[7]||(a[7]=d(s=>S(t(f)),["stop"]))},"下一步")])])])}}}),Ye=X(me,[["__scopeId","data-v-66538473"]]);export{Ye as default};
