import{d as B,g as I,r as L,j as g,o as k,c as $,a as _,w as u,u as n,z as D,Z as K,f as c,e as R,c3 as V,h as J,t as M,i as O,a3 as b,a4 as d,n as y}from"./index-ClTGGYJq.js";import{E as P}from"./el-text-BVPNU7sV.js";/* empty css                    */import{_ as T}from"./AaTitle.vue_vue_type_script_setup_true_lang-DQZ6AruM.js";const j={class:"layout-col"},z={class:"layout-col white-rgba50 rad8 p15"},F={class:"table-col"},Z={class:"flex-bc"},Y=B({__name:"route",setup(G){const{proxy:r}=I(),i=r.publicStore(),h=r.configStore();let p=O();const x={children:"children",label:"name"},s=L({...i.$state,content:[{width:"flex1",show:!0,align:"start",key:"name",name:"名称",type:"icon2"}]});g(()=>i._public.routeList,async a=>{await y(),!r.isNull(a)&&v()},{immediate:!1,deep:!0}),g(()=>i.active,async a=>{await y(),!r.isNull(a)&&(v(),f())},{immediate:!1,deep:!0});const v=async()=>{if(r.isNull(i._public.routeList)||r.isNull(i.active))return;let a=i.active[s.key]==1||h.user&&h.user.role_id=="1"?i._public.routeList:i._public.routeList.filter(e=>e.path!="/route"&&e.path!="/auth");s.tree=r.treeData(a.sort((e,t)=>e.order-t.order),s.key,s.parent,"children")},f=async a=>{s.query={model:"t_role_route",args:`role_id='${i.active[s.key]}'`,field:"route_id"},s.params={Api:s.query};let e=await i.http(s.params);s.list=r.isNull(e)?[]:r.isNull(e)?[]:e,N()},N=async a=>{s.active=s.list.map(t=>t.route_id);let e=q(s.tree,JSON.parse(JSON.stringify(s.active)));console.log("active--route",e),await y(),p.value.setCheckedKeys(e,!1)},S=async a=>{let e=p.value.getCheckedKeys(!1);e=A(s.tree,e);const t=e.filter(l=>!s.active.includes(l)),o=s.active.filter(l=>!e.includes(l));r.isNull(t)||await C(t),r.isNull(o)||await E(o)},C=async a=>{let e={model:"t_role_route",list:[]};e.list=a.map(t=>({role_id:i.active[s.key],route_id:t})),b.addApi(e).then(t=>{t.code==200?(f(),d({title:"提示",message:"添加成功",type:"success"})):d({title:"提示",message:"添加失败",type:"error"})}).catch(t=>{d({title:"提示",message:"添加失败",type:"error"})})},E=async a=>{let e={model:"t_role_route",list:[]};e.list=a.map(t=>({role_id:i.active[s.key],route_id:t})),b.delApi(e).then(t=>{t.code==200&&(f(),d({title:"提示",message:"删除成功",type:"success"}))}).catch(t=>{d({title:"提示",message:"删除失败",type:"error"})})},A=(a,e)=>{const t=new Set;for(const o of a)for(const l of o.children)e.includes(l.id)&&!e.includes(o.id)&&t.add(o.id);return Array.from(t).concat(e)},q=(a,e)=>(a.forEach(t=>{if(t.parent_id==0){let o=e.findIndex(l=>l==t.id);if(o!=-1&&t.children){const l=new Set(e);t.children.every(m=>l.has(m.id))||e.splice(o,1)}}}),e);return(a,e)=>{const t=V,o=K,l=T,m=P;return k(),$("div",j,[_(l,{title:a.isNull(n(i).active)?"":n(i).active.name+" - 路由配置"},{"left-content":u(()=>[...e[1]||(e[1]=[])]),"right-content":u(()=>[n(s).auth.upd?(k(),D(o,{key:0,class:"ww100 flex-ec",model:n(s).from,"label-width":"115px"},{default:u(()=>[c("div",{class:"rad4 ptb5 plr8 flex-cc cursor bgi1 white ml10",onClick:e[0]||(e[0]=R(w=>S(a.formRef),["stop"]))},[_(t,{class:"f12 fw"}),e[2]||(e[2]=c("span",{class:"f14 ml2"},"保存",-1))])]),_:1},8,["model"])):J("",!0)]),_:1},8,["title"]),c("div",z,[c("div",F,[_(m,{data:n(s).tree,props:x,"default-expand-all":!0,"node-key":n(s).key,ref_key:"treeRef",ref:p,class:"ww100","highlight-current":"","empty-text":"暂无数据","show-checkbox":""},{default:u(({node:w,data:H})=>[c("span",Z,[c("span",null,M(w.label),1)])]),_:1},8,["data","node-key"])])])])}}});export{Y as _};
