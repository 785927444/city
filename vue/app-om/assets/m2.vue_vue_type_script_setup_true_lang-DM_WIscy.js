import{d as P,g as D,aa as q,r as T,j as B,o as w,c as x,a as s,w as d,f as l,e as g,u as o,A as M,F as R,q as O,z as U,B as j,k as J,x as L,t as k,ce as Y,h as z,i as G,n as H}from"./index-BWjCSAnw.js";import{v as K}from"./el-loading-CMa3kpEq.js";import{_ as Q}from"./Problems-DN-uvPrB.js";import{a as W,E as X}from"./el-table-column-Bxfuucky.js";import"./el-checkbox-DlSjzc6V.js";import{_ as Z}from"./AaTitle.vue_vue_type_script_setup_true_lang-Dok3GIN-.js";import{_ as I}from"./filter-CFoa9Riw.js";const ee={class:"layout-col"},te={class:"flex-sc mr30"},le={class:"w50x3"},ae={class:"flex-sc mr15"},ne={class:"w50x6 flex-sc"},se={class:"layout-col"},oe={class:"line2"},ie=["onClick"],re=["onClick"],ge=P({__name:"m2",setup(pe){const{proxy:f}=D(),m=f.publicStore();f.configStore();const y=q(),h=[{value:"1",name:"限时整改",color:"i5"},{value:"2",name:"尽力整改",color:"i11"}];let $=G();const a=T({...m.$state,status:"all"}),F=n=>parseInt(a.page)+n,N=({row:n,column:e,rowIndex:r,columnIndex:b})=>{const c=a.list;if(b===1){const p="parent_id",u=n[p];if(r===0||c[r-1][p]!==u){let i=1;for(let _=r+1;_<c.length&&c[_][p]===u;_++)i++;return{rowspan:i,colspan:1}}else return{rowspan:0,colspan:0}}if(b===2){const p=e.property,u=n[p];if(r===0||c[r-1][p]!==u){let i=1;for(let _=r+1;_<c.length&&c[_][p]===u;_++)i++;return{rowspan:i,colspan:1}}else return{rowspan:0,colspan:0}}return{rowspan:1,colspan:1}};B(()=>m.active,async(n,e)=>{f.isNull(n)||JSON.stringify(n)!=JSON.stringify(e)&&(await H(),C())},{immediate:!1,deep:!0});const C=async()=>{let n={model:"t_task_problem",args:`parent_id='${m.active.id}'`,order:"orderd ASC"},e={model:"t_scheme_problem",args:`scheme_id='${y.query.id}' and parents_id='${m.active.id}'`};if(a.action_type!==""&&a.action_type!=null&&(e.args+=` and action_type='${a.action_type}'`),!f.isNull(a.datetime)){const[b,c]=a.datetime,p=new Date(b.getFullYear(),0,1).getTime()+"",u=new Date(c.getFullYear(),11,31,23,59,59,999).getTime()+"";e.args+=` and check_time>='${p}' and check_time<='${u}'`}let r=await m.http({Api1:n,Api2:e});a.task_problems=f.isNull(r.Api1)?[]:r.Api1,a.list=f.isNull(r.Api2)?[]:r.Api2,console.log("state.list",a.list)};return(n,e)=>{const r=U,b=M,c=j,p=I,u=Z,i=W,_=Y,S=X,V=Q,A=K;return w(),x("div",ee,[s(u,{title:""},{"left-content":d(()=>[l("div",te,[e[6]||(e[6]=l("span",{class:"mr10"},"整治类型",-1)),l("span",le,[s(b,{modelValue:o(a).action_type,"onUpdate:modelValue":e[0]||(e[0]=t=>o(a).action_type=t),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:d(()=>[(w(),x(R,null,O(h,(t,v)=>s(r,{key:t.value,value:String(t.value),label:t.name},null,8,["value","label"])),64))]),_:1},8,["modelValue"])])]),l("div",ae,[e[7]||(e[7]=l("span",{class:"mr10"},"体检年度",-1)),l("span",ne,[s(c,{class:"",style:{width:"100%"},modelValue:o(a).datetime,"onUpdate:modelValue":e[1]||(e[1]=t=>o(a).datetime=t),type:"yearrange","range-separator":"-","start-placeholder":"请选择年度","end-placeholder":"请选择年度"},null,8,["modelValue"])])]),l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bgi1 white",onClick:e[2]||(e[2]=g(t=>C(),["stop"]))},[s(p,{class:"f12 fw"}),e[8]||(e[8]=l("span",{class:"f14 ml5"},"搜索",-1))])]),"right-content":d(()=>[l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bo-i1-1 i1 ml15",onClick:e[3]||(e[3]=g(t=>n.toPath("/problemResult",{scheme_id:o(y).query.id,id:o(m).active.id,parent_id:o(m).active.parent_id}),["stop"]))},[...e[9]||(e[9]=[l("span",{class:"f14 ml5"},"指标评价结果",-1)])]),l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bo-i1-1 i1 ml15",onClick:e[4]||(e[4]=g(t=>n.toPath("/problemUpdata",{scheme_id:o(y).query.id,id:o(m).active.id,parent_id:o(m).active.parent_id}),["stop"]))},[...e[10]||(e[10]=[l("span",{class:"f14 ml5"},"整改进度更新",-1)])]),l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bo-i1-1 i1 ml15",onClick:e[5]||(e[5]=g(t=>n.toPath("/problemTrack"),["stop"]))},[...e[11]||(e[11]=[l("span",{class:"f14 ml5"},"返回",-1)])])]),_:1}),l("div",se,[n.isNull(o(a).list)?z("",!0):J((w(),L(S,{key:0,"header-cell-class-name":"bgi16 c3","cell-style":{"background-color":"#FFFFFF",color:"#626366"},"span-method":N,border:"","empty-text":"暂无数据",data:o(a).list,stripe:""},{default:d(()=>[s(i,{type:"index",index:F,label:"序号",align:"center",width:"50"}),s(i,{label:"指标项",width:"150"},{default:d((t,v)=>[l("span",null,k(t.row.parent_id?n.find(o(a).task_problems,["id",t.row.parent_id],"name"):""),1)]),_:1}),s(i,{prop:"result",label:"体检结果",align:"center",width:"80"}),s(i,{label:"存在问题"},{default:d((t,v)=>[s(_,{title:"存在问题",width:"700",content:t.row.problem_content,placement:"top-start"},{reference:d(()=>[l("span",oe,k(t.row.problem_content),1)]),_:2},1032,["content"])]),_:1}),s(i,{label:"整治类型",align:"center",width:"80"},{default:d((t,v)=>[l("span",null,k(t.row.action_type?n.find(h,["value",t.row.action_type],"name"):""),1)]),_:1}),s(i,{prop:"problem_num",label:"问题数量",width:"80",align:"center"}),s(i,{prop:"action_rate",label:"整改进度",width:"80",align:"center"}),s(i,{label:"问题区域",width:"100",align:"center"},{default:d((t,v)=>[l("span",{class:"i1 cursor",onClick:g(E=>o($).onVisable(t.row),["stop"])},"查看问题分布",8,ie)]),_:1}),s(i,{label:"整改项目清单",width:"100",align:"center"},{default:d((t,v)=>[l("span",{class:"i1 cursor",onClick:g(E=>n.toPath("/schemePlansManagerCity",{id:t.row.id}),["stop"])},"查看项目清单",8,re)]),_:1})]),_:1},8,["data"])),[[A,o(a).loading,void 0,{fullscreen:!0,lock:!0}]])]),s(V,{state:o(a),ref_key:"problemRef",ref:$},null,8,["state"])])}}});export{ge as _};
