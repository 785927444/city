import{d as A,g as D,a6 as q,r as T,j as B,o as h,c as x,a as n,w as c,f as l,e as g,u as i,m as M,F as R,p as O,q as U,a8 as j,k as J,z as L,t as y,cE as Y,h as z,i as G,n as H,l as K}from"./index-BF5jje68.js";import{v as Q}from"./el-loading-DNd19Xuc.js";import{_ as W}from"./Problems-CuiGWG2f.js";/* empty css                        *//* empty css                    */import{_ as X}from"./AaTitle.vue_vue_type_script_setup_true_lang-msvlqApB.js";import{_ as Z}from"./filter-BWaskIWj.js";import{a as I,E as ee}from"./index-fed1VsgQ.js";import"./index-VYQ43fvS.js";const te={class:"layout-col"},le={class:"flex-sc mr30"},ae={class:"w50x3"},se={class:"flex-sc mr15"},ne={class:"w50x6 flex-sc"},oe={class:"layout-col"},ie={class:"problem-content f18 h50x8"},re={class:"hh100 overlay flex-col"},pe={class:"line2"},ce=["onClick"],de=["onClick"],me=A({__name:"m2",setup(_e){const{proxy:f}=D(),m=f.publicStore();f.configStore();const w=q(),k=[{value:"1",name:"限时整改",color:"i5"},{value:"2",name:"尽力整改",color:"i11"}];let $=G();const a=T({...m.$state,status:"all"}),F=s=>parseInt(a.page)+s,N=({row:s,column:e,rowIndex:r,columnIndex:b})=>{const d=a.list;if(b===1){const p="parent_id",_=s[p];if(r===0||d[r-1][p]!==_){let o=1;for(let u=r+1;u<d.length&&d[u][p]===_;u++)o++;return{rowspan:o,colspan:1}}else return{rowspan:0,colspan:0}}if(b===2){const p=e.property,_=s[p];if(r===0||d[r-1][p]!==_){let o=1;for(let u=r+1;u<d.length&&d[u][p]===_;u++)o++;return{rowspan:o,colspan:1}}else return{rowspan:0,colspan:0}}return{rowspan:1,colspan:1}};B(()=>m.active,async(s,e)=>{f.isNull(s)||JSON.stringify(s)!=JSON.stringify(e)&&(await H(),C())},{immediate:!1,deep:!0});const C=async()=>{let s={model:"t_task_problem",args:`parent_id='${m.active.id}'`,order:"orderd ASC"},e={model:"t_scheme_problem",args:`scheme_id='${w.query.id}' and parents_id='${m.active.id}'`};if(a.action_type!==""&&a.action_type!=null&&(e.args+=` and action_type='${a.action_type}'`),!f.isNull(a.datetime)){const[b,d]=a.datetime,p=new Date(b.getFullYear(),0,1).getTime()+"",_=new Date(d.getFullYear(),11,31,23,59,59,999).getTime()+"";e.args+=` and check_time>='${p}' and check_time<='${_}'`}let r=await m.http({Api1:s,Api2:e});a.task_problems=f.isNull(r.Api1)?[]:r.Api1,a.list=f.isNull(r.Api2)?[]:r.Api2,console.log("state.list",a.list)};return(s,e)=>{const r=U,b=M,d=j,p=Z,_=X,o=I,u=Y,S=ee,V=W,E=Q;return h(),x("div",te,[n(_,{title:""},{"left-content":c(()=>[l("div",le,[e[6]||(e[6]=l("span",{class:"mr10"},"整治类型",-1)),l("span",ae,[n(b,{modelValue:i(a).action_type,"onUpdate:modelValue":e[0]||(e[0]=t=>i(a).action_type=t),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:c(()=>[(h(),x(R,null,O(k,(t,v)=>n(r,{key:t.value,value:String(t.value),label:t.name},null,8,["value","label"])),64))]),_:1},8,["modelValue"])])]),l("div",se,[e[7]||(e[7]=l("span",{class:"mr10"},"体检年度",-1)),l("span",ne,[n(d,{class:"",style:{width:"100%"},modelValue:i(a).datetime,"onUpdate:modelValue":e[1]||(e[1]=t=>i(a).datetime=t),type:"yearrange","range-separator":"-","start-placeholder":"请选择年度","end-placeholder":"请选择年度"},null,8,["modelValue"])])]),l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bgi1 white",onClick:e[2]||(e[2]=g(t=>C(),["stop"]))},[n(p,{class:"f12 fw"}),e[8]||(e[8]=l("span",{class:"f14 ml5"},"搜索",-1))])]),"right-content":c(()=>[l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bo-i1-1 i1 ml15",onClick:e[3]||(e[3]=g(t=>s.toPath("/problemResult",{scheme_id:i(w).query.id,id:i(m).active.id,parent_id:i(m).active.parent_id}),["stop"]))},[...e[9]||(e[9]=[l("span",{class:"f14 ml5"},"指标评价结果",-1)])]),l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bo-i1-1 i1 ml15",onClick:e[4]||(e[4]=g(t=>s.toPath("/problemUpdata",{scheme_id:i(w).query.id,id:i(m).active.id,parent_id:i(m).active.parent_id}),["stop"]))},[...e[10]||(e[10]=[l("span",{class:"f14 ml5"},"整改进度更新",-1)])]),l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bo-i1-1 i1 ml15",onClick:e[5]||(e[5]=g(t=>s.toPath("/problemTrack"),["stop"]))},[...e[11]||(e[11]=[l("span",{class:"f14 ml5"},"返回",-1)])])]),_:1}),l("div",oe,[s.isNull(i(a).list)?z("",!0):J((h(),L(S,{key:0,"header-cell-class-name":"bgi16 c3","cell-style":{"background-color":"#FFFFFF",color:"#626366"},"span-method":N,border:"","empty-text":"暂无数据",data:i(a).list,stripe:""},{default:c(()=>[n(o,{type:"index",index:F,label:"序号",align:"center",width:"50"}),n(o,{label:"指标项",width:"150"},{default:c((t,v)=>[l("span",null,y(t.row.parent_id?s.find(i(a).task_problems,["id",t.row.parent_id],"name"):""),1)]),_:1}),n(o,{prop:"result",label:"体检结果",align:"center",width:"80"}),n(o,{label:"存在问题"},{default:c((t,v)=>[n(u,{title:"",width:"800",placement:"top-start"},{default:c(()=>[l("div",ie,[l("div",re,y(t.row.problem_content),1)])]),reference:c(()=>[l("span",pe,y(t.row.problem_content),1)]),_:2},1024)]),_:1}),n(o,{label:"整治类型",align:"center",width:"80"},{default:c((t,v)=>[l("span",null,y(t.row.action_type?s.find(k,["value",t.row.action_type],"name"):""),1)]),_:1}),n(o,{prop:"action_unit",label:"责任单位",width:"100",align:"center"}),n(o,{prop:"problem_num",label:"问题数量",width:"70",align:"center"}),n(o,{prop:"action_rate",label:"整改进度",width:"70",align:"center"}),n(o,{label:"问题区域",width:"100",align:"center"},{default:c((t,v)=>[l("span",{class:"i1 cursor",onClick:g(P=>i($).onVisable(t.row),["stop"])},"查看问题分布",8,ce)]),_:1}),n(o,{label:"整改项目清单",width:"100",align:"center"},{default:c((t,v)=>[l("span",{class:"i1 cursor",onClick:g(P=>s.toPath("/schemePlansManagerCity",{id:t.row.id}),["stop"])},"查看项目清单",8,de)]),_:1})]),_:1},8,["data"])),[[E,i(a).loading,void 0,{fullscreen:!0,lock:!0}]])]),n(V,{state:i(a),ref_key:"problemRef",ref:$},null,8,["state"])])}}}),$e=K(me,[["__scopeId","data-v-05d26017"]]);export{$e as default};
