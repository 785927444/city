import{d as w,g as $,r as j,ce as J,b as O,o as B,c as E,f as d,t as I,u,e as T,a as m,k as f,v as y,a6 as D,a9 as M,aa as C}from"./index-Bd85TTIS.js";import{_ as F}from"./stepTitle.vue_vue_type_script_setup_true_lang-CSh_24gU.js";import L from"./step1-BCs_QQgb.js";import P from"./step2-ZLeIToWZ.js";import"./FileList.vue_vue_type_script_setup_true_lang-CKvp74Rm.js";import"./ViewFiles-DMp3eGxU.js";import"./UploadText-D3EldgGp.js";/* empty css                    *//* empty css                   */import"./index-DXutnob0.js";import"./index-DDNRsVXm.js";/* empty css                                                                   *//* empty css                    */import"./areaData-CfkeTXdx.js";import"./projects.vue_vue_type_script_setup_true_lang-ve3G8rtS.js";import"./el-loading-QtaFgzrj.js";import"./Pagination.vue_vue_type_style_index_0_lang-C7tlSLth.js";import"./el-pagination-BXrD03IN.js";/* empty css                        */import"./AaTitle.vue_vue_type_script_setup_true_lang-DNddMUg2.js";import"./index-CohXJBWb.js";import"./index-CLnax6KY.js";import"./v6-B4YtUg27.js";const R={class:"layout-col plr15"},V={class:"layout-col white-rgba50 rad8"},K={class:"ww100 flex-bc f20 p15 mb20 bob-cd-1"},Y={class:"fw"},z={class:"flex1 flex-ec"},G={class:"layout-col"},gt=w({__name:"index",setup(H){const _=D(),{proxy:l}=$(),s=l.publicStore();l.configStore();const a=j({...s.$state});J(async()=>{s.actIndex=1,s.form={}}),O(async()=>{v()});const v=async i=>{let e={};const r=_.query&&String(_.query.demo)==="1";if(r){const o="actionApply:reserveProject";let t={};try{const c=sessionStorage.getItem(o);c&&(t=JSON.parse(c))}catch{}const n=Date.now(),p=t.name||t.project_name||(_.query?.project_name?String(_.query.project_name):"龙城片区旧城改造项目");e={code:t.code||t.project_code||"TY-2026-0001",name:p,level:String(t.level||"1"),area:Array.isArray(t.area)?t.area:["140000","140100","140105"],parent_id:String(t.parent_id||"1"),parent_area:String(t.parent_area||"1"),construct_unit:t.construct_unit||"太原市城市更新中心",completion_status:String(t.completion_status||"1"),construct_main:t.construct_main||"太原市住建局",construct_price:t.construct_price||"12000",estimate_year:t.estimate_year||"2026",estimate_price:t.estimate_price||"2500",total_put_price:t.total_put_price||"5600",total_completion_price:t.total_completion_price||"3200",estimated_start_time:t.construct_datetime_start||t.estimated_start_time||"2025-12-12",estimated_end_time:t.construct_datetime_end||t.estimated_end_time||"2028-12-30",stage:String(t.stage||"1"),total_income_price:t.total_income_price||"8000",task_type:String(t.task_type||"1"),task_class:String(t.task_class||"1"),construct_content:String(t.construct_content||"1"),construct_note:t.construct_note||"以旧换新示范区改造",response_person:t.response_person||"王伟",contact_person:t.contact_person||"张敏",contact_phone:t.contact_phone||"13800001234",vast_scheme:t.vast_scheme||"新型城镇化",industrial_policy:t.industrial_policy||"城市更新行动",gc_investmentd_irection:t.gc_investmentd_irection||"民生改善",qu_stage_objective:t.qu_stage_objective||"2028年前完成片区更新",mapdata:t.mapdata||"龙城片区主干道及周边",plan_name:t.plan_name||"龙城片区更新实施方案",plan_unit:t.plan_unit||"太原市城市更新中心",approval_time:t.approval_time||"2026-01-15",plan_abstract:t.plan_abstract||"围绕旧城片区综合更新，完善道路与公共配套",condition:t.condition||"基础设施老旧，公共服务配套不足",fund_source:t.fund_source||{value1:"3000",value2:"1200",value3:"800",value4:"600",value5:"400",value6:"900",value7:"500",value8:"200",value9:"300",value10:"100"},orther_text:t.orther_text||{value1:"1",value2:"1",value3:"1",value4:"0",value5:"1",value6:"0",value7:"1",value8:"0",value9:"1",value10:"0",value11:"1",value12:"0",value13:"1",value14:"0",value15:"1"},attr:t.attr||{value1:{status:"success",type:"基础资料",time:n,name:"33fa95f0152e4543912b88c636b26f9f.pdf",data:"/static/uploads/33fa95f0152e4543912b88c636b26f9f.pdf"},value2:{status:"success",type:"区位图",time:n,name:"879d409c37f94ed8bf5ad09fcb0240b7.png",data:"/static/uploads/879d409c37f94ed8bf5ad09fcb0240b7.png"}},plan_attr:t.plan_attr||{value1:{status:"success",type:"实施方案正文",time:n,name:"4eaa30b8a7ab40a798cf5b98924fde30.pdf",data:"/static/uploads/4eaa30b8a7ab40a798cf5b98924fde30.pdf"},value2:{status:"success",type:"实施方案附件",time:n,name:"3fe8234a9a194f0c9da7f477accfe2ec.docx",data:"/static/uploads/3fe8234a9a194f0c9da7f477accfe2ec.docx"}}}}else if(_.query&&_.query.id){let o={model:"t_project_report",args:`id='${_.query.id}'`},t=await s.http({Api:o});e=l.isNull(t)?{}:{...t[0]},e.apply_status=="0"&&(s.title="apply"),e.apply_status=="1"&&e.reserve_status=="0"&&(s.title="reserve")}if(e.area){if(typeof e.area=="string")try{e.area=JSON.parse(e.area)}catch(o){console.error("解析失败:",o.message)}}else e.area=[];if(e.fund_source){if(typeof e.fund_source=="string")try{e.fund_source=JSON.parse(e.fund_source)}catch(o){console.error("解析失败:",o.message)}}else e.fund_source={value1:"",value2:"",value3:"",value4:"",value5:"",value6:"",value7:"",value8:"",value9:"",value10:""};if(e.orther_text){if(typeof e.orther_text=="string")try{e.orther_text=JSON.parse(e.orther_text)}catch(o){console.error("解析失败:",o.message)}}else e.orther_text={value1:"",value2:"",value3:"",value4:"",value5:"",value6:"",value7:"",value8:"",value9:"",value10:"",value11:"",value12:"",value13:"",value14:"",value15:""};if(e.attr){if(typeof e.attr=="string")try{e.attr=JSON.parse(e.attr)}catch(o){console.error("解析失败:",o.message)}}else e.attr={};if(e.plan_attr){if(typeof e.plan_attr=="string")try{e.plan_attr=JSON.parse(e.plan_attr)}catch(o){console.error("解析失败:",o.message)}}else e.plan_attr={};s.form={...e},s._public.form=JSON.parse(JSON.stringify(e)),g(),h(),b(),S(),r?((!a.contents1||a.contents1.length===0)&&(a.contents1=[{id:"demo-base-1",parent_id:"demo-base",name:"基础资料",type:"value1"},{id:"demo-base-2",parent_id:"demo-base",name:"区位图",type:"value2"}],s._public.contents1=a.contents1,a.active1={id:"demo-base",name:"基础资料"}),(!a.contents2||a.contents2.length===0)&&(a.contents2=[{id:"demo-plan-1",parent_id:"demo-plan",name:"实施方案正文",type:"value1"},{id:"demo-plan-2",parent_id:"demo-plan",name:"实施方案附件",type:"value2"}],s._public.contents2=a.contents2,a.active2={id:"demo-plan",name:"实施方案"})):A()},g=async()=>{let i={model:"t_scheme_plan",args:"release_status='1'",field:"id, name"};s.http({Api:i}).then(e=>{s._public.schemePlans=l.isNull(e)?[]:e})},h=async()=>{s._public.schemeAreas=[{id:"1",name:"龙城片区"}]},b=async()=>{let i={model:"t_task_type"},e={model:"t_task_content"};s.http({Api1:i,Api2:e}).then(r=>{l.isNull(r.Api1)||r.Api1;let o=l.isNull(r.Api2)?[]:r.Api2;const t=r.Api1.filter(c=>c.parent_id==="0").map(c=>c.id),n=r.Api1.filter(c=>t.includes(c.parent_id)),p=r.Api1.filter(c=>n.map(q=>q.id).includes(c.parent_id));s._public.task_types=n,s._public.task_classs=p,s._public.construct_contents=o})},S=async()=>{let i={model:"t_scheme_task",args:`scheme_id='${s.form.scheme_id}'`};s.http({Api:i}).then(e=>{let r=l.isNull(e)?[]:e;s.form.tasks=[...e],s._public.tasks=JSON.parse(JSON.stringify(r))})},A=async()=>{let i={model:"t_file_type"},e={model:"t_file_content"},r=await s.http({Api1:i,Api2:e}),o=l.isNull(r.Api1)?[]:r.Api1.sort((n,p)=>n.orderd-p.orderd),t=l.isNull(r.Api2)?[]:r.Api2.sort((n,p)=>n.orderd-p.orderd);N(o,t,"019c2c63-cf59-719f-b942-7c7bb535413d"),x(o,t,"019c2cc4-d276-7805-9685-7a5dde449721")},N=(i,e,r)=>{let o=i.find(t=>t.id==r);if(o){let t=[];a.plans=i.filter(n=>n.parent_id==r),a.plans.forEach(n=>{n.parent_type=`${o.type}/${n.type}`;let p=e.filter(c=>c.parent_id==n.id);l.isNull(p)||p.forEach(c=>{c.parent_type=`${n.parent_type}/${c.type}`,t.push(c)})}),a.contents1=t,s._public.contents1=t,a.active1=l.isNull(a.plans)?{}:{...a.plans[0]}}},x=(i,e,r)=>{let o=i.find(t=>t.id==r);if(o){let t=[];a.plans=i.filter(n=>n.parent_id==r),a.plans.forEach(n=>{n.parent_type=`${o.type}/${n.type}`;let p=e.filter(c=>c.parent_id==n.id);l.isNull(p)||p.forEach(c=>{c.parent_type=`${n.parent_type}/${c.type}`,t.push(c)})}),a.contents2=t,s._public.contents2=t,a.active2=l.isNull(a.plans)?{}:{...a.plans[0]}}},k=()=>{let i=s.form.id?"正在编辑中,是否确定退出?":"正在编辑中,信息未保存是否确定退出?";M.confirm(i,"温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{C.back()})};return(i,e)=>(B(),E("div",R,[d("div",V,[d("div",K,[d("div",Y,I(u(_).query&&u(_).query.id?"创建项目":"信息补充"),1),d("div",z,[d("div",{class:"plr14 ptb5 rad4 mr15 cursor c9 bg-white bo-c9-1",onClick:e[0]||(e[0]=T(r=>k(),["stop"]))},"返 回")])]),d("div",G,[m(u(F)),f(m(u(L),{state:u(a),contents:u(a).contents1,active:u(a).active1},null,8,["state","contents","active"]),[[y,u(s).actIndex==1]]),f(m(u(P),{state:u(a),contents:u(a).contents2,active:u(a).active2},null,8,["state","contents","active"]),[[y,u(s).actIndex==2]])])])]))}});export{gt as default};
