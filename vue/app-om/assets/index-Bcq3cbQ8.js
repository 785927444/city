import{d as D,g as P,a6 as L,r as K,b as G,o,c as m,a as r,w as _,f as l,a8 as H,u as a,m as J,F as v,p as h,z as C,q as Q,E as W,e as x,cV as O,t as p,h as T,y as q,k as X,v as Z,a0 as tt,a1 as B,a2 as et,a9 as st,a4 as F,l as lt}from"./index-CymMRwSV.js";import{_ as at}from"./Pagination.vue_vue_type_style_index_0_lang-CjUCoIAl.js";import{_ as it}from"./check-DGZEnJUC.js";import{_ as nt}from"./AaTitle.vue_vue_type_script_setup_true_lang-BA3Fb0N5.js";import{_ as ot}from"./filter-C7spfmFB.js";import"./el-pagination-Dn7oVmkx.js";const ct={class:"layout-col"},rt={class:"flex-sc mr30"},pt={class:"w50x4"},dt={class:"flex-sc mr30"},ut={class:"w50x3"},mt={class:"flex-sc mr30"},_t={class:"w50x3"},ft={class:"flex-sc mr15"},yt={class:"w50x3"},wt={class:"flex-sc mr15"},gt={class:"w50x3"},bt={class:"layout-col bg-white rad8 p8"},xt={class:"ww100 flex-sc p8"},kt={class:"flex-sc fw f16 tc"},vt=["onClick"],ht={key:0,class:"w20 h20 rad2 lh20 tc bgi13 i15 b20 l50 absolute"},$t={class:"mb5"},Ct={class:"flex-ec flex1"},Vt={class:"table flex-sc warp"},At={class:"ww100 bs bo-i16-1 relative rad8"},Nt={class:"ww100 flex-sc p12 bob-ce-1"},Et={class:"f15"},Ut={class:"flex1 flex-ec"},St=["onClick"],It={class:"ww100 flex-col p12 c6"},Ot={class:"ww100 flex-sc"},Tt={class:"ww100 flex-sc mt10"},qt={class:"ww100 flex-sc mt10"},Bt={class:"ww100 flex-sc mt10"},Ft={class:"ww100 flex-sc mt10"},Yt={class:"ww100 flex-sc mt10"},Rt={class:"ww100 flex-sc mt10"},jt={class:"flex-sc flex1"},Mt=["onClick"],zt={class:"dialog-footer"},Dt=D({__name:"index",setup(Pt){const{proxy:c}=P(),k=c.publicStore(),w=c.configStore(),Y=c.dictStore();L();const s=K({...k.$state,click:!1,clickArr:[],provinces:[],province:"",citys:[],city:"",types:[{type:"actionRelease",name:"已上报",path:"/actionRelease"},{type:"actionApply",name:"已申请",path:"/actionApply"},{type:"actionReturn",name:"已退回",path:"/actionReturn"}],type:"actionRelease",completion_status:"1",search:"",schemeAreas:[{value:"1",name:"龙城片区"}]});G(async()=>{await R(),V()});const R=async()=>{s.provinces=[{name:w.user.province_name,value:w.user.province}],s.province=s.provinces[0].value;let n=w.user.parent_id=="0"?{model:"t_station",args:`parent_id='${w.user.station_num}'`}:{model:"t_station",args:`id='${w.user.station_num}'`},t=await k.http({Api:n}),g=c.isNull(t)?[]:t.sort((i,b)=>i.order-b.order);s.citys=g.map(i=>({name:i.station_name,value:i.city})),!c.isNull(s.citys)&&w.user.parent_id!="0"&&(s.city=s.citys[0].value)},V=async n=>{let t="t_scheme_project p",g="p.*, sp.name as schemeName, sp.parent_area",i="t_scheme_plan sp ON p.scheme_id = sp.id",b="sp.release_status = '1' and p.apply_status = '0'",A="sp.release_status = '1' and p.apply_status = '1'",N="sp.release_status = '1' and p.apply_status = '3'",d={model:t,field:g,join:i,args:b},E={model:t,field:"COUNT(*)",join:i,args:A},U={model:t,field:"COUNT(*)",join:i,args:N};if(j(E),M(U),s.province){if(d.args+=` and sp.province='${s.province}'`,s.city&&(d.args+=` and sp.city='${s.city}'`),!c.isNull(s.construct_datetime)){const[y,z]=s.construct_datetime;d.args+=` and p.construct_datetime_start>='${y}' and p.construct_datetime_end<='${z}'`}s.completion_status&&(d.args+=` and p.completion_status='${s.completion_status}'`),s.search&&(d.args+=` and p.name LIKE '%${s.search}%'`)}let $={limit:s.limit,page:s.page},S={field:"COUNT(*)"},e={},u={};Object.assign(e,d,$),Object.assign(u,d,S);let f=await k.http({Api1:e,Api2:u});s.total=c.isNull(f.Api2)?0:f.Api2[0]["COUNT(*)"],s.empty=!!c.isNull(f.Api1),s.list=c.isNull(f.Api1)?[]:f.Api1,s.list.forEach(y=>{y.area=(y.province_name||"")+(y.city_name?`-${y.city_name}`:"")+(y.district_name?`-${y.district_name}`:"")})},j=n=>{k.http({Api:n}).then(t=>{s.types[1].total=c.isNull(t)?0:t[0]["COUNT(*)"]})},M=n=>{k.http({Api:n}).then(t=>{s.types[2].total=c.isNull(t)?0:t[0]["COUNT(*)"]})},I=(n,t)=>{n=="remind"&&st.confirm("是否确定提醒?","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{if(s.list.findIndex(i=>i.click)==-1)return F({title:"提示",message:"请选择至少一个",type:"error"});F({title:"提示",message:"提醒成功",type:"success"})}),n=="selectAll"&&(s.list.findIndex(i=>i.click)==-1?(s.click=!0,s.list.forEach(i=>{i.click=!0,s.clickArr.push(i)})):(s.click=!1,s.clickArr=[],s.list.forEach(i=>{delete i.click})))};return(n,t)=>{const g=H,i=Q,b=J,A=W,N=ot,d=nt,E=it,U=at,$=tt,S=et;return o(),m("div",ct,[r(d,{title:""},{"left-content":_(()=>[l("div",rt,[t[13]||(t[13]=l("span",{class:"mr10"},"项目周期",-1)),l("span",pt,[r(g,{style:{width:"100%"},modelValue:a(s).construct_datetime,"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).construct_datetime=e),"start-placeholder":"开始周期","end-placeholder":"结束周期",type:"yearrange","value-format":"YYYY",format:"YYYY"},null,8,["modelValue"])])]),l("div",dt,[t[14]||(t[14]=l("span",{class:"mr10"},"所属行政",-1)),l("span",ut,[r(b,{modelValue:a(s).province,"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).province=e),placeholder:"请选择",style:{width:"100%"},filterable:""},{default:_(()=>[(o(!0),m(v,null,h(a(s).provinces,(e,u)=>(o(),C(i,{key:e.value,value:String(e.value),label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),l("div",mt,[t[15]||(t[15]=l("span",{class:"mr10"},"所属地市",-1)),l("span",_t,[r(b,{modelValue:a(s).city,"onUpdate:modelValue":t[2]||(t[2]=e=>a(s).city=e),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:a(w).user.parent_id=="0"},{default:_(()=>[(o(!0),m(v,null,h(a(s).citys,(e,u)=>(o(),C(i,{key:e.value,value:String(e.value),label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","clearable"])])]),l("div",ft,[t[16]||(t[16]=l("span",{class:"mr10"},"实施状态",-1)),l("span",yt,[r(b,{modelValue:a(s).completion_status,"onUpdate:modelValue":t[3]||(t[3]=e=>a(s).completion_status=e),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:_(()=>[(o(!0),m(v,null,h(a(Y).project_completion_statuss,(e,u)=>(o(),C(i,{key:e.value,value:String(e.value),label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),l("div",wt,[t[17]||(t[17]=l("span",{class:"mr10"},"项目名称",-1)),l("span",gt,[r(A,{modelValue:a(s).search,"onUpdate:modelValue":t[4]||(t[4]=e=>a(s).search=e),style:{width:"100%"},placeholder:"请输入"},null,8,["modelValue"])])]),l("div",{class:"rad4 ptb6 plr12 flex-cc cursor bgi1 white",onClick:t[5]||(t[5]=x(e=>V(),["stop"]))},[r(N,{class:"f12 fw"}),t[18]||(t[18]=l("span",{class:"f14 ml5"},"搜索",-1))])]),"right-content":_(()=>[...t[19]||(t[19]=[])]),_:1}),l("div",bt,[l("div",xt,[l("div",kt,[(o(!0),m(v,null,h(a(s).types,(e,u)=>(o(),m("div",{class:"mr40 cursor flex-col-cc relative",key:u,onClick:x(f=>a(O)(e.path),["stop"])},[e.total?(o(),m("span",ht,p(e.total),1)):T("",!0),l("span",$t,p(e.name),1),l("span",{class:q(["ww100 h3 rad10",e.type==a(s).type?"bgi2":"black-rgba0"])},null,2)],8,vt))),128))]),l("div",Ct,[l("div",{class:"rad4 ptb5 plr12 flex-cc cursor bg-white c8 bo-cc-1 ml15",onClick:t[6]||(t[6]=x(e=>I("selectAll"),["stop"]))},"全选"),l("div",{class:"rad4 ptb5 plr12 flex-cc cursor bgi1 white bo-i1-1 ml15",onClick:t[7]||(t[7]=x(e=>I("remind"),["stop"]))},"提醒")])]),l("div",Vt,[(o(!0),m(v,null,h(a(s).list,(e,u)=>(o(),m("div",{class:"ww25 cursor p8",key:u},[l("div",At,[l("div",Nt,[l("span",Et,p(e.name),1),l("span",Ut,[l("span",{class:q(["w18 h18 tc lh18 rad3 ml10 white f12",e.click?"bgi1 bo-i1-1":"bo-cc-1"]),onClick:x(f=>e.click=!e.click,["stop"])},[e.click?(o(),C(E,{key:0})):T("",!0)],10,St)])]),l("div",It,[l("div",Ot,[t[20]||(t[20]=l("span",{class:"w110"},"所属地区",-1)),l("span",null,p(e.area?e.area:""),1)]),l("div",Tt,[t[21]||(t[21]=l("span",{class:"w110"},"所属片区",-1)),l("span",null,p(e.parent_area?n.find(a(s).schemeAreas,["value",e.parent_area],"name"):"-"),1)]),l("div",qt,[t[22]||(t[22]=l("span",{class:"w110"},"项目周期",-1)),l("span",null,p(e.construct_datetime_start&&e.construct_datetime_end?`${e.construct_datetime_start}-${e.construct_datetime_end}`:"-"),1)]),l("div",Bt,[t[23]||(t[23]=l("span",{class:"w110"},"项目规模",-1)),l("span",null,p(e.construct_scale?`${e.construct_scale}`:"-"),1)]),l("div",Ft,[t[24]||(t[24]=l("span",{class:"w110"},"预估投入",-1)),l("span",null,p(e.construct_price?`${e.construct_price} 万元`:"-"),1)]),l("div",Yt,[t[25]||(t[25]=l("span",{class:"w110"},"项目性质",-1)),l("span",null,p(e.construct_nature?n.decrypt(e.construct_nature):"-"),1)]),l("div",Rt,[l("div",jt,[t[26]||(t[26]=l("span",{class:"w110"},"更新进度时间",-1)),l("span",null,p(e.rate_time?n.parseTime(e.rate_time):"-"),1)]),l("div",{class:"rad5 ptb5 plr12 cursor bgi1 white",onClick:x(f=>{a(s).active={...e},a(s).isFalse=!a(s).isFalse},["stop"])},"申请储备",8,Mt)])])])]))),128))]),X(r(U,{class:"",style:{"padding-bottom":"0"},total:a(s).total,page:a(s).page,"onUpdate:page":t[8]||(t[8]=e=>a(s).page=e),pageModifiers:{sync:!0},limit:a(s).limit,"onUpdate:limit":t[9]||(t[9]=e=>a(s).limit=e),limitModifiers:{sync:!0},onPagination:V},null,8,["total","page","limit"]),[[Z,a(s).total>0]])]),r(S,{modelValue:a(s).isFalse,"onUpdate:modelValue":t[12]||(t[12]=e=>a(s).isFalse=e),title:"温馨提示",draggable:!0,width:"30%"},{footer:_(()=>[l("div",zt,[r($,{size:"large",class:"bgc white",onClick:t[10]||(t[10]=e=>a(s).isFalse=!a(s).isFalse)},{default:_(()=>[...t[27]||(t[27]=[B("取 消",-1)])]),_:1}),r($,{size:"large",class:"bgi1 white",onClick:t[11]||(t[11]=x(e=>a(O)("/actionApply",{id:a(s).active.id}),["stop"]))},{default:_(()=>[...t[28]||(t[28]=[B("确 定",-1)])]),_:1})])]),default:_(()=>[t[29]||(t[29]=l("div",{class:"ww100 flex-col-cc"},[l("div",{class:"f20 tc ptb30"},"是否将该项目申请纳入储备")],-1))]),_:1},8,["modelValue"])])}}}),Wt=lt(Dt,[["__scopeId","data-v-47760aae"]]);export{Wt as default};
