const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Export2Excel-Dh3VLVR1.js","assets/FileSaver.min-B3EeCmGQ.js","assets/index-BWjCSAnw.js","assets/index--rYzwK9V.css","assets/xlsx-CaORBL06.js"])))=>i.map(i=>d[i]);
import{d as W,g as X,r as Z,b as ee,j as Y,o as n,c as i,f as c,a as m,u as a,E as te,w as S,z as le,F as x,q as V,x as B,A as se,B as ae,C as H,D as oe,e as C,G as ne,H as ie,_ as re,t as f,h as P,k as q,v as L,p as I,m as j,i as E,I as de,n as z}from"./index-BWjCSAnw.js";import{_ as ue}from"./Add-C2Yn49FZ.js";import{_ as ce}from"./Pagination.vue_vue_type_style_index_0_lang-CMYQ1dta.js";import{E as pe}from"./el-image-viewer-HQ-b3oKZ.js";import{E as me}from"./el-switch-i6AGQHxo.js";import"./el-progress-DQWPeYlj.js";import"./Upload-D7KlxVMi.js";import"./el-message-CJx4xv24.js";import"./el-text-Ck7yMuci.js";import"./el-checkbox-DlSjzc6V.js";import"./el-pagination-20-n38jk.js";const ye={class:"layout-col"},fe={class:"h40 ww100 flex-sc relative mb10"},ke={class:"ww100 hh100 flex-sc absolute pl35"},_e={class:"flex-ec flex1"},we={class:"flex-ec cursor flex1"},he={class:"flex w50x2"},ge={class:"flex w50x8"},be={class:"f14 ml4"},ve={class:"row bgi22"},xe={class:"layout-col bss"},Ve={class:"table"},Ce=["onClick"],Ie=["onClick"],$e={key:1},Ee={key:2},Ae={key:4},De={key:5},Ne={key:6},Ue={key:7,class:"flex-sc warp"},Se={key:0,class:"flex-sc"},qe={key:1,class:"w50 h25 ca flex-sc"},Le={key:8},Me={key:9},Oe={key:0,class:"flex-cc ww100 tc ptb13 bgi18"},We=W({__name:"index",setup(Te){const{proxy:p}=X(),k=p.publicStore(),h=p.configStore();p.dictStore();let A=E(),F=E([{name:"失败",value:"0",color:"i8"},{name:"成功",value:"1",color:"i11"}]),M=E([{name:"常规",value:"1"},{name:"系统",value:"2"}]),D=E([{name:"注意",value:"info",color:"i15"},{name:"警告",value:"warning",color:"i6"},{name:"错误",value:"error",color:"i8"},{name:"致命",value:"fatal",color:"i9"}]);const e=Z({...k.$state,content:[{width:"w70",show:!0,align:"center",key:"*",name:"序号"},{width:"w50x2",show:!0,align:"left",key:"type",name:"类型",type:"select",list:M.value,value:"value",label:"name"},{width:"w50x2",show:!0,align:"left",key:"level",name:"等级",type:"select",list:D.value,value:"value",label:"name"},{width:"w50x2",show:!0,align:"left",key:"res",name:"结果",type:"select",list:F.value,value:"value",label:"name"},{width:"w50x3",show:!0,align:"left",key:"name",name:"名称"},{width:"w50x3",show:!0,align:"left",key:"user",name:"用户",type:"decrypt"},{width:"w50x3",show:!0,align:"left",key:"username",name:"账号",type:"decrypt"},{width:"w50x4",show:!0,align:"left",key:"time",name:"时间",type:"time"},{width:"w50x8",show:!0,align:"left",key:"msg",name:"内容"},{width:"flex1",show:!0,align:"right",key:k.auth,name:"操作"}],editFrom:[],addItem:{},username:"",type:"1",level:"",model:"t_log"});ee(async()=>{k.init({path:"/log"},e),h.distributId||(h.distributId="0"),g()}),Y(()=>h.distributId,async(o,s)=>{await z(),!p.isNull(o)&&g()},{immediate:!1,deep:!0}),Y(()=>k.isTrue,async o=>{await z(),console.log("更新---"),g(k.active.id)},{immediate:!1,deep:!0});const g=async()=>{e.query=!h.distributId||h.distributId=="0"?{model:e.model,order:"time desc"}:{model:e.model,args:`stationnum='${h.distributId}'`,order:"time desc"};let o="";if(e.username&&(o+=`user LIKE '%${p.encrypt(e.username)}%' and `),e.type&&(o+=`type='${e.type}' and `),e.level&&(o+=`level='${e.level}' and `),!p.isNull(e.datetime)){let N=Date.parse(e.datetime[0])+"",U=Date.parse(e.datetime[1])+"";o+=`time>='${N}' and time<='${U}' and `}let s={limit:e.limit,page:e.page},_={field:"COUNT(*)"},r={};Object.assign(r,e.query),o&&(r.args=o.slice(0,-4));let d={},b={};Object.assign(d,r,s),Object.assign(b,r,_),e.parmas={Api1:d,Api2:b};let u=await k.http(e.parmas);e.empty=!!p.isNull(u.Api1),e.list=p.isNull(u.Api1)?[]:u.Api1,e.total=p.isNull(u.Api2)?0:u.Api2[0]["COUNT(*)"]},$=(o,s)=>{(o=="add"||o=="upd")&&A.value.onVisable(s),o=="del"&&A.value.del(s)},R=async()=>{let o=Object.assign({},e.parmas.Api1);delete o.limit,delete o.page;let s=await k.http({Api:o});de(()=>import("./Export2Excel-Dh3VLVR1.js"),__vite__mapDeps([0,1,2,3,4])).then(async _=>{const r=[],d=[];e.content.forEach(u=>{u.show&&u.key!="-"&&u.key!="*"&&typeof u.key!="object"&&(r.push(u.name),d.push(u.key))});const b=G(d,s);_.export_json_to_excel({header:r,data:b,filename:p.parseTime(new Date)+"导出"})})},G=(o,s)=>(s||e.list).map(r=>o.map(d=>d=="time"?r[d]&&r[d]!="0"?p.parseTime(r[d]):"":d=="type"?p.find(M.value,["value",r[d]],"name"):d=="level"?p.find(D.value,["value",r[d]],"name"):r[d]));return(o,s)=>{const _=te,r=le,d=se,b=ae,u=ne,N=re,U=me,O=pe,J=ce,K=ue;return n(),i("div",ye,[c("div",fe,[c("div",ke,[s[13]||(s[13]=c("span",{class:"fw ptb5"},"操作日志",-1)),c("div",_e,[c("div",we,[s[10]||(s[10]=c("div",{class:"ml15 mr10"},"用户",-1)),m(_,{class:"w100x2",modelValue:a(e).username,"onUpdate:modelValue":s[0]||(s[0]=t=>a(e).username=t),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"]),s[11]||(s[11]=c("div",{class:"ml15 mr10"},"等级",-1)),c("div",he,[m(d,{modelValue:a(e).level,"onUpdate:modelValue":s[1]||(s[1]=t=>a(e).level=t),placeholder:"请选择",style:{width:"100%"},clearable:"",filterable:""},{default:S(()=>[m(r,{label:"全部",value:""}),(n(!0),i(x,null,V(a(D),(t,v)=>(n(),B(r,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s[12]||(s[12]=c("div",{class:"ml15 mr10"},"时间",-1)),c("div",ge,[m(b,{modelValue:a(e).datetime,"onUpdate:modelValue":s[2]||(s[2]=t=>a(e).datetime=t),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])]),m(u,{class:"rad4 ptb5 plr8 flex-cc cursor bgi22 i21 ml10 bo-i21-1 ml15",onClick:s[3]||(s[3]=C(t=>{a(e).page=1,g()},["stop"])),icon:a(oe)},{default:S(()=>[...s[8]||(s[8]=[H("搜索",-1)])]),_:1},8,["icon"]),m(u,{class:"rad4 ptb5 plr8 flex-cc cursor bgi22 i21 ml10 bo-i21-1",onClick:s[4]||(s[4]=C(t=>R(),["stop"])),icon:a(ie)},{default:S(()=>[...s[9]||(s[9]=[H("导出",-1)])]),_:1},8,["icon"])]),a(e).content.find(t=>typeof t.key=="object")&&a(e).content.find(t=>typeof t.key=="object").key.hasOwnProperty("add")?(n(),i("div",{key:0,class:"rad4 ptb5 plr8 flex-cc cursor bgi22 i21 ml10 bo-i21-1",onClick:s[5]||(s[5]=C(t=>$("add",a(e).addItem),["stop"]))},[m(N,{class:"f12 fw"}),c("span",be,f(a(e).content.find(t=>typeof t.key=="object").key.add),1)])):P("",!0)])])]),c("div",ve,[(n(!0),i(x,null,V(a(e).content,(t,v)=>q((n(),i("div",{style:j({textAlign:t.align}),key:v,class:I(typeof t.key=="object"?t.width+" mlr5":t.width)},f(t.name),7)),[[L,t.show]])),128))]),c("div",xe,[c("div",Ve,[(n(!0),i(x,null,V(a(e).list,(t,v)=>(n(),i("div",{class:I(["row cursor",a(k).active[a(e).key]==t[a(e).key]?"active":v%2==1?"bgi23":"bgi18"]),key:v,onClick:l=>$("active",t)},[(n(!0),i(x,null,V(a(e).content,(l,Q)=>q((n(),i("div",{class:I(l.width),style:j({textAlign:l.align}),key:Q},[typeof l.key=="object"?(n(!0),i(x,{key:0},V(l.key,(y,w,T)=>(n(),i("span",{class:I(["cursor mlr5",w=="add"||a(e).auth[w]==!1?"none":w=="del"?"i8":"i21"]),key:T,onClick:C(Ye=>$(w,t),["stop"])},f(y),11,Ie))),128)):l.key=="*"?(n(),i("span",$e,f((a(e).page-1)*a(e).limit+v+1),1)):l.type=="time"?(n(),i("span",Ee,f(t[l.key]==0?"/":o.parseTime(t[l.key])),1)):l.type=="select"?(n(),i("span",{key:3,class:I(o.find(l.list,[l.value,t[l.key]],"color")?o.find(l.list,[l.value,t[l.key]],"color"):"")},f(o.find(l.list,[l.value,t[l.key]],l.label)),3)):l.type=="switch"?(n(),i("span",Ae,[m(U,{modelValue:t[l.key],"onUpdate:modelValue":y=>t[l.key]=y,"active-text":l.value[1].name,"inactive-text":l.value[0].name,"active-value":l.value[1].value,"inactive-value":l.value[0].value,"inline-prompt":"",onChange:y=>$("switch",t)},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text","active-value","inactive-value","onChange"])])):l.type=="input"?(n(),i("span",De,[m(_,{modelValue:t[l.value],"onUpdate:modelValue":y=>t[l.value]=y,placeholder:"请输入",style:{width:"150px"},size:"small"},null,8,["modelValue","onUpdate:modelValue"])])):l.type=="preload"&&l.filed?(n(),i("span",Ne,f(t[l.key]?t[l.key][l.filed]:""),1)):l.type=="image"?(n(),i("span",Ue,[typeof t[l.key]=="string"?(n(),i("div",Se,[t[l.key].length!=0?(n(),B(O,{key:0,class:"w25 h25 m2 rad3 cursor",src:o.I(t[l.key]),"preview-src-list":a(e).srcList,onClick:C(y=>{a(e).srcList=[],a(e).srcList.push(o.I(t[l.key]))},["stop"])},null,8,["src","preview-src-list","onClick"])):(n(),i("span",qe,"暂无"))])):(n(!0),i(x,{key:1},V(t[l.key],(y,w)=>(n(),i("div",{class:"flex-sc",key:w},[m(O,{class:I([w==0?"":"ml5","w25 h25 rad3 cursor"]),src:o.I(y),"preview-src-list":a(e).srcList,onClick:C(T=>{a(e).srcList=[],a(e).srcList.push(o.I(y))},["stop"])},null,8,["class","src","preview-src-list","onClick"])]))),128))])):l.type=="decrypt"?(n(),i("span",Le,f(o.isNull(t[l.key])&&l.key!=""?"/":o.decrypt(t[l.key])),1)):(n(),i("span",Me,f(o.isNull(t[l.key])&&l.key!=""?"/":t[l.key]),1))],6)),[[L,l.show]])),128))],10,Ce))),128)),a(e).empty?(n(),i("div",Oe,"没有数据")):P("",!0)]),q(m(J,{class:"plr20",total:a(e).total,page:a(e).page,"onUpdate:page":s[6]||(s[6]=t=>a(e).page=t),pageModifiers:{sync:!0},limit:a(e).limit,"onUpdate:limit":s[7]||(s[7]=t=>a(e).limit=t),limitModifiers:{sync:!0},onPagination:g},null,8,["total","page","limit"]),[[L,a(e).total>0]])]),m(K,{onInit:g,state:a(e),ref_key:"addRef",ref:A},null,8,["state"])])}}});export{We as default};
