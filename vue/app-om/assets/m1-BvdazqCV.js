import{_ as P}from"./check-DrP440r6.js";import{_ as Y}from"./AaTitle.vue_vue_type_script_setup_true_lang-msvlqApB.js";import{_ as B}from"./filter-BWaskIWj.js";import{d as U,g as q,r as z,b as H,o as d,c as u,a as _,w as b,f as t,m as J,u as r,F as h,p as k,z as x,q as T,a8 as F,e as w,t as f,y as S,h as L,a9 as G,a4 as C,l as K}from"./index-BF5jje68.js";const Q={class:"layout-col"},R={class:"flex-sc mr30"},W={class:"w50x3"},X={class:"flex-sc mr30"},Z={class:"w50x3"},ee={class:"flex-sc mr30"},se={class:"w50x8"},te={class:"flex-sc mr15"},ae={class:"w50x3"},le={class:"layout-col bg-white rad8 p8"},ne={class:"ww100 flex-sc p8"},ie={class:"flex-sc fw f16 tc"},oe=["onClick"],re={class:"mb5"},ce={class:"flex-ec flex1"},de={class:"table flex-sc warp"},pe={class:"ww100 bs bo-i16-1 relative rad8"},me={class:"ww100 flex-sc p12 bob-ce-1"},ue={class:"f15"},_e={class:"flex1 flex-ec"},fe=["onClick"],ye=["onClick"],we={class:"ww100 flex-sc"},ge={class:"ww100 flex-sc mt10"},be={class:"flex1 line1"},he={class:"ww100 flex-sc mt10"},ke={class:"flex1 line1"},xe={class:"ww100 flex-sc mt10"},ve={class:"flex1 line1"},$e={class:"ww100 flex-sc mt10"},Ne={class:"flex1 line1"},Se=U({__name:"m1",setup(Ce){const{proxy:c}=q(),m=c.publicStore(),p=c.configStore();c.dictStore();const V=[{value:"0",name:"待审核"},{value:"1",name:"审核中"},{value:"2",name:"已通过"},{value:"3",name:"不通过"}],j=[{type:"special",name:"专项规划",path:"/schemePlansManagerCity"},{type:"region",name:"片区策划",path:"/schemeDesignsManagerCity"}],s=z({...m.$state,click:!1,clickArr:[],status:"1",tabtype:"region",provinces:[],province:"",citys:[],city:"",schemeAreas:[{value:"1",name:"龙城片区"}],type:"design"});H(async()=>{await A(),D(),v()});const D=async()=>{let o={model:"t_scheme_plan",args:`user_id='${p.user.id}' and type='plan'`,field:"id, name"};m.http({Api:o}).then(e=>{s.schemePlans=c.isNull(e)?[]:e})},A=async()=>{s.provinces=[{name:p.user.province_name,value:p.user.province}],s.province=s.provinces[0].value;let o=p.user.parent_id=="0"?{model:"t_station",args:`parent_id='${p.user.station_num}'`}:{model:"t_station",args:`id='${p.user.station_num}'`},e=await m.http({Api:o}),i=c.isNull(e)?[]:e.sort((a,n)=>a.order-n.order);s.citys=i.map(a=>({name:a.station_name,value:a.city})),!c.isNull(s.citys)&&p.user.parent_id!="0"&&(s.city=s.citys[0].value)},v=async o=>{let e={model:"t_scheme_design",args:`type='${s.type}'`};if(s.province){if(e.args+=`and province='${s.province}'`,s.city&&(e.args+=` and city='${s.city}'`),!c.isNull(s.datetime)){let n=Date.parse(s.datetime[0])+"",g=Date.parse(s.datetime[1])+"";e.args+=` and release_time>='${n}' and release_time<='${g}'`}s.examine_status&&(e.args+=` and examine_status='${s.examine_status}'`)}let i=await m.http({Api:e}),a=c.isNull(i)?[]:i;s.list=a.map(n=>{try{n.datetime?(n.datetime=JSON.parse(n.datetime),n.datetime=`${n.datetime[0]}-${n.datetime[1]}`):n.datetime="",n.attr=n.attr?JSON.parse(n.attr):{},n.project=n.project?JSON.parse(n.project):[]}catch(g){console.error("解析失败:",g.message)}return n}),E(),M()},E=()=>{const o=new Set,e=new Set;s.list.forEach(a=>{o.add(a.user_id),a.release_status=="1"&&e.add(a.user_id)});let i={sum:o.size,release:e.size};m._public.percent=i.sum?Math.floor(i.release/i.sum*100)/100:0,m._public.data1=i},M=async()=>{s.list.map(a=>`'${a.id}'`).join(", ");let o=[];const e=Object.fromEntries((c.isNull(o)?[]:o).map(a=>[a.parent_id,a.design_num])),i={};s.list.forEach(a=>{const n=a.user_id;i[n]||(i[n]={name:c.decrypt(a.user_name),area:0,impl:0,proj:0}),i[n].area+=Number(e[a.id]||0),i[n].impl+=Number(a.task_num||0),i[n].proj+=Number(a.project_num||0)}),m._public.responses=[{name:"片区数量",data:Object.values(i).map(a=>[a.name,String(a.area)])},{name:"实施中项目",data:Object.values(i).map(a=>[a.name,String(a.impl)])},{name:"项目数量",data:Object.values(i).map(a=>[a.name,String(a.proj)])}]},$=(o,e)=>{o=="remind"&&G.confirm("是否确定提醒?","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(()=>{if(s.list.findIndex(a=>a.click)==-1)return C({title:"提示",message:"请选择至少一个",type:"error"});C({title:"提示",message:"提醒成功",type:"success"})}),o=="selectAll"&&(s.list.findIndex(a=>a.click)==-1?(s.click=!0,s.list.forEach(a=>{a.click=!0,s.clickArr.push(a)})):(s.click=!1,s.clickArr=[],s.list.forEach(a=>{delete a.click})))};return(o,e)=>{const i=T,a=J,n=F,g=B,I=Y,O=P;return d(),u("div",Q,[_(I,{title:""},{"left-content":b(()=>[t("div",R,[e[7]||(e[7]=t("span",{class:"mr10"},"上报地区",-1)),t("span",W,[_(a,{modelValue:r(s).province,"onUpdate:modelValue":e[0]||(e[0]=l=>r(s).province=l),placeholder:"请选择",style:{width:"100%"},filterable:""},{default:b(()=>[(d(!0),u(h,null,k(r(s).provinces,(l,y)=>(d(),x(i,{key:l.value,value:String(l.value),label:l.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),t("div",X,[e[8]||(e[8]=t("span",{class:"mr10"},"编制单位",-1)),t("span",Z,[_(a,{modelValue:r(s).city,"onUpdate:modelValue":e[1]||(e[1]=l=>r(s).city=l),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:r(p).user.parent_id=="0"},{default:b(()=>[(d(!0),u(h,null,k(r(s).citys,(l,y)=>(d(),x(i,{key:l.value,value:String(l.value),label:l.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","clearable"])])]),t("div",ee,[e[9]||(e[9]=t("span",{class:"mr10"},"上报时间",-1)),t("span",se,[_(n,{style:{width:"100%"},modelValue:r(s).datetime,"onUpdate:modelValue":e[2]||(e[2]=l=>r(s).datetime=l),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:""},null,8,["modelValue"])])]),t("div",te,[e[10]||(e[10]=t("span",{class:"mr10"},"审核状态",-1)),t("span",ae,[_(a,{modelValue:r(s).examine_status,"onUpdate:modelValue":e[3]||(e[3]=l=>r(s).examine_status=l),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:b(()=>[(d(),u(h,null,k(V,(l,y)=>_(i,{key:l.value,value:String(l.value),label:l.name},null,8,["value","label"])),64))]),_:1},8,["modelValue"])])]),t("div",{class:"rad4 ptb6 plr12 flex-cc cursor bgi1 white",onClick:e[4]||(e[4]=w(l=>v(),["stop"]))},[_(g,{class:"f12 fw"}),e[11]||(e[11]=t("span",{class:"f14 ml5"},"搜索",-1))])]),"right-content":b(()=>[...e[12]||(e[12]=[])]),_:1}),t("div",le,[t("div",ne,[t("div",ie,[(d(),u(h,null,k(j,(l,y)=>t("div",{class:"mr20 cursor flex-col-cc",key:y,onClick:w(N=>o.toPath(l.path),["stop"])},[t("span",re,f(l.name),1),t("span",{class:S(["ww100 h3 rad10",l.type==r(s).tabtype?"bgi2":"black-rgba0"])},null,2)],8,oe)),64))]),t("div",ce,[t("div",{class:"rad4 ptb5 plr12 flex-cc cursor bg-white c8 bo-cc-1 ml15",onClick:e[5]||(e[5]=w(l=>$("selectAll"),["stop"]))},"全选"),t("div",{class:"rad4 ptb5 plr12 flex-cc cursor bgi1 white bo-i1-1 ml15",onClick:e[6]||(e[6]=w(l=>$("remind"),["stop"]))},"提醒")])]),t("div",de,[(d(!0),u(h,null,k(r(s).list,(l,y)=>(d(),u("div",{class:"ww25 cursor p8",key:y},[t("div",pe,[t("div",me,[t("span",ue,f(l.name),1),t("span",_e,[t("span",{class:S(["w18 h18 tc lh18 rad3 ml10 white f12",l.click?"bgi1 bo-i1-1":"bo-cc-1"]),onClick:w(N=>l.click=!l.click,["stop"])},[l.click?(d(),x(O,{key:0})):L("",!0)],10,fe)])]),t("div",{class:"ww100 flex-col p12 c6",onClick:w(N=>o.toPath("/schemeDesignView",{id:l.id}),["stop"])},[t("div",we,[e[13]||(e[13]=t("span",{class:"w110"},"上报时间",-1)),t("span",null,f(l.release_time?o.parseTime(l.release_time):"-"),1)]),t("div",ge,[e[14]||(e[14]=t("span",{class:"w110"},"包含项目数",-1)),t("span",be,f(l.project_num?l.project_num:"-"),1)]),t("div",he,[e[15]||(e[15]=t("span",{class:"w110"},"所属专项规划",-1)),t("span",ke,f(!o.isNull(r(s).schemePlans)&&l.parent_id?o.find(r(s).schemePlans,["id",l.parent_id],"name"):"-"),1)]),t("div",xe,[e[16]||(e[16]=t("span",{class:"w110"},"所属专项片区",-1)),t("span",ve,f(!o.isNull(r(s).schemeAreas)&&l.parent_area?o.find(r(s).schemeAreas,["value",l.parent_area],"name"):"-"),1)]),t("div",$e,[e[17]||(e[17]=t("span",{class:"w110"},"上报单位",-1)),t("span",Ne,f(l.user_name?o.decrypt(l.user_name):"-"),1)])],8,ye)])]))),128))])])])}}}),Ee=K(Se,[["__scopeId","data-v-2e7c99a0"]]);export{Ee as default};
