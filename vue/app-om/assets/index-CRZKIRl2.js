import{a5 as Z,o as n,c as a,f as s,d as ee,g as te,b as se,a3 as S,a as u,w,a0 as oe,F as _,p as h,u as l,b0 as ie,E as le,h as b,k as x,t as r,a2 as ne,r as ae,a1 as ce,e as g,z as A,y as q,v as de,_ as re,K as me,l as ue}from"./index-CymMRwSV.js";import{v as pe}from"./el-loading-Bz52rtYK.js";import{E as _e}from"./el-image-viewer-_li9ZGN2.js";import{_ as L}from"./arrow-right-B28xk3WW.js";import{E as he}from"./el-pagination-Dn7oVmkx.js";import{_ as ge}from"./search-3c1NVz-r.js";const ve={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function fe(T,C){return n(),a("svg",ve,[...C[0]||(C[0]=[s("path",{fill:"currentColor",d:"M831.9 340.9L512 652.7L192.1 340.9a30.6 30.6 0 0 0-42.7 0a29 29 0 0 0 0 41.6l340.3 331.7a32 32 0 0 0 44.6 0l340.3-331.7a29 29 0 0 0 0-41.7a30.6 30.6 0 0 0-42.7 0z"},null,-1)])])}const Ce=Z({name:"ep-arrow-down",render:fe}),ye={class:"layout-col"},we={class:"layout-row"},be={class:"kb-left bg-white rad8 p15"},xe={class:"flex-bc mb15"},ke={class:"flex-sc"},Ne={class:"table-col"},$e=["onClick"],Ve={class:"flex-sc"},Ie={class:"kb-children"},ze=["onClick"],Se={class:"f14 line1"},Ae=["onClick"],Me={class:"flex1 hh100 hidden ml15"},De={class:"layout-col"},Ee={key:0,class:"bg-white rad8 p15 mb15"},je={key:1,class:"layout-col hh100 hidden",style:{background:"transparent"}},Be={class:"flex-sc align-start hh100",style:{"align-items":"stretch"}},qe={class:"flex1 flex-col hh100 mr15 bg-white rad8 overflow-hidden"},Le={class:"flex1 overflow-hidden p20 pr0 flex-col"},Te={class:"flex1 overflow-y-auto pr10"},Ue=["onClick"],Fe={class:"date-box mr20 tc"},Ke={class:"f24 fw c-primary"},Pe={class:"c9 f12"},Re={class:"flex-col flex1 mr20"},Ye={class:"f16 fw mb10 line1"},Je={class:"c9 f12 flex-sc"},Oe={class:"mr10"},Ge={class:"w120 h80 rad4 overflow-hidden flex-shrink-0"},He=["src"],Qe={key:1,src:"https://picsum.photos/120/80?random=1",class:"ww100 hh100 object-cover"},We={key:0,class:"ww100 p15 i2"},Xe={class:"flex-ec mt10"},Ze={class:"w280 hh100 bg-white rad8 flex-col overflow-hidden p20"},et={class:"flex1 overflow-y-auto"},tt={class:"f14 fw line2 mb5"},st={class:"f12 c9 line3"},ot={key:2,class:"layout-col bg-white rad8 p15 hh100 hidden"},it={class:"fw f16 mb10"},lt={class:"flex1 overflow-y-auto"},nt={class:"grid-container"},at=["onClick"],ct={class:"cover-box relative",style:{"padding-top":"56.25%"}},dt=["src"],rt=["src"],mt={class:"p15"},ut=["title"],pt={class:"flex-bc c9 f12"},_t={key:0,class:"ww100 p15 i2"},ht={class:"flex-ec mt10"},gt={key:3,class:"layout-col bg-white rad8 p15 hh100 hidden"},vt={class:"fw f16 mb10"},ft={class:"table-col"},Ct={key:0,class:"ww100 p15 i2"},yt={key:1},wt=["onClick"],bt={class:"flex-bc ww100"},xt={class:"flex-sc flex1 hidden"},kt={class:"f14 line1"},Nt={class:"c9 f14"},$t={class:"flex-ec mt10"},Vt={class:"flex-sc"},It={class:"flex1"},zt={class:"flex-ec"},St=ee({__name:"index",setup(T){const{proxy:C}=te(),e=ae({q:"",columns:[],openMap:{},activeColumnCode:"",activeColumnName:"",activeCategoryId:"",items:[],total:0,page:1,limit:10,loading:!1,addVisible:!1,addColumnCode:"",addName:""}),U=me(()=>e.activeColumnCode==="expert"||e.activeColumnCode==="case"),F=[{title:"《关于全面开展城市体检工作的指导意见》",desc:"以习近平新时代中国特色社会主义思想为指引，坚持发展理念以及“人民城市”理念"},{title:"《城市体检评估机制建设指南》",desc:"规范城市体检评估工作，推动城市高质量发展"},{title:"《关于实施城市更新行动的指导意见》",desc:"全面推进城镇老旧小区改造，提升城市功能和品质"},{title:"《“十四五”新型城镇化实施方案》",desc:"深入推进以人为核心的新型城镇化战略"},{title:"《国家生态园林城市标准》",desc:"促进城市生态文明建设，改善城市人居环境"}],K=i=>{if(!i)return"01.01";const t=new Date(i);return isNaN(t.getTime())?"01.01":`${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getDate()).padStart(2,"0")}`},P=i=>{if(!i)return"2023";const t=new Date(i);return isNaN(t.getTime())?"2023":String(t.getFullYear())};se(async()=>{await D()});const M=i=>{let t=i?.image_urls;if(typeof t=="string")try{t=JSON.parse(t)}catch{t=[t]}return Array.isArray(t)?t.map(c=>String(c)).filter(c=>c.trim()):[]},v=i=>M(i)[0]||"",D=async()=>{e.loading=!0;try{const i=await S.kbColumnsApi({}),t=i?.data?.columns??i?.columns??[];if(e.columns=t.map(c=>({...c,children:c.children??[]})),e.openMap=e.columns.reduce((c,m)=>(c[m.code]=!0,c),{}),!e.activeColumnCode&&e.columns.length>0){e.activeColumnCode=e.columns[0].code,e.activeColumnName=e.columns[0].name;const c=e.columns[0].children?.[0];c&&(e.activeCategoryId=c.id)}await p(1)}catch{e.columns=[],e.items=[],e.total=0}finally{e.loading=!1}},E=()=>{p(1)},R=i=>{if(e.openMap[i]=!e.openMap[i],e.activeColumnCode!==i){const t=e.columns.find(c=>c.code===i);e.activeColumnCode=i,e.activeColumnName=t?.name??"",e.activeCategoryId="",p(1)}},Y=async(i,t)=>{if(e.activeColumnCode!==i){const c=e.columns.find(m=>m.code===i);e.activeColumnCode=i,e.activeColumnName=c?.name??""}e.activeCategoryId=t,await p(1)},k=i=>{C.toPath(`/knowledge/item/${i}`)},N=i=>{e.page=i,p(i)},$=i=>{e.limit=i,p(1)},p=async i=>{e.loading=!0,e.activeColumnCode==="case"||e.activeColumnCode==="expert"?e.limit=12:e.limit=10;try{const t={column_code:e.activeColumnCode,category_id:e.activeCategoryId||"",q:e.q,page:i,limit:e.limit},c=await S.kbItemsApi(t),m=c?.data??c;e.items=m?.items??[],e.total=Number(m?.total??0)||0,e.page=i}catch{e.items=[],e.total=0}finally{e.loading=!1}},J=i=>{const t=i?.category_names??i?.categories??null;if(Array.isArray(t)&&t.length)return t.map(f=>String(f)).filter(Boolean);const c=i?.category_name??i?.category??"",m=String(c).trim();return m?[m]:["-"]},O=i=>{e.addColumnCode=i,e.addName="",e.addVisible=!0},j=()=>{e.addVisible=!1,e.addName="",e.addColumnCode=""},G=async()=>{const i=String(e.addName??"").trim(),t=String(e.addColumnCode??"").trim();if(!(!i||!t))try{const c=await S.kbCategoryAddApi({column_code:t,name:i}),m=c?.data?.category??c?.category??null;if(await D(),m?.id!=null){e.activeColumnCode=t;const f=e.columns.find(V=>V.code===t);e.activeColumnName=f?.name??"",e.activeCategoryId=m.id,await p(1)}}finally{j()}};return(i,t)=>{const c=oe,m=Ce,f=L,V=re,H=ge,B=le,I=he,Q=L,W=_e,X=ne,z=pe;return n(),a("div",ye,[s("div",we,[s("div",be,[s("div",xe,[t[9]||(t[9]=s("div",{class:"fw f16"},"分类导航栏",-1)),s("div",ke,[u(c,{type:"primary",link:"",onClick:t[0]||(t[0]=o=>i.$router.push("/knowledge/manage"))},{default:w(()=>[...t[8]||(t[8]=[ce("管理后台",-1)])]),_:1})])]),s("div",Ne,[(n(!0),a(_,null,h(l(e).columns,o=>(n(),a("div",{key:o.code,class:"kb-group"},[s("div",{class:"kb-group-title flex-bc cursor",onClick:g(d=>R(o.code),["stop"])},[s("div",Ve,[l(e).openMap[o.code]?(n(),A(m,{key:0,class:"f14 mr8"})):(n(),A(f,{key:1,class:"f14 mr8"})),s("span",{class:q(["f14",o.code===l(e).activeColumnCode?"i1 fw":"c8"])},r(o.name),3)])],8,$e),x(s("div",Ie,[(n(!0),a(_,null,h(o.children,d=>(n(),a("div",{key:d.id,class:q(["kb-child cursor",d.id===l(e).activeCategoryId?"kb-child-active":"kb-child-normal"]),onClick:g(y=>Y(o.code,d.id),["stop"])},[s("span",Se,r(d.name),1)],10,ze))),128)),s("div",{class:"kb-add cursor",onClick:g(d=>O(o.code),["stop"])},[u(V,{class:"f14 mr5"}),t[10]||(t[10]=s("span",{class:"f14"},"新增",-1))],8,Ae)],512),[[de,l(e).openMap[o.code]]])]))),128))])]),s("div",Me,[s("div",De,[l(e).activeColumnCode!=="policy"?(n(),a("div",Ee,[u(B,{modelValue:l(e).q,"onUpdate:modelValue":t[2]||(t[2]=o=>l(e).q=o),placeholder:"请输入关键词",clearable:"",onKeyup:t[3]||(t[3]=ie(o=>E(),["enter"]))},{append:w(()=>[s("div",{class:"kb-search-btn flex-cc cursor bgi1 white",onClick:t[1]||(t[1]=g(o=>E(),["stop"]))},[u(H,{class:"f16"})])]),_:1},8,["modelValue"])])):b("",!0),l(e).activeColumnCode==="policy"?(n(),a("div",je,[s("div",Be,[s("div",qe,[t[12]||(t[12]=s("div",{class:"policy-banner flex-col-cc white relative overflow-hidden",style:{"border-radius":"8px 8px 0 0",height:"280px","min-height":"280px","max-height":"280px",flex:"0 0 280px"}},[s("div",{class:"f36 fw z10 text-shadow"},"政策法规"),s("div",{class:"absolute ww100 hh100",style:{background:"linear-gradient(135deg, #66b1ff 0%, #409eff 100%)",opacity:"0.9"}})],-1)),s("div",Le,[t[11]||(t[11]=s("div",{class:"flex-sc mb15"},[s("div",{class:"f18 fw"},"政策法规列表")],-1)),x((n(),a("div",Te,[(n(!0),a(_,null,h(l(e).items,(o,d)=>(n(),a("div",{key:d,class:"policy-item flex-sc p15 bb-e cursor hover-bg",onClick:y=>k(o.id)},[s("div",Fe,[s("div",Ke,r(K(o.publish_time)),1),s("div",Pe,r(P(o.publish_time)),1)]),s("div",Re,[s("div",Ye,r(o.title),1),s("div",Je,[s("span",Oe,r(o.publish_org||"发布单位未知"),1),s("span",null,r(o.doc_no||""),1)])]),s("div",Ge,[v(o)?(n(),a("img",{key:0,src:v(o),class:"ww100 hh100 object-cover"},null,8,He)):(n(),a("img",Qe))])],8,Ue))),128)),l(e).items.length===0?(n(),a("div",We,"暂无数据")):b("",!0)])),[[z,l(e).loading]]),s("div",Xe,[u(I,{background:"",layout:"prev, pager, next, sizes, jumper",total:l(e).total,"page-size":l(e).limit,"current-page":l(e).page,onSizeChange:$,onCurrentChange:N},null,8,["total","page-size","current-page"])])])]),s("div",Ze,[t[13]||(t[13]=s("div",{class:"f16 fw mb15 pl10 bl-primary"},"热门知识",-1)),s("div",et,[(n(),a(_,null,h(F,(o,d)=>s("div",{key:d,class:"mb20 cursor hover-text-primary"},[s("div",tt,r(o.title),1),s("div",st,r(o.desc),1)])),64))])])])])):l(e).activeColumnCode==="case"||l(e).activeColumnCode==="expert"?(n(),a("div",ot,[s("div",it,r(l(e).activeColumnName),1),x((n(),a("div",lt,[s("div",nt,[(n(!0),a(_,null,h(l(e).items,(o,d)=>(n(),a("div",{key:d,class:"grid-card rad8 overflow-hidden bo-e cursor hover-shadow transition-all bg-white",onClick:y=>k(o.id)},[s("div",ct,[v(o)?(n(),a("img",{key:0,src:v(o),class:"absolute top0 left0 ww100 hh100 object-cover"},null,8,dt)):(n(),a("img",{key:1,src:`https://picsum.photos/400/225?random=${d}`,class:"absolute top0 left0 ww100 hh100 object-cover"},null,8,rt))]),s("div",mt,[s("div",{class:"f16 fw line1 mb10",title:o.title,style:{color:"#333"}},r(o.title),9,ut),s("div",pt,[s("span",null,r(o.publish_time||"2023-01-01"),1),u(Q,{class:"f14"})])])],8,at))),128))]),l(e).items.length===0?(n(),a("div",_t,"暂无数据")):b("",!0)])),[[z,l(e).loading]]),s("div",ht,[u(I,{background:"",layout:"prev, pager, next, sizes, jumper",total:l(e).total,"page-size":l(e).limit,"current-page":l(e).page,onSizeChange:$,onCurrentChange:N},null,8,["total","page-size","current-page"])])])):(n(),a("div",gt,[s("div",vt,r(l(e).activeColumnName||"文章列表"),1),x((n(),a("div",ft,[l(e).items.length===0?(n(),a("div",Ct,"暂无数据")):(n(),a("div",yt,[(n(!0),a(_,null,h(l(e).items,o=>(n(),a("div",{key:o.id,class:"kb-row cursor",onClick:g(d=>k(o.id),["stop"])},[s("div",bt,[s("div",xt,[l(U)&&v(o)?(n(),A(W,{key:0,src:v(o),"preview-src-list":M(o),"initial-index":0,fit:"cover",style:{width:"72px",height:"48px","border-radius":"4px","margin-right":"12px"}},null,8,["src","preview-src-list"])):b("",!0),(n(!0),a(_,null,h(J(o),(d,y)=>(n(),a("span",{key:`${o.id}-${y}`,class:"kb-tag mr15"},r(d),1))),128)),s("span",kt,r(o.title),1)]),s("span",Nt,r(o.publish_time||"-"),1)])],8,wt))),128))]))])),[[z,l(e).loading]]),s("div",$t,[u(I,{background:"",layout:"prev, pager, next, sizes, jumper",total:l(e).total,"page-size":l(e).limit,"current-page":l(e).page,onSizeChange:$,onCurrentChange:N},null,8,["total","page-size","current-page"])])]))])])]),u(X,{modelValue:l(e).addVisible,"onUpdate:modelValue":t[7]||(t[7]=o=>l(e).addVisible=o),title:"新增二级分类",width:"420px"},{footer:w(()=>[s("div",zt,[s("div",{class:"rad4 ptb5 plr12 flex-cc cursor bg-white c8 bo-cc-1",onClick:t[5]||(t[5]=g(o=>j(),["stop"]))},"取消"),s("div",{class:"rad4 ptb5 plr12 flex-cc cursor bgi1 white bo-i1-1 ml15",onClick:t[6]||(t[6]=g(o=>G(),["stop"]))},"确定")])]),default:w(()=>[s("div",Vt,[t[14]||(t[14]=s("span",{class:"mr10"},"分类名称",-1)),s("div",It,[u(B,{modelValue:l(e).addName,"onUpdate:modelValue":t[4]||(t[4]=o=>l(e).addName=o),placeholder:"请输入",maxlength:"30","show-word-limit":""},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}}),qt=ue(St,[["__scopeId","data-v-299c5fc4"]]);export{qt as default};
