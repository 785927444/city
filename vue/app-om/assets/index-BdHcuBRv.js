const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Export2Excel-C6KkisUZ.js","assets/FileSaver.min-B_3XffIe.js","assets/index-C0LFq0t5.js","assets/index-CTmTGC3D.css","assets/xlsx-CaORBL06.js"])))=>i.map(i=>d[i]);
import{d as W,g as X,r as Z,b as ee,j as Y,o as i,c as n,f as u,a as m,u as a,E as te,w as S,q as le,F as x,p as V,z as P,m as se,a8 as ae,a1 as B,c0 as oe,e as C,a0 as ie,c1 as ne,_ as re,t as f,h as H,k as q,v as L,y as I,x as j,i as E,c2 as de,n as z}from"./index-C0LFq0t5.js";import{_ as ce}from"./Add-Dm5MhgCZ.js";import{_ as ue}from"./Pagination.vue_vue_type_style_index_0_lang-BA7bW-pp.js";import{E as pe}from"./el-image-viewer-BQKeldKi.js";import{E as me}from"./el-switch-BOTkYaDy.js";/* empty css                    */import"./index-C9K-_7OE.js";import"./Upload-D980yyfb.js";/* empty css                   */import"./index-DCe-bV3q.js";import"./el-text-CzfEDlFN.js";import"./index-DefrYvvh.js";/* empty css                    */import"./el-pagination-BB8JCOIr.js";const ye={class:"layout-col"},fe={class:"h40 ww100 flex-sc relative mb10"},ke={class:"ww100 hh100 flex-sc absolute pl35"},_e={class:"flex-ec flex1"},we={class:"flex-ec cursor flex1"},he={class:"flex w50x2"},ge={class:"flex w50x8"},be={class:"f14 ml4"},ve={class:"row bgi22"},xe={class:"layout-col bss"},Ve={class:"table"},Ce=["onClick"],Ie=["onClick"],$e={key:1},Ee={key:2},Ae={key:4},Ne={key:5},De={key:6},Ue={key:7,class:"flex-sc warp"},Se={key:0,class:"flex-sc"},qe={key:1,class:"w50 h25 ca flex-sc"},Le={key:8},Me={key:9},Oe={key:0,class:"flex-cc ww100 tc ptb13 bgi18"},et=W({__name:"index",setup(Te){const{proxy:p}=X(),k=p.publicStore(),h=p.configStore();p.dictStore();let A=E(),F=E([{name:"失败",value:"0",color:"i8"},{name:"成功",value:"1",color:"i11"}]),M=E([{name:"常规",value:"1"},{name:"系统",value:"2"}]),N=E([{name:"注意",value:"info",color:"i15"},{name:"警告",value:"warning",color:"i6"},{name:"错误",value:"error",color:"i8"},{name:"致命",value:"fatal",color:"i9"}]);const e=Z({...k.$state,content:[{width:"w70",show:!0,align:"center",key:"*",name:"序号"},{width:"w50x2",show:!0,align:"left",key:"type",name:"类型",type:"select",list:M.value,value:"value",label:"name"},{width:"w50x2",show:!0,align:"left",key:"level",name:"等级",type:"select",list:N.value,value:"value",label:"name"},{width:"w50x2",show:!0,align:"left",key:"res",name:"结果",type:"select",list:F.value,value:"value",label:"name"},{width:"w50x3",show:!0,align:"left",key:"name",name:"名称"},{width:"w50x3",show:!0,align:"left",key:"user",name:"用户",type:"decrypt"},{width:"w50x3",show:!0,align:"left",key:"username",name:"账号",type:"decrypt"},{width:"w50x4",show:!0,align:"left",key:"time",name:"时间",type:"time"},{width:"w50x8",show:!0,align:"left",key:"msg",name:"内容"},{width:"flex1",show:!0,align:"right",key:k.auth,name:"操作"}],editFrom:[],addItem:{},username:"",type:"1",level:"",model:"t_log"});ee(async()=>{k.init({path:"/log"},e),h.distributId||(h.distributId="0"),g()}),Y(()=>h.distributId,async(o,s)=>{await z(),!p.isNull(o)&&g()},{immediate:!1,deep:!0}),Y(()=>k.isTrue,async o=>{await z(),console.log("更新---"),g(k.active.id)},{immediate:!1,deep:!0});const g=async()=>{e.query=!h.distributId||h.distributId=="0"?{model:e.model,order:"time desc"}:{model:e.model,args:`stationnum='${h.distributId}'`,order:"time desc"};let o="";if(e.username&&(o+=`user LIKE '%${p.encrypt(e.username)}%' and `),e.type&&(o+=`type='${e.type}' and `),e.level&&(o+=`level='${e.level}' and `),!p.isNull(e.datetime)){let D=Date.parse(e.datetime[0])+"",U=Date.parse(e.datetime[1])+"";o+=`time>='${D}' and time<='${U}' and `}let s={limit:e.limit,page:e.page},_={field:"COUNT(*)"},r={};Object.assign(r,e.query),o&&(r.args=o.slice(0,-4));let d={},b={};Object.assign(d,r,s),Object.assign(b,r,_),e.parmas={Api1:d,Api2:b};let c=await k.http(e.parmas);e.empty=!!p.isNull(c.Api1),e.list=p.isNull(c.Api1)?[]:c.Api1,e.total=p.isNull(c.Api2)?0:c.Api2[0]["COUNT(*)"]},$=(o,s)=>{(o=="add"||o=="upd")&&A.value.onVisable(s),o=="del"&&A.value.del(s)},R=async()=>{let o=Object.assign({},e.parmas.Api1);delete o.limit,delete o.page;let s=await k.http({Api:o});de(()=>import("./Export2Excel-C6KkisUZ.js"),__vite__mapDeps([0,1,2,3,4])).then(async _=>{const r=[],d=[];e.content.forEach(c=>{c.show&&c.key!="-"&&c.key!="*"&&typeof c.key!="object"&&(r.push(c.name),d.push(c.key))});const b=J(d,s);_.export_json_to_excel({header:r,data:b,filename:p.parseTime(new Date)+"导出"})})},J=(o,s)=>(s||e.list).map(r=>o.map(d=>d=="time"?r[d]&&r[d]!="0"?p.parseTime(r[d]):"":d=="type"?p.find(M.value,["value",r[d]],"name"):d=="level"?p.find(N.value,["value",r[d]],"name"):r[d]));return(o,s)=>{const _=te,r=le,d=se,b=ae,c=ie,D=re,U=me,O=pe,K=ue,G=ce;return i(),n("div",ye,[u("div",fe,[u("div",ke,[s[13]||(s[13]=u("span",{class:"fw ptb5"},"操作日志",-1)),u("div",_e,[u("div",we,[s[10]||(s[10]=u("div",{class:"ml15 mr10"},"用户",-1)),m(_,{class:"w100x2",modelValue:a(e).username,"onUpdate:modelValue":s[0]||(s[0]=t=>a(e).username=t),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"]),s[11]||(s[11]=u("div",{class:"ml15 mr10"},"等级",-1)),u("div",he,[m(d,{modelValue:a(e).level,"onUpdate:modelValue":s[1]||(s[1]=t=>a(e).level=t),placeholder:"请选择",style:{width:"100%"},clearable:"",filterable:""},{default:S(()=>[m(r,{label:"全部",value:""}),(i(!0),n(x,null,V(a(N),(t,v)=>(i(),P(r,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s[12]||(s[12]=u("div",{class:"ml15 mr10"},"时间",-1)),u("div",ge,[m(b,{modelValue:a(e).datetime,"onUpdate:modelValue":s[2]||(s[2]=t=>a(e).datetime=t),format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])]),m(c,{class:"rad4 ptb5 plr8 flex-cc cursor bgi22 i21 ml10 bo-i21-1 ml15",onClick:s[3]||(s[3]=C(t=>{a(e).page=1,g()},["stop"])),icon:a(oe)},{default:S(()=>[...s[8]||(s[8]=[B("搜索",-1)])]),_:1},8,["icon"]),m(c,{class:"rad4 ptb5 plr8 flex-cc cursor bgi22 i21 ml10 bo-i21-1",onClick:s[4]||(s[4]=C(t=>R(),["stop"])),icon:a(ne)},{default:S(()=>[...s[9]||(s[9]=[B("导出",-1)])]),_:1},8,["icon"])]),a(e).content.find(t=>typeof t.key=="object")&&a(e).content.find(t=>typeof t.key=="object").key.hasOwnProperty("add")?(i(),n("div",{key:0,class:"rad4 ptb5 plr8 flex-cc cursor bgi22 i21 ml10 bo-i21-1",onClick:s[5]||(s[5]=C(t=>$("add",a(e).addItem),["stop"]))},[m(D,{class:"f12 fw"}),u("span",be,f(a(e).content.find(t=>typeof t.key=="object").key.add),1)])):H("",!0)])])]),u("div",ve,[(i(!0),n(x,null,V(a(e).content,(t,v)=>q((i(),n("div",{style:j({textAlign:t.align}),key:v,class:I(typeof t.key=="object"?t.width+" mlr5":t.width)},f(t.name),7)),[[L,t.show]])),128))]),u("div",xe,[u("div",Ve,[(i(!0),n(x,null,V(a(e).list,(t,v)=>(i(),n("div",{class:I(["row cursor",a(k).active[a(e).key]==t[a(e).key]?"active":v%2==1?"bgi23":"bgi18"]),key:v,onClick:l=>$("active",t)},[(i(!0),n(x,null,V(a(e).content,(l,Q)=>q((i(),n("div",{class:I(l.width),style:j({textAlign:l.align}),key:Q},[typeof l.key=="object"?(i(!0),n(x,{key:0},V(l.key,(y,w,T)=>(i(),n("span",{class:I(["cursor mlr5",w=="add"||a(e).auth[w]==!1?"none":w=="del"?"i8":"i21"]),key:T,onClick:C(Ye=>$(w,t),["stop"])},f(y),11,Ie))),128)):l.key=="*"?(i(),n("span",$e,f((a(e).page-1)*a(e).limit+v+1),1)):l.type=="time"?(i(),n("span",Ee,f(t[l.key]==0?"/":o.parseTime(t[l.key])),1)):l.type=="select"?(i(),n("span",{key:3,class:I(o.find(l.list,[l.value,t[l.key]],"color")?o.find(l.list,[l.value,t[l.key]],"color"):"")},f(o.find(l.list,[l.value,t[l.key]],l.label)),3)):l.type=="switch"?(i(),n("span",Ae,[m(U,{modelValue:t[l.key],"onUpdate:modelValue":y=>t[l.key]=y,"active-text":l.value[1].name,"inactive-text":l.value[0].name,"active-value":l.value[1].value,"inactive-value":l.value[0].value,"inline-prompt":"",onChange:y=>$("switch",t)},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text","active-value","inactive-value","onChange"])])):l.type=="input"?(i(),n("span",Ne,[m(_,{modelValue:t[l.value],"onUpdate:modelValue":y=>t[l.value]=y,placeholder:"请输入",style:{width:"150px"},size:"small"},null,8,["modelValue","onUpdate:modelValue"])])):l.type=="preload"&&l.filed?(i(),n("span",De,f(t[l.key]?t[l.key][l.filed]:""),1)):l.type=="image"?(i(),n("span",Ue,[typeof t[l.key]=="string"?(i(),n("div",Se,[t[l.key].length!=0?(i(),P(O,{key:0,class:"w25 h25 m2 rad3 cursor",src:o.I(t[l.key]),"preview-src-list":a(e).srcList,onClick:C(y=>{a(e).srcList=[],a(e).srcList.push(o.I(t[l.key]))},["stop"])},null,8,["src","preview-src-list","onClick"])):(i(),n("span",qe,"暂无"))])):(i(!0),n(x,{key:1},V(t[l.key],(y,w)=>(i(),n("div",{class:"flex-sc",key:w},[m(O,{class:I([w==0?"":"ml5","w25 h25 rad3 cursor"]),src:o.I(y),"preview-src-list":a(e).srcList,onClick:C(T=>{a(e).srcList=[],a(e).srcList.push(o.I(y))},["stop"])},null,8,["class","src","preview-src-list","onClick"])]))),128))])):l.type=="decrypt"?(i(),n("span",Le,f(o.isNull(t[l.key])&&l.key!=""?"/":o.decrypt(t[l.key])),1)):(i(),n("span",Me,f(o.isNull(t[l.key])&&l.key!=""?"/":t[l.key]),1))],6)),[[L,l.show]])),128))],10,Ce))),128)),a(e).empty?(i(),n("div",Oe,"没有数据")):H("",!0)]),q(m(K,{class:"plr20",total:a(e).total,page:a(e).page,"onUpdate:page":s[6]||(s[6]=t=>a(e).page=t),pageModifiers:{sync:!0},limit:a(e).limit,"onUpdate:limit":s[7]||(s[7]=t=>a(e).limit=t),limitModifiers:{sync:!0},onPagination:g},null,8,["total","page","limit"]),[[L,a(e).total>0]])]),m(G,{onInit:g,state:a(e),ref_key:"addRef",ref:A},null,8,["state"])])}}});export{et as default};
