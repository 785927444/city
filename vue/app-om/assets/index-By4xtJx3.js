import{a5 as B,o as l,c as d,f as s,d as O,g as Q,b as W,a3 as w,a as p,w as C,a0 as X,F as f,p as h,u as i,aP as Y,E as Z,t as g,k as E,a2 as ee,r as te,a1 as oe,e as _,z as b,y as z,v as se,_ as ne,h as ae,K as ie,l as le}from"./index-Bd85TTIS.js";import{v as ce}from"./el-loading-QtaFgzrj.js";import{E as de}from"./el-pagination-BXrD03IN.js";import{E as re}from"./el-image-viewer-M0JIGJ1W.js";import{_ as me}from"./search-BaE4f9So.js";const ue={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function pe(k,m){return l(),d("svg",ue,[...m[0]||(m[0]=[s("path",{fill:"currentColor",d:"M340.9 149.3a30.6 30.6 0 0 0 0 42.8L652.7 512L341 831.9a30.6 30.6 0 0 0 0 42.7a29 29 0 0 0 41.7 0l331.6-340.3a32 32 0 0 0 0-44.6L382.6 149.4a29 29 0 0 0-41.7 0z"},null,-1)])])}const _e=B({name:"ep-arrow-right",render:pe}),ge={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function ve(k,m){return l(),d("svg",ge,[...m[0]||(m[0]=[s("path",{fill:"currentColor",d:"M831.9 340.9L512 652.7L192.1 340.9a30.6 30.6 0 0 0-42.7 0a29 29 0 0 0 0 41.6l340.3 331.7a32 32 0 0 0 44.6 0l340.3-331.7a29 29 0 0 0 0-41.7a30.6 30.6 0 0 0-42.7 0z"},null,-1)])])}const Ce=B({name:"ep-arrow-down",render:ve}),fe={class:"layout-col"},he={class:"layout-row"},ye={class:"kb-left bg-white rad8 p15"},we={class:"flex-bc mb15"},be={class:"flex-sc"},ke={class:"table-col"},xe=["onClick"],Ve={class:"flex-sc"},Ie={class:"kb-children"},Ne=["onClick"],$e={class:"f14 line1"},Ae=["onClick"],Me={class:"flex1 hh100 hidden ml15"},Ee={class:"layout-col"},ze={class:"bg-white rad8 p15 mb15"},Be={class:"layout-col bg-white rad8 p15 hh100 hidden"},Se={class:"fw f16 mb10"},Le={class:"table-col"},De={key:0,class:"ww100 p15 i2"},qe={key:1},Pe=["onClick"],Ue={class:"flex-bc ww100"},Ke={class:"flex-sc flex1 hidden"},Re={class:"f14 line1"},Fe={class:"c9 f14"},Te={class:"flex-ec mt10"},je={class:"flex-sc"},Ge={class:"flex1"},He={class:"flex-ec"},Je=O({__name:"index",setup(k){const{proxy:m}=Q(),e=te({q:"",columns:[],openMap:{},activeColumnCode:"",activeColumnName:"",activeCategoryId:"",items:[],total:0,page:1,limit:10,loading:!1,addVisible:!1,addColumnCode:"",addName:""}),S=ie(()=>e.activeColumnCode==="expert"||e.activeColumnCode==="case");W(async()=>{await I()});const x=o=>{const t=o?.image_urls;return Array.isArray(t)?t.map(a=>String(a)).filter(a=>a.trim()):[]},V=o=>x(o)[0]||"",I=async()=>{e.loading=!0;try{const o=await w.kbColumnsApi({}),t=o?.data?.columns??o?.columns??[];if(e.columns=t.map(a=>({...a,children:a.children??[]})),e.openMap=e.columns.reduce((a,c)=>(a[c.code]=!0,a),{}),!e.activeColumnCode&&e.columns.length>0){e.activeColumnCode=e.columns[0].code,e.activeColumnName=e.columns[0].name;const a=e.columns[0].children?.[0];a&&(e.activeCategoryId=a.id)}await u(1)}catch{e.columns=[],e.items=[],e.total=0}finally{e.loading=!1}},N=()=>{u(1)},L=o=>{if(e.openMap[o]=!e.openMap[o],e.activeColumnCode!==o){const t=e.columns.find(a=>a.code===o);e.activeColumnCode=o,e.activeColumnName=t?.name??"",e.activeCategoryId="",u(1)}},D=async(o,t)=>{if(e.activeColumnCode!==o){const a=e.columns.find(c=>c.code===o);e.activeColumnCode=o,e.activeColumnName=a?.name??""}e.activeCategoryId=t,await u(1)},q=o=>{m.toPath(`/knowledge/item/${o}`)},P=o=>{e.page=o,u(o)},U=o=>{e.limit=o,u(1)},u=async o=>{e.loading=!0;try{const t={column_code:e.activeColumnCode,category_id:e.activeCategoryId||"",q:e.q,page:o,limit:e.limit},a=await w.kbItemsApi(t),c=a?.data??a;e.items=c?.items??[],e.total=Number(c?.total??0)||0,e.page=o}catch{e.items=[],e.total=0}finally{e.loading=!1}},K=o=>{const t=o?.category_names??o?.categories??null;if(Array.isArray(t)&&t.length)return t.map(v=>String(v)).filter(Boolean);const a=o?.category_name??o?.category??"",c=String(a).trim();return c?[c]:["-"]},R=o=>{e.addColumnCode=o,e.addName="",e.addVisible=!0},$=()=>{e.addVisible=!1,e.addName="",e.addColumnCode=""},F=async()=>{const o=String(e.addName??"").trim(),t=String(e.addColumnCode??"").trim();if(!(!o||!t))try{const a=await w.kbCategoryAddApi({column_code:t,name:o}),c=a?.data?.category??a?.category??null;if(await I(),c?.id!=null){e.activeColumnCode=t;const v=e.columns.find(y=>y.code===t);e.activeColumnName=v?.name??"",e.activeCategoryId=c.id,await u(1)}}finally{$()}};return(o,t)=>{const a=X,c=Ce,v=_e,y=ne,T=me,A=Z,j=re,G=de,H=ee,J=ce;return l(),d("div",fe,[s("div",he,[s("div",ye,[s("div",we,[t[9]||(t[9]=s("div",{class:"fw f16"},"分类导航栏",-1)),s("div",be,[p(a,{type:"primary",link:"",onClick:t[0]||(t[0]=n=>o.$router.push("/knowledge/manage"))},{default:C(()=>[...t[8]||(t[8]=[oe("管理后台",-1)])]),_:1})])]),s("div",ke,[(l(!0),d(f,null,h(i(e).columns,n=>(l(),d("div",{key:n.code,class:"kb-group"},[s("div",{class:"kb-group-title flex-bc cursor",onClick:_(r=>L(n.code),["stop"])},[s("div",Ve,[i(e).openMap[n.code]?(l(),b(c,{key:0,class:"f14 mr8"})):(l(),b(v,{key:1,class:"f14 mr8"})),s("span",{class:z(["f14",n.code===i(e).activeColumnCode?"i1 fw":"c8"])},g(n.name),3)])],8,xe),E(s("div",Ie,[(l(!0),d(f,null,h(n.children,r=>(l(),d("div",{key:r.id,class:z(["kb-child cursor",r.id===i(e).activeCategoryId?"kb-child-active":"kb-child-normal"]),onClick:_(M=>D(n.code,r.id),["stop"])},[s("span",$e,g(r.name),1)],10,Ne))),128)),s("div",{class:"kb-add cursor",onClick:_(r=>R(n.code),["stop"])},[p(y,{class:"f14 mr5"}),t[10]||(t[10]=s("span",{class:"f14"},"新增",-1))],8,Ae)],512),[[se,i(e).openMap[n.code]]])]))),128))])]),s("div",Me,[s("div",Ee,[s("div",ze,[p(A,{modelValue:i(e).q,"onUpdate:modelValue":t[2]||(t[2]=n=>i(e).q=n),placeholder:"请输入关键词",clearable:"",onKeyup:t[3]||(t[3]=Y(n=>N(),["enter"]))},{append:C(()=>[s("div",{class:"kb-search-btn flex-cc cursor bgi1 white",onClick:t[1]||(t[1]=_(n=>N(),["stop"]))},[p(T,{class:"f16"})])]),_:1},8,["modelValue"])]),s("div",Be,[s("div",Se,g(i(e).activeColumnName||"文章列表"),1),E((l(),d("div",Le,[i(e).items.length===0?(l(),d("div",De,"暂无数据")):(l(),d("div",qe,[(l(!0),d(f,null,h(i(e).items,n=>(l(),d("div",{key:n.id,class:"kb-row cursor",onClick:_(r=>q(n.id),["stop"])},[s("div",Ue,[s("div",Ke,[i(S)&&V(n)?(l(),b(j,{key:0,src:V(n),"preview-src-list":x(n),"initial-index":0,fit:"cover",style:{width:"72px",height:"48px","border-radius":"4px","margin-right":"12px"}},null,8,["src","preview-src-list"])):ae("",!0),(l(!0),d(f,null,h(K(n),(r,M)=>(l(),d("span",{key:`${n.id}-${M}`,class:"kb-tag mr15"},g(r),1))),128)),s("span",Re,g(n.title),1)]),s("span",Fe,g(n.publish_time||"-"),1)])],8,Pe))),128))]))])),[[J,i(e).loading]]),s("div",Te,[p(G,{background:"",layout:"prev, pager, next, sizes, jumper",total:i(e).total,"page-size":i(e).limit,"current-page":i(e).page,onSizeChange:U,onCurrentChange:P},null,8,["total","page-size","current-page"])])])])])]),p(H,{modelValue:i(e).addVisible,"onUpdate:modelValue":t[7]||(t[7]=n=>i(e).addVisible=n),title:"新增二级分类",width:"420px"},{footer:C(()=>[s("div",He,[s("div",{class:"rad4 ptb5 plr12 flex-cc cursor bg-white c8 bo-cc-1",onClick:t[5]||(t[5]=_(n=>$(),["stop"]))},"取消"),s("div",{class:"rad4 ptb5 plr12 flex-cc cursor bgi1 white bo-i1-1 ml15",onClick:t[6]||(t[6]=_(n=>F(),["stop"]))},"确定")])]),default:C(()=>[s("div",je,[t[11]||(t[11]=s("span",{class:"mr10"},"分类名称",-1)),s("div",Ge,[p(A,{modelValue:i(e).addName,"onUpdate:modelValue":t[4]||(t[4]=n=>i(e).addName=n),placeholder:"请输入",maxlength:"30","show-word-limit":""},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}}),Ze=le(Je,[["__scopeId","data-v-373c0988"]]);export{Ze as default};
