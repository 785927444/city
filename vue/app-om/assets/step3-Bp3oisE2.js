import{d as I,g as U,r as q,o as y,c as F,f,a as i,Z as z,u as s,w as d,e as $,i as A,$ as L,m as T,F as D,p as M,z as j,q as R,E as X,h as Z,a9 as G,a3 as H,a4 as O,aa as K,l as P}from"./index-BF5jje68.js";import{_ as Q}from"./FileList.vue_vue_type_script_setup_true_lang-CjQZZdnb.js";import{a as V}from"./areaData-CfkeTXdx.js";import{v as W}from"./v6-B4YtUg27.js";import"./ViewFiles-C92c8QO4.js";import"./question-filled-BgQjHn-S.js";/* empty css                    *//* empty css                   */import"./index-CU8Q0z-M.js";import"./index-CND7x1jx.js";/* empty css                                                                   */const Y={class:"layout-col overlay"},k={class:"hh100 ww100 flex-sc warp"},ee={class:"flex-sc warp ww100"},te={class:"ww100 plr30 ptb22 bo-i16-1 rad8 bg-white"},ae={class:"ww100 flex-cc f18 p40 bot-i16-1 mt20"},le=I({__name:"step3",props:{state:{type:[Object,Array],default:()=>({})},contents:{type:Array,default:[]},plans:{type:Array,default:[]},active:{type:[Object,Array],default:()=>({})}},setup(C){const{proxy:o}=U(),a=o.publicStore(),g=o.configStore(),J=o.dictStore();let v=A(),B=A({completion_status:[{required:!0,message:"请选择",trigger:"blur"}],reserve_res:[{required:!0,message:"请输入",trigger:"blur"}]});q({...a.$state});const x=C,E=(h,l)=>{h.validate(async b=>{b&&(console.log("publicStore.form---3",a.form),G.confirm("否确定操作继续","温馨提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warn"}).then(async()=>{let e=JSON.parse(JSON.stringify(a.form)),c=Date.now()+"";e.type="report",e.update_time=c,e.user_id=g.user.id,e.user_name=g.user.name;let u=e.id?"updApi":"addApi";if(u=="addApi"&&a.title=="apply"){console.log("新增项目");const t=new Date().toISOString().slice(0,10).replace(/-/g,"");e.num_title="SX",e.num_date=t;let n={model:"t_project_report",args:`num_title='${e.num_title}' and num_date='${e.num_date}'`,field:"num_number",order:"num_number asc"},p=await a.http({Api:n});e.num_number=o.isNull(p)?"000001":String(parseInt(p[0].num_number,10)+1).padStart(6,"0")}if(u=="updApi"&&((a.title="apply")&&(console.log("申请储备"),e.apply_status="1",e.apply_time=c),(e.apply_status="1")&&console.log("更新信息"),(a.title="reserve")&&(e.reserve_status=l,e.reserve_time=c,l=="1"&&(e.apply_status="2"),l=="2"&&(e.apply_status="3"))),e.id||(e.id=W()),!o.isNull(e.area)){if(e.area.length>0){e.province=e.area.length>0?e.area[0]:"";let t=o.findNode(V,n=>n.code==e.province);t&&(e.province_name=t.name)}if(e.area.length>1){e.city=e.area.length>1?e.area[1]:"";let t=o.findNode(V,n=>n.code==e.city);t&&(e.city_name=t.name)}if(e.area.length>2){e.district=e.area.length>2?e.area[2]:"";let t=o.findNode(V,n=>n.code==e.district);t&&(e.district_name=t.name)}e.area=JSON.stringify(e.area)}e.fund_source=o.isNull(e.fund_source)?"":JSON.stringify(e.fund_source),e.orther_text=o.isNull(e.orther_text)?"":JSON.stringify(e.orther_text);let m=[];o.isNull(e.attr)?e.attr="":(Object.keys(e.attr).forEach(t=>{if(e.attr[t].data&&e.attr[t].data.indexOf("/uploads")!=-1){const p=`${a._public.contents1.find(w=>w.type==t).parent_type}/${g.user.id}_${t}_${e.attr[t].name}`;e.attr[t].data=p,m.push({oldfile:a.form.attr[t].data,newfile:p})}}),e.attr=JSON.stringify(e.attr));let _=[];o.isNull(e.plan_attr)?e.plan_attr="":(Object.keys(e.plan_attr).forEach(t=>{if(e.plan_attr[t].data&&e.plan_attr[t].data.indexOf("/uploads")!=-1){const p=`${a._public.contents2.find(w=>w.type==t).parent_type}/${g.user.id}_${t}_${e.plan_attr[t].name}`;e.plan_attr[t].data=p,_.push({oldfile:a.form.plan_attr[t].data,newfile:p})}}),e.plan_attr=JSON.stringify(e.plan_attr));let r=[];o.isNull(e.has_attr)?e.has_attr="":(Object.keys(e.has_attr).forEach(t=>{if(e.has_attr[t].data&&e.has_attr[t].data.indexOf("/uploads")!=-1){const p=`${a._public.contents2.find(w=>w.type==t).parent_type}/${g.user.id}_${t}_${e.has_attr[t].name}`;e.has_attr[t].data=p,r.push({oldfile:a.form.has_attr[t].data,newfile:p})}}),e.has_attr=JSON.stringify(e.has_attr));let S={model:"t_project_report",list:[e]};console.log("params",S),console.log("changeFile1",m),console.log("changeFile2",_),console.log("changeFile3",r),H[u](S).then(async t=>{if(t.code==200){let n=u=="updApi"?"操作成功":"保存成功";O({title:"提示",message:n,type:"success"}),o.isNull(m)||N(m),o.isNull(_)||N(_),o.isNull(r)||N(r),setTimeout(()=>{K.back()},500)}else O({title:"提示",message:t.msg?t.msg:"保存失败(400)",type:"error"})}).catch(t=>{O({title:"提示",message:"保存失败(500)",type:"error"})})}))})},N=async h=>{if(o.isNull(h))return;let l={list:h};a.http({changeFileApi:l}).then(b=>{})};return(h,l)=>{const b=R,e=T,c=L,u=X,m=Q,_=z;return y(),F("div",Y,[f("div",k,[i(_,{class:"ww100 pplr15",ref_key:"formRef",ref:v,model:s(a).form,rules:s(B),"label-width":"120"},{default:d(()=>[f("div",ee,[i(c,{label:"项目状态",prop:"completion_status",class:"ww50 flex-sc"},{default:d(()=>[i(e,{modelValue:s(a).form.completion_status,"onUpdate:modelValue":l[0]||(l[0]=r=>s(a).form.completion_status=r),placeholder:"请选择",style:{width:"100%"},filterable:"",clearable:""},{default:d(()=>[(y(!0),F(D,null,M(s(J).project_completion_statuss,(r,S)=>(y(),j(b,{key:r.value,value:String(r.value),label:r.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(c,{label:"已投资金额",prop:"has_construct_price",class:"ww50 flex-sc"},{default:d(()=>[i(u,{size:"large",modelValue:s(a).form.has_construct_price,"onUpdate:modelValue":l[1]||(l[1]=r=>s(a).form.has_construct_price=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),i(c,{label:"已建设规模",prop:"has_construct_price",class:"ww50 flex-sc"},{default:d(()=>[i(u,{size:"large",modelValue:s(a).form.has_construct_scale,"onUpdate:modelValue":l[2]||(l[2]=r=>s(a).form.has_construct_scale=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),i(c,{label:"实施成效说明",prop:"has_construct_effect",class:"ww100 flex-ss"},{default:d(()=>[i(u,{size:"large",modelValue:s(a).form.has_construct_effect,"onUpdate:modelValue":l[3]||(l[3]=r=>s(a).form.has_construct_effect=r),style:{width:"100%"},type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1}),i(c,{label:"过程材料上传",prop:"files3",class:"ww100 flex-ss"},{default:d(()=>[f("div",te,[s(a).form?.has_attr?(y(),j(m,{key:0,files:s(a).form.has_attr,"onUpdate:files":l[4]||(l[4]=r=>s(a).form.has_attr=r),plans:x.plans,contents:x.contents,active:x.active},null,8,["files","plans","contents","active"])):Z("",!0)])]),_:1}),i(c,{label:"审核结果",prop:"reserve_res",class:"ww100 flex-ss"},{default:d(()=>[i(u,{size:"large",modelValue:s(a).form.reserve_res,"onUpdate:modelValue":l[5]||(l[5]=r=>s(a).form.reserve_res=r),style:{width:"100%"},type:"textarea",rows:4,placeholder:"请输入"},null,8,["modelValue"])]),_:1})])]),_:1},8,["model","rules"]),f("div",ae,[f("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:l[6]||(l[6]=$(r=>s(a).actIndex--,["stop"]))},"上一步"),f("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi1 bo-i1-1",onClick:l[7]||(l[7]=$(r=>E(s(v),"1"),["stop"]))},"通 过"),f("div",{class:"plr14 ptb5 rad4 ml15 cursor white bgi8 bo-i8-1",onClick:l[8]||(l[8]=$(r=>E(s(v),"2"),["stop"]))},"驳 回")])])])}}}),_e=P(le,[["__scopeId","data-v-80d17de4"]]);export{_e as default};
